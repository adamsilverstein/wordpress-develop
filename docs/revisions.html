<!DOCTYPE html>

<html>
<head>
  <title>revisions.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="bookmarklet.html">
                  bookmarklet.js
                </a>
              
                
                <a class="source" href="bookmarklet.min.html">
                  bookmarklet.min.js
                </a>
              
                
                <a class="source" href="color-picker.html">
                  color-picker.js
                </a>
              
                
                <a class="source" href="comment.html">
                  comment.js
                </a>
              
                
                <a class="source" href="common.html">
                  common.js
                </a>
              
                
                <a class="source" href="custom-background.html">
                  custom-background.js
                </a>
              
                
                <a class="source" href="custom-header.html">
                  custom-header.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-nav-menus.html">
                  customize-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-widgets.html">
                  customize-widgets.js
                </a>
              
                
                <a class="source" href="dashboard.html">
                  dashboard.js
                </a>
              
                
                <a class="source" href="edit-comments.html">
                  edit-comments.js
                </a>
              
                
                <a class="source" href="editor-expand.html">
                  editor-expand.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="farbtastic.html">
                  farbtastic.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="image-edit.html">
                  image-edit.js
                </a>
              
                
                <a class="source" href="inline-edit-post.html">
                  inline-edit-post.js
                </a>
              
                
                <a class="source" href="inline-edit-tax.html">
                  inline-edit-tax.js
                </a>
              
                
                <a class="source" href="iris.min.html">
                  iris.min.js
                </a>
              
                
                <a class="source" href="language-chooser.html">
                  language-chooser.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="media-gallery.html">
                  media-gallery.js
                </a>
              
                
                <a class="source" href="media-upload.html">
                  media-upload.js
                </a>
              
                
                <a class="source" href="media.html">
                  media.js
                </a>
              
                
                <a class="source" href="nav-menu.html">
                  nav-menu.js
                </a>
              
                
                <a class="source" href="password-strength-meter.html">
                  password-strength-meter.js
                </a>
              
                
                <a class="source" href="plugin-install.html">
                  plugin-install.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="postbox.html">
                  postbox.js
                </a>
              
                
                <a class="source" href="press-this.html">
                  press-this.js
                </a>
              
                
                <a class="source" href="revisions.html">
                  revisions.js
                </a>
              
                
                <a class="source" href="set-post-thumbnail.html">
                  set-post-thumbnail.js
                </a>
              
                
                <a class="source" href="svg-painter.html">
                  svg-painter.js
                </a>
              
                
                <a class="source" href="tags-box.html">
                  tags-box.js
                </a>
              
                
                <a class="source" href="tags-suggest.html">
                  tags-suggest.js
                </a>
              
                
                <a class="source" href="tags.html">
                  tags.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="updates.html">
                  updates.js
                </a>
              
                
                <a class="source" href="user-profile.html">
                  user-profile.js
                </a>
              
                
                <a class="source" href="user-suggest.html">
                  user-suggest.js
                </a>
              
                
                <a class="source" href="widgets.html">
                  widgets.js
                </a>
              
                
                <a class="source" href="media-audio-widget.html">
                  media-audio-widget.js
                </a>
              
                
                <a class="source" href="media-image-widget.html">
                  media-image-widget.js
                </a>
              
                
                <a class="source" href="media-video-widget.html">
                  media-video-widget.js
                </a>
              
                
                <a class="source" href="media-widgets.html">
                  media-widgets.js
                </a>
              
                
                <a class="source" href="text-widgets.html">
                  text-widgets.js
                </a>
              
                
                <a class="source" href="word-count.html">
                  word-count.js
                </a>
              
                
                <a class="source" href="wp-fullscreen-stub.html">
                  wp-fullscreen-stub.js
                </a>
              
                
                <a class="source" href="xfn.html">
                  xfn.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="theme-options.html">
                  theme-options.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="showcase.html">
                  showcase.js
                </a>
              
                
                <a class="source" href="color-scheme-control.html">
                  color-scheme-control.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="customizer.html">
                  customizer.js
                </a>
              
                
                <a class="source" href="featured-content-admin.html">
                  featured-content-admin.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="jquery.scrollTo.html">
                  jquery.scrollTo.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="admin-bar.html">
                  admin-bar.js
                </a>
              
                
                <a class="source" href="autosave.html">
                  autosave.js
                </a>
              
                
                <a class="source" href="backbone.html">
                  backbone.js
                </a>
              
                
                <a class="source" href="backbone.min.html">
                  backbone.min.js
                </a>
              
                
                <a class="source" href="colorpicker.html">
                  colorpicker.js
                </a>
              
                
                <a class="source" href="comment-reply.html">
                  comment-reply.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-base.html">
                  customize-base.js
                </a>
              
                
                <a class="source" href="customize-loader.html">
                  customize-loader.js
                </a>
              
                
                <a class="source" href="customize-models.html">
                  customize-models.js
                </a>
              
                
                <a class="source" href="customize-preview-nav-menus.html">
                  customize-preview-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-preview-widgets.html">
                  customize-preview-widgets.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="customize-selective-refresh.html">
                  customize-selective-refresh.js
                </a>
              
                
                <a class="source" href="customize-views.html">
                  customize-views.js
                </a>
              
                
                <a class="source" href="heartbeat.html">
                  heartbeat.js
                </a>
              
                
                <a class="source" href="hoverIntent.html">
                  hoverIntent.js
                </a>
              
                
                <a class="source" href="imagesloaded.min.html">
                  imagesloaded.min.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.html">
                  jquery.imgareaselect.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.min.html">
                  jquery.imgareaselect.min.js
                </a>
              
                
                <a class="source" href="jquery.Jcrop.min.html">
                  jquery.Jcrop.min.js
                </a>
              
                
                <a class="source" href="jquery-migrate.html">
                  jquery-migrate.js
                </a>
              
                
                <a class="source" href="jquery-migrate.min.html">
                  jquery-migrate.min.js
                </a>
              
                
                <a class="source" href="jquery.color.min.html">
                  jquery.color.min.js
                </a>
              
                
                <a class="source" href="jquery.form.html">
                  jquery.form.js
                </a>
              
                
                <a class="source" href="jquery.form.min.html">
                  jquery.form.min.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.html">
                  jquery.hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.min.html">
                  jquery.hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.html">
                  jquery.js
                </a>
              
                
                <a class="source" href="jquery.masonry.html">
                  jquery.masonry.js
                </a>
              
                
                <a class="source" href="jquery.masonry.min.html">
                  jquery.masonry.min.js
                </a>
              
                
                <a class="source" href="jquery.query.html">
                  jquery.query.js
                </a>
              
                
                <a class="source" href="jquery.schedule.html">
                  jquery.schedule.js
                </a>
              
                
                <a class="source" href="jquery.serialize-object.html">
                  jquery.serialize-object.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.html">
                  jquery.table-hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.min.html">
                  jquery.table-hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.html">
                  jquery.ui.touch-punch.js
                </a>
              
                
                <a class="source" href="suggest.html">
                  suggest.js
                </a>
              
                
                <a class="source" href="suggest.min.html">
                  suggest.min.js
                </a>
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="autocomplete.html">
                  autocomplete.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="datepicker.html">
                  datepicker.js
                </a>
              
                
                <a class="source" href="dialog.html">
                  dialog.js
                </a>
              
                
                <a class="source" href="draggable.html">
                  draggable.js
                </a>
              
                
                <a class="source" href="droppable.html">
                  droppable.js
                </a>
              
                
                <a class="source" href="effect-blind.html">
                  effect-blind.js
                </a>
              
                
                <a class="source" href="effect-bounce.html">
                  effect-bounce.js
                </a>
              
                
                <a class="source" href="effect-clip.html">
                  effect-clip.js
                </a>
              
                
                <a class="source" href="effect-drop.html">
                  effect-drop.js
                </a>
              
                
                <a class="source" href="effect-explode.html">
                  effect-explode.js
                </a>
              
                
                <a class="source" href="effect-fade.html">
                  effect-fade.js
                </a>
              
                
                <a class="source" href="effect-fold.html">
                  effect-fold.js
                </a>
              
                
                <a class="source" href="effect-highlight.html">
                  effect-highlight.js
                </a>
              
                
                <a class="source" href="effect-puff.html">
                  effect-puff.js
                </a>
              
                
                <a class="source" href="effect-pulsate.html">
                  effect-pulsate.js
                </a>
              
                
                <a class="source" href="effect-scale.html">
                  effect-scale.js
                </a>
              
                
                <a class="source" href="effect-shake.html">
                  effect-shake.js
                </a>
              
                
                <a class="source" href="effect-size.html">
                  effect-size.js
                </a>
              
                
                <a class="source" href="effect-slide.html">
                  effect-slide.js
                </a>
              
                
                <a class="source" href="effect-transfer.html">
                  effect-transfer.js
                </a>
              
                
                <a class="source" href="effect.html">
                  effect.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="position.html">
                  position.js
                </a>
              
                
                <a class="source" href="progressbar.html">
                  progressbar.js
                </a>
              
                
                <a class="source" href="resizable.html">
                  resizable.js
                </a>
              
                
                <a class="source" href="selectable.html">
                  selectable.js
                </a>
              
                
                <a class="source" href="selectmenu.html">
                  selectmenu.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="sortable.html">
                  sortable.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="widget.html">
                  widget.js
                </a>
              
                
                <a class="source" href="json2.html">
                  json2.js
                </a>
              
                
                <a class="source" href="masonry.min.html">
                  masonry.min.js
                </a>
              
                
                <a class="source" href="mce-view.html">
                  mce-view.js
                </a>
              
                
                <a class="source" href="media-audiovideo.html">
                  media-audiovideo.js
                </a>
              
                
                <a class="source" href="media-editor.html">
                  media-editor.js
                </a>
              
                
                <a class="source" href="media-grid.html">
                  media-grid.js
                </a>
              
                
                <a class="source" href="media-models.html">
                  media-models.js
                </a>
              
                
                <a class="source" href="media-views.html">
                  media-views.js
                </a>
              
                
                <a class="source" href="audiovideo.manifest.html">
                  audiovideo.manifest.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="collection-add.html">
                  collection-add.js
                </a>
              
                
                <a class="source" href="collection-edit.html">
                  collection-edit.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-image-cropper.html">
                  customize-image-cropper.js
                </a>
              
                
                <a class="source" href="edit-attachment-metadata.html">
                  edit-attachment-metadata.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="featured-image.html">
                  featured-image.js
                </a>
              
                
                <a class="source" href="gallery-add.html">
                  gallery-add.js
                </a>
              
                
                <a class="source" href="gallery-edit.html">
                  gallery-edit.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="media-library.html">
                  media-library.js
                </a>
              
                
                <a class="source" href="region.html">
                  region.js
                </a>
              
                
                <a class="source" href="replace-image.html">
                  replace-image.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="state-machine.html">
                  state-machine.js
                </a>
              
                
                <a class="source" href="state.html">
                  state.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="grid.manifest.html">
                  grid.manifest.js
                </a>
              
                
                <a class="source" href="models.manifest.html">
                  models.manifest.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="post-image.html">
                  post-image.js
                </a>
              
                
                <a class="source" href="post-media.html">
                  post-media.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="selection-sync.html">
                  selection-sync.js
                </a>
              
                
                <a class="source" href="views.manifest.html">
                  views.manifest.js
                </a>
              
                
                <a class="source" href="attachment-compat.html">
                  attachment-compat.js
                </a>
              
                
                <a class="source" href="attachment-filters.html">
                  attachment-filters.js
                </a>
              
                
                <a class="source" href="all.html">
                  all.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="uploaded.html">
                  uploaded.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="details-two-column.html">
                  details-two-column.js
                </a>
              
                
                <a class="source" href="details.html">
                  details.js
                </a>
              
                
                <a class="source" href="edit-library.html">
                  edit-library.js
                </a>
              
                
                <a class="source" href="edit-selection.html">
                  edit-selection.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="browser.html">
                  browser.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="button-group.html">
                  button-group.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="delete-selected-permanently.html">
                  delete-selected-permanently.js
                </a>
              
                
                <a class="source" href="delete-selected.html">
                  delete-selected.js
                </a>
              
                
                <a class="source" href="select-mode-toggle.html">
                  select-mode-toggle.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="edit-image-details.html">
                  edit-image-details.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="image.html">
                  image.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="url.html">
                  url.js
                </a>
              
                
                <a class="source" href="focus-manager.html">
                  focus-manager.js
                </a>
              
                
                <a class="source" href="frame.html">
                  frame.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="edit-attachments.html">
                  edit-attachments.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="iframe.html">
                  iframe.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="label.html">
                  label.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="media-frame.html">
                  media-frame.js
                </a>
              
                
                <a class="source" href="menu-item.html">
                  menu-item.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="priority-list.html">
                  priority-list.js
                </a>
              
                
                <a class="source" href="router-item.html">
                  router-item.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="attachment-display.html">
                  attachment-display.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="playlist.html">
                  playlist.js
                </a>
              
                
                <a class="source" href="sidebar.html">
                  sidebar.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="site-icon-preview.html">
                  site-icon-preview.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="toolbar.html">
                  toolbar.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="inline.html">
                  inline.js
                </a>
              
                
                <a class="source" href="status-error.html">
                  status-error.js
                </a>
              
                
                <a class="source" href="status.html">
                  status.js
                </a>
              
                
                <a class="source" href="window.html">
                  window.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="view.html">
                  view.js
                </a>
              
                
                <a class="source" href="froogaloop.min.html">
                  froogaloop.min.js
                </a>
              
                
                <a class="source" href="mediaelement-and-player.min.html">
                  mediaelement-and-player.min.js
                </a>
              
                
                <a class="source" href="wp-mediaelement.html">
                  wp-mediaelement.js
                </a>
              
                
                <a class="source" href="wp-playlist.html">
                  wp-playlist.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="plupload.full.min.html">
                  plupload.full.min.js
                </a>
              
                
                <a class="source" href="wp-plupload.html">
                  wp-plupload.js
                </a>
              
                
                <a class="source" href="quicktags.html">
                  quicktags.js
                </a>
              
                
                <a class="source" href="shortcode.html">
                  shortcode.js
                </a>
              
                
                <a class="source" href="swfobject.html">
                  swfobject.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="handlers.min.html">
                  handlers.min.js
                </a>
              
                
                <a class="source" href="swfupload.cookies.html">
                  swfupload.cookies.js
                </a>
              
                
                <a class="source" href="swfupload.queue.html">
                  swfupload.queue.js
                </a>
              
                
                <a class="source" href="swfupload.speed.html">
                  swfupload.speed.js
                </a>
              
                
                <a class="source" href="swfupload.swfobject.html">
                  swfupload.swfobject.js
                </a>
              
                
                <a class="source" href="swfupload.html">
                  swfupload.js
                </a>
              
                
                <a class="source" href="thickbox.html">
                  thickbox.js
                </a>
              
                
                <a class="source" href="wp-langs-en.html">
                  wp-langs-en.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="tiny_mce_popup.html">
                  tiny_mce_popup.js
                </a>
              
                
                <a class="source" href="tinymce.html">
                  tinymce.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="editable_selects.html">
                  editable_selects.js
                </a>
              
                
                <a class="source" href="form_utils.html">
                  form_utils.js
                </a>
              
                
                <a class="source" href="mctabs.html">
                  mctabs.js
                </a>
              
                
                <a class="source" href="validate.html">
                  validate.js
                </a>
              
                
                <a class="source" href="tw-sack.html">
                  tw-sack.js
                </a>
              
                
                <a class="source" href="twemoji.html">
                  twemoji.js
                </a>
              
                
                <a class="source" href="underscore.html">
                  underscore.js
                </a>
              
                
                <a class="source" href="underscore.min.html">
                  underscore.min.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="wp-a11y.html">
                  wp-a11y.js
                </a>
              
                
                <a class="source" href="wp-ajax-response.html">
                  wp-ajax-response.js
                </a>
              
                
                <a class="source" href="wp-api.html">
                  wp-api.js
                </a>
              
                
                <a class="source" href="wp-auth-check.html">
                  wp-auth-check.js
                </a>
              
                
                <a class="source" href="wp-backbone.html">
                  wp-backbone.js
                </a>
              
                
                <a class="source" href="wp-custom-header.html">
                  wp-custom-header.js
                </a>
              
                
                <a class="source" href="wp-embed-template.html">
                  wp-embed-template.js
                </a>
              
                
                <a class="source" href="wp-embed.html">
                  wp-embed.js
                </a>
              
                
                <a class="source" href="wp-emoji-loader.html">
                  wp-emoji-loader.js
                </a>
              
                
                <a class="source" href="wp-emoji.html">
                  wp-emoji.js
                </a>
              
                
                <a class="source" href="wp-list-revisions.html">
                  wp-list-revisions.js
                </a>
              
                
                <a class="source" href="wp-lists.html">
                  wp-lists.js
                </a>
              
                
                <a class="source" href="wp-pointer.html">
                  wp-pointer.js
                </a>
              
                
                <a class="source" href="wp-util.html">
                  wp-util.js
                </a>
              
                
                <a class="source" href="wpdialog.html">
                  wpdialog.js
                </a>
              
                
                <a class="source" href="wplink.html">
                  wplink.js
                </a>
              
                
                <a class="source" href="zxcvbn-async.html">
                  zxcvbn-async.js
                </a>
              
                
                <a class="source" href="zxcvbn.min.html">
                  zxcvbn.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>revisions.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global isRtl */</span>
<span class="hljs-comment">/**
 * @file Revisions interface functions, Backbone classes and
 * the revisions.php document.ready bootstrap.
 *
 */</span>

<span class="hljs-built_in">window</span>.wp = <span class="hljs-built_in">window</span>.wp || {};

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{
	<span class="hljs-keyword">var</span> revisions;
	<span class="hljs-comment">/**
	 * Expose the module in window.wp.revisions.
	 */</span>
	revisions = wp.revisions = { <span class="hljs-attr">model</span>: {}, <span class="hljs-attr">view</span>: {}, <span class="hljs-attr">controller</span>: {} };</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Link post revisions data served from the back end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.settings = <span class="hljs-built_in">window</span>._wpRevisionsSettings || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>For debugging</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.debug = <span class="hljs-literal">false</span>;

	<span class="hljs-comment">/**
	 * wp.revisions.log
	 *
	 * A debugging utility for revisions. Works only when a
	 * debug flag is on and the browser supports it.
	 */</span>
	revisions.log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">if</span> ( <span class="hljs-built_in">window</span>.console &amp;&amp; revisions.debug ) {
			<span class="hljs-built_in">window</span>.console.log.apply( <span class="hljs-built_in">window</span>.console, <span class="hljs-built_in">arguments</span> );
		}
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Handy functions to help with positioning</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$.fn.allOffsets = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> offset = <span class="hljs-keyword">this</span>.offset() || {<span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>}, win = $(<span class="hljs-built_in">window</span>);
		<span class="hljs-keyword">return</span> _.extend( offset, {
			<span class="hljs-attr">right</span>:  win.width()  - offset.left - <span class="hljs-keyword">this</span>.outerWidth(),
			<span class="hljs-attr">bottom</span>: win.height() - offset.top  - <span class="hljs-keyword">this</span>.outerHeight()
		});
	};

	$.fn.allPositions = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> position = <span class="hljs-keyword">this</span>.position() || {<span class="hljs-attr">top</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>}, parent = <span class="hljs-keyword">this</span>.parent();
		<span class="hljs-keyword">return</span> _.extend( position, {
			<span class="hljs-attr">right</span>:  parent.outerWidth()  - position.left - <span class="hljs-keyword">this</span>.outerWidth(),
			<span class="hljs-attr">bottom</span>: parent.outerHeight() - position.top  - <span class="hljs-keyword">this</span>.outerHeight()
		});
	};

	<span class="hljs-comment">/**
	 * ========================================================================
	 * MODELS
	 * ========================================================================
	 */</span>
	revisions.model.Slider = Backbone.Model.extend({
		<span class="hljs-attr">defaults</span>: {
			<span class="hljs-attr">value</span>: <span class="hljs-literal">null</span>,
			<span class="hljs-attr">values</span>: <span class="hljs-literal">null</span>,
			<span class="hljs-attr">min</span>: <span class="hljs-number">0</span>,
			<span class="hljs-attr">max</span>: <span class="hljs-number">1</span>,
			<span class="hljs-attr">step</span>: <span class="hljs-number">1</span>,
			<span class="hljs-attr">range</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">compareTwoMode</span>: <span class="hljs-literal">false</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> options </span>) </span>{
			<span class="hljs-keyword">this</span>.frame = options.frame;
			<span class="hljs-keyword">this</span>.revisions = options.revisions;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Listen for changes to the revisions or mode from outside</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.frame, <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">this</span>.receiveRevisions );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.frame, <span class="hljs-string">'change:compareTwoMode'</span>, <span class="hljs-keyword">this</span>.updateMode );</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Listen for internal changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.on( <span class="hljs-string">'change:from'</span>, <span class="hljs-keyword">this</span>.handleLocalChanges );
			<span class="hljs-keyword">this</span>.on( <span class="hljs-string">'change:to'</span>, <span class="hljs-keyword">this</span>.handleLocalChanges );
			<span class="hljs-keyword">this</span>.on( <span class="hljs-string">'change:compareTwoMode'</span>, <span class="hljs-keyword">this</span>.updateSliderSettings );
			<span class="hljs-keyword">this</span>.on( <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">this</span>.updateSliderSettings );</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Listen for changes to the hovered revision</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.on( <span class="hljs-string">'change:hoveredRevision'</span>, <span class="hljs-keyword">this</span>.hoverRevision );

			<span class="hljs-keyword">this</span>.set({
				<span class="hljs-attr">max</span>:   <span class="hljs-keyword">this</span>.revisions.length - <span class="hljs-number">1</span>,
				<span class="hljs-attr">compareTwoMode</span>: <span class="hljs-keyword">this</span>.frame.get(<span class="hljs-string">'compareTwoMode'</span>),
				<span class="hljs-attr">from</span>: <span class="hljs-keyword">this</span>.frame.get(<span class="hljs-string">'from'</span>),
				<span class="hljs-attr">to</span>: <span class="hljs-keyword">this</span>.frame.get(<span class="hljs-string">'to'</span>)
			});
			<span class="hljs-keyword">this</span>.updateSliderSettings();
		},

		<span class="hljs-attr">getSliderValue</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> a, b </span>) </span>{
			<span class="hljs-keyword">return</span> isRtl ? <span class="hljs-keyword">this</span>.revisions.length - <span class="hljs-keyword">this</span>.revisions.indexOf( <span class="hljs-keyword">this</span>.get(a) ) - <span class="hljs-number">1</span> : <span class="hljs-keyword">this</span>.revisions.indexOf( <span class="hljs-keyword">this</span>.get(b) );
		},

		<span class="hljs-attr">updateSliderSettings</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'compareTwoMode'</span>) ) {
				<span class="hljs-keyword">this</span>.set({
					<span class="hljs-attr">values</span>: [
						<span class="hljs-keyword">this</span>.getSliderValue( <span class="hljs-string">'to'</span>, <span class="hljs-string">'from'</span> ),
						<span class="hljs-keyword">this</span>.getSliderValue( <span class="hljs-string">'from'</span>, <span class="hljs-string">'to'</span> )
					],
					<span class="hljs-attr">value</span>: <span class="hljs-literal">null</span>,
					<span class="hljs-attr">range</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// ensures handles cannot cross</span>
				});
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.set({
					<span class="hljs-attr">value</span>: <span class="hljs-keyword">this</span>.getSliderValue( <span class="hljs-string">'to'</span>, <span class="hljs-string">'to'</span> ),
					<span class="hljs-attr">values</span>: <span class="hljs-literal">null</span>,
					<span class="hljs-attr">range</span>: <span class="hljs-literal">false</span>
				});
			}
			<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'update:slider'</span> );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Called when a revision is hovered</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		hoverRevision: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model, value </span>) </span>{
			<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'hovered:revision'</span>, value );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Called when <code>compareTwoMode</code> changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		updateMode: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model, value </span>) </span>{
			<span class="hljs-keyword">this</span>.set({ <span class="hljs-attr">compareTwoMode</span>: value });
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Called when <code>from</code> or <code>to</code> changes in the local model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		handleLocalChanges: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.frame.set({
				<span class="hljs-attr">from</span>: <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'from'</span>),
				<span class="hljs-attr">to</span>: <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'to'</span>)
			});
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Receives revisions changes from outside the model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		receiveRevisions: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> from, to </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Bail if nothing changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'from'</span>) === <span class="hljs-keyword">from</span> &amp;&amp; <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'to'</span>) === to ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">this</span>.set({ <span class="hljs-attr">from</span>: <span class="hljs-keyword">from</span>, <span class="hljs-attr">to</span>: to }, { <span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span> });
			<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">from</span>, to );
		}

	});

	revisions.model.Tooltip = Backbone.Model.extend({
		<span class="hljs-attr">defaults</span>: {
			<span class="hljs-attr">revision</span>: <span class="hljs-literal">null</span>,
			<span class="hljs-attr">offset</span>: {},
			<span class="hljs-attr">hovering</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// Whether the mouse is hovering</span>
			scrubbing: <span class="hljs-literal">false</span> <span class="hljs-comment">// Whether the mouse is scrubbing</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> options </span>) </span>{
			<span class="hljs-keyword">this</span>.frame = options.frame;
			<span class="hljs-keyword">this</span>.revisions = options.revisions;
			<span class="hljs-keyword">this</span>.slider = options.slider;

			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.slider, <span class="hljs-string">'hovered:revision'</span>, <span class="hljs-keyword">this</span>.updateRevision );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.slider, <span class="hljs-string">'change:hovering'</span>, <span class="hljs-keyword">this</span>.setHovering );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.slider, <span class="hljs-string">'change:scrubbing'</span>, <span class="hljs-keyword">this</span>.setScrubbing );
		},


		<span class="hljs-attr">updateRevision</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> revision </span>) </span>{
			<span class="hljs-keyword">this</span>.set({ <span class="hljs-attr">revision</span>: revision });
		},

		<span class="hljs-attr">setHovering</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model, value </span>) </span>{
			<span class="hljs-keyword">this</span>.set({ <span class="hljs-attr">hovering</span>: value });
		},

		<span class="hljs-attr">setScrubbing</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model, value </span>) </span>{
			<span class="hljs-keyword">this</span>.set({ <span class="hljs-attr">scrubbing</span>: value });
		}
	});

	revisions.model.Revision = Backbone.Model.extend({});

	<span class="hljs-comment">/**
	 * wp.revisions.model.Revisions
	 *
	 * A collection of post revisions.
	 */</span>
	revisions.model.Revisions = Backbone.Collection.extend({
		<span class="hljs-attr">model</span>: revisions.model.Revision,

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			_.bindAll( <span class="hljs-keyword">this</span>, <span class="hljs-string">'next'</span>, <span class="hljs-string">'prev'</span> );
		},

		<span class="hljs-attr">next</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> revision </span>) </span>{
			<span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>.indexOf( revision );

			<span class="hljs-keyword">if</span> ( index !== <span class="hljs-number">-1</span> &amp;&amp; index !== <span class="hljs-keyword">this</span>.length - <span class="hljs-number">1</span> ) {
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.at( index + <span class="hljs-number">1</span> );
			}
		},

		<span class="hljs-attr">prev</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> revision </span>) </span>{
			<span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>.indexOf( revision );

			<span class="hljs-keyword">if</span> ( index !== <span class="hljs-number">-1</span> &amp;&amp; index !== <span class="hljs-number">0</span> ) {
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.at( index - <span class="hljs-number">1</span> );
			}
		}
	});

	revisions.model.Field = Backbone.Model.extend({});

	revisions.model.Fields = Backbone.Collection.extend({
		<span class="hljs-attr">model</span>: revisions.model.Field
	});

	revisions.model.Diff = Backbone.Model.extend({
		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> fields = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'fields'</span>);
			<span class="hljs-keyword">this</span>.unset(<span class="hljs-string">'fields'</span>);

			<span class="hljs-keyword">this</span>.fields = <span class="hljs-keyword">new</span> revisions.model.Fields( fields );
		}
	});

	revisions.model.Diffs = Backbone.Collection.extend({
		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> models, options </span>) </span>{
			_.bindAll( <span class="hljs-keyword">this</span>, <span class="hljs-string">'getClosestUnloaded'</span> );
			<span class="hljs-keyword">this</span>.loadAll = _.once( <span class="hljs-keyword">this</span>._loadAll );
			<span class="hljs-keyword">this</span>.revisions = options.revisions;
			<span class="hljs-keyword">this</span>.postId = options.postId;
			<span class="hljs-keyword">this</span>.requests  = {};
		},

		<span class="hljs-attr">model</span>: revisions.model.Diff,

		<span class="hljs-attr">ensure</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id, context </span>) </span>{
			<span class="hljs-keyword">var</span> diff     = <span class="hljs-keyword">this</span>.get( id ),
				request  = <span class="hljs-keyword">this</span>.requests[ id ],
				deferred = $.Deferred(),
				ids      = {},
				<span class="hljs-keyword">from</span>     = id.split(<span class="hljs-string">':'</span>)[<span class="hljs-number">0</span>],
				to       = id.split(<span class="hljs-string">':'</span>)[<span class="hljs-number">1</span>];
			ids[id] = <span class="hljs-literal">true</span>;

			wp.revisions.log( <span class="hljs-string">'ensure'</span>, id );

			<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'ensure'</span>, ids, <span class="hljs-keyword">from</span>, to, deferred.promise() );

			<span class="hljs-keyword">if</span> ( diff ) {
				deferred.resolveWith( context, [ diff ] );
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'ensure:load'</span>, ids, <span class="hljs-keyword">from</span>, to, deferred.promise() );
				_.each( ids, _.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Remove anything that has an ongoing request</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.requests[ id ] ) {
						<span class="hljs-keyword">delete</span> ids[ id ];
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Remove anything we already have</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.get( id ) ) {
						<span class="hljs-keyword">delete</span> ids[ id ];
					}
				}, <span class="hljs-keyword">this</span> ) );
				<span class="hljs-keyword">if</span> ( ! request ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Always include the ID that started this ensure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					ids[ id ] = <span class="hljs-literal">true</span>;
					request   = <span class="hljs-keyword">this</span>.load( _.keys( ids ) );
				}

				request.done( _.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					deferred.resolveWith( context, [ <span class="hljs-keyword">this</span>.get( id ) ] );
				}, <span class="hljs-keyword">this</span> ) ).fail( _.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					deferred.reject();
				}) );
			}

			<span class="hljs-keyword">return</span> deferred.promise();
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Returns an array of proximal diffs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		getClosestUnloaded: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> ids, centerId </span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">return</span> _.chain([<span class="hljs-number">0</span>].concat( ids )).initial().zip( ids ).sortBy( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> pair </span>) </span>{
				<span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.abs( centerId - pair[<span class="hljs-number">1</span>] );
			}).map( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> pair </span>) </span>{
				<span class="hljs-keyword">return</span> pair.join(<span class="hljs-string">':'</span>);
			}).filter( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> diffId </span>) </span>{
				<span class="hljs-keyword">return</span> _.isUndefined( self.get( diffId ) ) &amp;&amp; ! self.requests[ diffId ];
			}).value();
		},

		<span class="hljs-attr">_loadAll</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> allRevisionIds, centerId, num </span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, deferred = $.Deferred(),
				diffs = _.first( <span class="hljs-keyword">this</span>.getClosestUnloaded( allRevisionIds, centerId ), num );
			<span class="hljs-keyword">if</span> ( _.size( diffs ) &gt; <span class="hljs-number">0</span> ) {
				<span class="hljs-keyword">this</span>.load( diffs ).done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					self._loadAll( allRevisionIds, centerId, num ).done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
						deferred.resolve();
					});
				}).fail( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> === num ) { <span class="hljs-comment">// Already tried 1. This just isn't working. Give up.</span>
						deferred.reject();
					} <span class="hljs-keyword">else</span> { <span class="hljs-comment">// Request fewer diffs this time</span>
						self._loadAll( allRevisionIds, centerId, <span class="hljs-built_in">Math</span>.ceil( num / <span class="hljs-number">2</span> ) ).done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
							deferred.resolve();
						});
					}
				});
			} <span class="hljs-keyword">else</span> {
				deferred.resolve();
			}
			<span class="hljs-keyword">return</span> deferred;
		},

		<span class="hljs-attr">load</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> comparisons </span>) </span>{
			wp.revisions.log( <span class="hljs-string">'load'</span>, comparisons );</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Our collection should only ever grow, never shrink, so remove: false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fetch({ <span class="hljs-attr">data</span>: { <span class="hljs-attr">compare</span>: comparisons }, <span class="hljs-attr">remove</span>: <span class="hljs-literal">false</span> }).done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				wp.revisions.log( <span class="hljs-string">'load:complete'</span>, comparisons );
			});
		},

		<span class="hljs-attr">sync</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> method, model, options </span>) </span>{
			<span class="hljs-keyword">if</span> ( <span class="hljs-string">'read'</span> === method ) {
				options = options || {};
				options.context = <span class="hljs-keyword">this</span>;
				options.data = _.extend( options.data || {}, {
					<span class="hljs-attr">action</span>: <span class="hljs-string">'get-revision-diffs'</span>,
					<span class="hljs-attr">post_id</span>: <span class="hljs-keyword">this</span>.postId
				});

				<span class="hljs-keyword">var</span> deferred = wp.ajax.send( options ),
					requests = <span class="hljs-keyword">this</span>.requests;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Record that we’re requesting each diff.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( options.data.compare ) {
					_.each( options.data.compare, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id </span>) </span>{
						requests[ id ] = deferred;
					});
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>When the request completes, clear the stored request.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				deferred.always( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">if</span> ( options.data.compare ) {
						_.each( options.data.compare, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id </span>) </span>{
							<span class="hljs-keyword">delete</span> requests[ id ];
						});
					}
				});

				<span class="hljs-keyword">return</span> deferred;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Otherwise, fall back to <code>Backbone.sync()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> Backbone.Model.prototype.sync.apply( <span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span> );
			}
		}
	});


	<span class="hljs-comment">/**
	 * wp.revisions.model.FrameState
	 *
	 * The frame state.
	 *
	 * @see wp.revisions.view.Frame
	 *
	 * @param {object}                    attributes        Model attributes - none are required.
	 * @param {object}                    options           Options for the model.
	 * @param {revisions.model.Revisions} options.revisions A collection of revisions.
	 */</span>
	revisions.model.FrameState = Backbone.Model.extend({
		<span class="hljs-attr">defaults</span>: {
			<span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">error</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">compareTwoMode</span>: <span class="hljs-literal">false</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> attributes, options </span>) </span>{
			<span class="hljs-keyword">var</span> state = <span class="hljs-keyword">this</span>.get( <span class="hljs-string">'initialDiffState'</span> );
			_.bindAll( <span class="hljs-keyword">this</span>, <span class="hljs-string">'receiveDiff'</span> );
			<span class="hljs-keyword">this</span>._debouncedEnsureDiff = _.debounce( <span class="hljs-keyword">this</span>._ensureDiff, <span class="hljs-number">200</span> );

			<span class="hljs-keyword">this</span>.revisions = options.revisions;

			<span class="hljs-keyword">this</span>.diffs = <span class="hljs-keyword">new</span> revisions.model.Diffs( [], {
				<span class="hljs-attr">revisions</span>: <span class="hljs-keyword">this</span>.revisions,
				<span class="hljs-attr">postId</span>: <span class="hljs-keyword">this</span>.get( <span class="hljs-string">'postId'</span> )
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set the initial diffs collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.diffs.set( <span class="hljs-keyword">this</span>.get( <span class="hljs-string">'diffData'</span> ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Set up internal listeners</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>, <span class="hljs-string">'change:from'</span>, <span class="hljs-keyword">this</span>.changeRevisionHandler );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>, <span class="hljs-string">'change:to'</span>, <span class="hljs-keyword">this</span>.changeRevisionHandler );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>, <span class="hljs-string">'change:compareTwoMode'</span>, <span class="hljs-keyword">this</span>.changeMode );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>, <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">this</span>.updatedRevisions );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.diffs, <span class="hljs-string">'ensure:load'</span>, <span class="hljs-keyword">this</span>.updateLoadingStatus );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>, <span class="hljs-string">'update:diff'</span>, <span class="hljs-keyword">this</span>.updateLoadingStatus );</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Set the initial revisions, baseUrl, and mode as provided through attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
			<span class="hljs-keyword">this</span>.set( {
				<span class="hljs-attr">to</span> : <span class="hljs-keyword">this</span>.revisions.get( state.to ),
				<span class="hljs-attr">from</span> : <span class="hljs-keyword">this</span>.revisions.get( state.from ),
				<span class="hljs-attr">compareTwoMode</span> : state.compareTwoMode
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Start the router if browser supports History API</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-built_in">window</span>.history &amp;&amp; <span class="hljs-built_in">window</span>.history.pushState ) {
				<span class="hljs-keyword">this</span>.router = <span class="hljs-keyword">new</span> revisions.Router({ <span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span> });
				<span class="hljs-keyword">if</span> ( Backbone.History.started ) {
					Backbone.history.stop();
				}
				Backbone.history.start({ <span class="hljs-attr">pushState</span>: <span class="hljs-literal">true</span> });
			}
		},

		<span class="hljs-attr">updateLoadingStatus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.set( <span class="hljs-string">'error'</span>, <span class="hljs-literal">false</span> );
			<span class="hljs-keyword">this</span>.set( <span class="hljs-string">'loading'</span>, ! <span class="hljs-keyword">this</span>.diff() );
		},

		<span class="hljs-attr">changeMode</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model, value </span>) </span>{
			<span class="hljs-keyword">var</span> toIndex = <span class="hljs-keyword">this</span>.revisions.indexOf( <span class="hljs-keyword">this</span>.get( <span class="hljs-string">'to'</span> ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>If we were on the first revision before switching to two-handled mode,
bump the ‘to’ position over one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( value &amp;&amp; <span class="hljs-number">0</span> === toIndex ) {
				<span class="hljs-keyword">this</span>.set({
					<span class="hljs-attr">from</span>: <span class="hljs-keyword">this</span>.revisions.at( toIndex ),
					<span class="hljs-attr">to</span>:   <span class="hljs-keyword">this</span>.revisions.at( toIndex + <span class="hljs-number">1</span> )
				});
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>When switching back to single-handled mode, reset ‘from’ model to
one position before the ‘to’ model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( ! value &amp;&amp; <span class="hljs-number">0</span> !== toIndex ) { <span class="hljs-comment">// '! value' means switching to single-handled mode</span>
				<span class="hljs-keyword">this</span>.set({
					<span class="hljs-attr">from</span>: <span class="hljs-keyword">this</span>.revisions.at( toIndex - <span class="hljs-number">1</span> ),
					<span class="hljs-attr">to</span>:   <span class="hljs-keyword">this</span>.revisions.at( toIndex )
				});
			}
		},

		<span class="hljs-attr">updatedRevisions</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> from, to </span>) </span>{
			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.get( <span class="hljs-string">'compareTwoMode'</span> ) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>TODO: compare-two loading strategy</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.diffs.loadAll( <span class="hljs-keyword">this</span>.revisions.pluck(<span class="hljs-string">'id'</span>), to.id, <span class="hljs-number">40</span> );
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Fetch the currently loaded diff.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		diff: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.diffs.get( <span class="hljs-keyword">this</span>._diffId );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>So long as <code>from</code> and <code>to</code> are changed at the same time, the diff
will only be updated once. This is because Backbone updates all of
the changed attributes in <code>set</code>, and then fires the <code>change</code> events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		updateDiff: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> options </span>) </span>{
			<span class="hljs-keyword">var</span> <span class="hljs-keyword">from</span>, to, diffId, diff;

			options = options || {};
			<span class="hljs-keyword">from</span> = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'from'</span>);
			to = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'to'</span>);
			diffId = ( <span class="hljs-keyword">from</span> ? <span class="hljs-keyword">from</span>.id : <span class="hljs-number">0</span> ) + <span class="hljs-string">':'</span> + to.id;</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Check if we’re actually changing the diff id.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._diffId === diffId ) {
				<span class="hljs-keyword">return</span> $.Deferred().reject().promise();
			}

			<span class="hljs-keyword">this</span>._diffId = diffId;
			<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">from</span>, to );

			diff = <span class="hljs-keyword">this</span>.diffs.get( diffId );</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>If we already have the diff, then immediately trigger the update.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( diff ) {
				<span class="hljs-keyword">this</span>.receiveDiff( diff );
				<span class="hljs-keyword">return</span> $.Deferred().resolve().promise();</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Otherwise, fetch the diff.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">if</span> ( options.immediate ) {
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._ensureDiff();
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">this</span>._debouncedEnsureDiff();
					<span class="hljs-keyword">return</span> $.Deferred().reject().promise();
				}
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>A simple wrapper around <code>updateDiff</code> to prevent the change event’s
parameters from being passed through.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		changeRevisionHandler: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.updateDiff();
		},

		<span class="hljs-attr">receiveDiff</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> diff </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Did we actually get a diff?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( _.isUndefined( diff ) || _.isUndefined( diff.id ) ) {
				<span class="hljs-keyword">this</span>.set({
					<span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>,
					<span class="hljs-attr">error</span>: <span class="hljs-literal">true</span>
				});
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._diffId === diff.id ) { <span class="hljs-comment">// Make sure the current diff didn't change</span>
				<span class="hljs-keyword">this</span>.trigger( <span class="hljs-string">'update:diff'</span>, diff );
			}
		},

		<span class="hljs-attr">_ensureDiff</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.diffs.ensure( <span class="hljs-keyword">this</span>._diffId, <span class="hljs-keyword">this</span> ).always( <span class="hljs-keyword">this</span>.receiveDiff );
		}
	});


	<span class="hljs-comment">/**
	 * ========================================================================
	 * VIEWS
	 * ========================================================================
	 */</span>

	<span class="hljs-comment">/**
	 * wp.revisions.view.Frame
	 *
	 * Top level frame that orchestrates the revisions experience.
	 *
	 * @param {object}                     options       The options hash for the view.
	 * @param {revisions.model.FrameState} options.model The frame state model.
	 */</span>
	revisions.view.Frame = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions'</span>,
		<span class="hljs-attr">template</span>: wp.template(<span class="hljs-string">'revisions-frame'</span>),

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'update:diff'</span>, <span class="hljs-keyword">this</span>.renderDiff );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:compareTwoMode'</span>, <span class="hljs-keyword">this</span>.updateCompareTwoMode );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:loading'</span>, <span class="hljs-keyword">this</span>.updateLoadingStatus );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:error'</span>, <span class="hljs-keyword">this</span>.updateErrorStatus );

			<span class="hljs-keyword">this</span>.views.set( <span class="hljs-string">'.revisions-control-frame'</span>, <span class="hljs-keyword">new</span> revisions.view.Controls({
				<span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span>.model
			}) );
		},

		<span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			wp.Backbone.View.prototype.render.apply( <span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span> );

			$(<span class="hljs-string">'html'</span>).css( <span class="hljs-string">'overflow-y'</span>, <span class="hljs-string">'scroll'</span> );
			$(<span class="hljs-string">'#wpbody-content .wrap'</span>).append( <span class="hljs-keyword">this</span>.el );
			<span class="hljs-keyword">this</span>.updateCompareTwoMode();
			<span class="hljs-keyword">this</span>.renderDiff( <span class="hljs-keyword">this</span>.model.diff() );
			<span class="hljs-keyword">this</span>.views.ready();

			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
		},

		<span class="hljs-attr">renderDiff</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> diff </span>) </span>{
			<span class="hljs-keyword">this</span>.views.set( <span class="hljs-string">'.revisions-diff-frame'</span>, <span class="hljs-keyword">new</span> revisions.view.Diff({
				<span class="hljs-attr">model</span>: diff
			}) );
		},

		<span class="hljs-attr">updateLoadingStatus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$el.toggleClass( <span class="hljs-string">'loading'</span>, <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'loading'</span>) );
		},

		<span class="hljs-attr">updateErrorStatus</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$el.toggleClass( <span class="hljs-string">'diff-error'</span>, <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'error'</span>) );
		},

		<span class="hljs-attr">updateCompareTwoMode</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$el.toggleClass( <span class="hljs-string">'comparing-two-revisions'</span>, <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'compareTwoMode'</span>) );
		}
	});

	<span class="hljs-comment">/**
	 * wp.revisions.view.Controls
	 *
	 * The controls view.
	 *
	 * Contains the revision slider, previous/next buttons, the meta info and the compare checkbox.
	 */</span>
	revisions.view.Controls = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-controls'</span>,

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			_.bindAll( <span class="hljs-keyword">this</span>, <span class="hljs-string">'setWidth'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Add the button view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.Buttons({
				<span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span>.model
			}) );</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Add the checkbox view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.Checkbox({
				<span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span>.model
			}) );</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Prep the slider model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">var</span> slider = <span class="hljs-keyword">new</span> revisions.model.Slider({
				<span class="hljs-attr">frame</span>: <span class="hljs-keyword">this</span>.model,
				<span class="hljs-attr">revisions</span>: <span class="hljs-keyword">this</span>.model.revisions
			}),</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Prep the tooltip model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			tooltip = <span class="hljs-keyword">new</span> revisions.model.Tooltip({
				<span class="hljs-attr">frame</span>: <span class="hljs-keyword">this</span>.model,
				<span class="hljs-attr">revisions</span>: <span class="hljs-keyword">this</span>.model.revisions,
				<span class="hljs-attr">slider</span>: slider
			});</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Add the tooltip view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.Tooltip({
				<span class="hljs-attr">model</span>: tooltip
			}) );</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Add the tickmarks view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.Tickmarks({
				<span class="hljs-attr">model</span>: tooltip
			}) );</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Add the slider view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.Slider({
				<span class="hljs-attr">model</span>: slider
			}) );</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Add the Metabox view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.Metabox({
				<span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span>.model
			}) );
		},

		<span class="hljs-attr">ready</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.top = <span class="hljs-keyword">this</span>.$el.offset().top;
			<span class="hljs-keyword">this</span>.window = $(<span class="hljs-built_in">window</span>);
			<span class="hljs-keyword">this</span>.window.on( <span class="hljs-string">'scroll.wp.revisions'</span>, {<span class="hljs-attr">controls</span>: <span class="hljs-keyword">this</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
				<span class="hljs-keyword">var</span> controls  = e.data.controls,
					container = controls.$el.parent(),
					scrolled  = controls.window.scrollTop(),
					frame     = controls.views.parent;

				<span class="hljs-keyword">if</span> ( scrolled &gt;= controls.top ) {
					<span class="hljs-keyword">if</span> ( ! frame.$el.hasClass(<span class="hljs-string">'pinned'</span>) ) {
						controls.setWidth();
						container.css(<span class="hljs-string">'height'</span>, container.height() + <span class="hljs-string">'px'</span> );
						controls.window.on(<span class="hljs-string">'resize.wp.revisions.pinning click.wp.revisions.pinning'</span>, {<span class="hljs-attr">controls</span>: controls}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
							e.data.controls.setWidth();
						});
					}
					frame.$el.addClass(<span class="hljs-string">'pinned'</span>);
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( frame.$el.hasClass(<span class="hljs-string">'pinned'</span>) ) {
					controls.window.off(<span class="hljs-string">'.wp.revisions.pinning'</span>);
					controls.$el.css(<span class="hljs-string">'width'</span>, <span class="hljs-string">'auto'</span>);
					frame.$el.removeClass(<span class="hljs-string">'pinned'</span>);
					container.css(<span class="hljs-string">'height'</span>, <span class="hljs-string">'auto'</span>);
					controls.top = controls.$el.offset().top;
				} <span class="hljs-keyword">else</span> {
					controls.top = controls.$el.offset().top;
				}
			});
		},

		<span class="hljs-attr">setWidth</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$el.css(<span class="hljs-string">'width'</span>, <span class="hljs-keyword">this</span>.$el.parent().width() + <span class="hljs-string">'px'</span>);
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>The tickmarks view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Tickmarks = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-tickmarks'</span>,
		<span class="hljs-attr">direction</span>: isRtl ? <span class="hljs-string">'right'</span> : <span class="hljs-string">'left'</span>,

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:revision'</span>, <span class="hljs-keyword">this</span>.reportTickPosition );
		},

		<span class="hljs-attr">reportTickPosition</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> model, revision </span>) </span>{
			<span class="hljs-keyword">var</span> offset, thisOffset, parentOffset, tick, index = <span class="hljs-keyword">this</span>.model.revisions.indexOf( revision );
			thisOffset = <span class="hljs-keyword">this</span>.$el.allOffsets();
			parentOffset = <span class="hljs-keyword">this</span>.$el.parent().allOffsets();
			<span class="hljs-keyword">if</span> ( index === <span class="hljs-keyword">this</span>.model.revisions.length - <span class="hljs-number">1</span> ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Last one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				offset = {
					<span class="hljs-attr">rightPlusWidth</span>: thisOffset.left - parentOffset.left + <span class="hljs-number">1</span>,
					<span class="hljs-attr">leftPlusWidth</span>: thisOffset.right - parentOffset.right + <span class="hljs-number">1</span>
				};
			} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Normal tick</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				tick = <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'div:nth-of-type('</span> + (index + <span class="hljs-number">1</span>) + <span class="hljs-string">')'</span>);
				offset = tick.allPositions();
				_.extend( offset, {
					<span class="hljs-attr">left</span>: offset.left + thisOffset.left - parentOffset.left,
					<span class="hljs-attr">right</span>: offset.right + thisOffset.right - parentOffset.right
				});
				_.extend( offset, {
					<span class="hljs-attr">leftPlusWidth</span>: offset.left + tick.outerWidth(),
					<span class="hljs-attr">rightPlusWidth</span>: offset.right + tick.outerWidth()
				});
			}
			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">offset</span>: offset });
		},

		<span class="hljs-attr">ready</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> tickCount, tickWidth;
			tickCount = <span class="hljs-keyword">this</span>.model.revisions.length - <span class="hljs-number">1</span>;
			tickWidth = <span class="hljs-number">1</span> / tickCount;
			<span class="hljs-keyword">this</span>.$el.css(<span class="hljs-string">'width'</span>, ( <span class="hljs-keyword">this</span>.model.revisions.length * <span class="hljs-number">50</span> ) + <span class="hljs-string">'px'</span>);

			_(tickCount).times( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> index </span>)</span>{
				<span class="hljs-keyword">this</span>.$el.append( <span class="hljs-string">'&lt;div style="'</span> + <span class="hljs-keyword">this</span>.direction + <span class="hljs-string">': '</span> + ( <span class="hljs-number">100</span> * tickWidth * index ) + <span class="hljs-string">'%"&gt;&lt;/div&gt;'</span> );
			}, <span class="hljs-keyword">this</span> );
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>The metabox view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Metabox = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-meta'</span>,

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Add the ‘from’ view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.MetaFrom({
				<span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span>.model,
				<span class="hljs-attr">className</span>: <span class="hljs-string">'diff-meta diff-meta-from'</span>
			}) );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Add the ‘to’ view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.views.add( <span class="hljs-keyword">new</span> revisions.view.MetaTo({
				<span class="hljs-attr">model</span>: <span class="hljs-keyword">this</span>.model
			}) );
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>The revision meta view (to be extended)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Meta = wp.Backbone.View.extend({
		<span class="hljs-attr">template</span>: wp.template(<span class="hljs-string">'revisions-meta'</span>),

		<span class="hljs-attr">events</span>: {
			<span class="hljs-string">'click .restore-revision'</span>: <span class="hljs-string">'restoreRevision'</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">this</span>.render );
		},

		<span class="hljs-attr">prepare</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">return</span> _.extend( <span class="hljs-keyword">this</span>.model.toJSON()[<span class="hljs-keyword">this</span>.type] || {}, {
				<span class="hljs-attr">type</span>: <span class="hljs-keyword">this</span>.type
			});
		},

		<span class="hljs-attr">restoreRevision</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-built_in">document</span>.location = <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'to'</span>).attributes.restoreUrl;
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>The revision meta ‘from’ view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.MetaFrom = revisions.view.Meta.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'diff-meta diff-meta-from'</span>,
		<span class="hljs-attr">type</span>: <span class="hljs-string">'from'</span>
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>The revision meta ‘to’ view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.MetaTo = revisions.view.Meta.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'diff-meta diff-meta-to'</span>,
		<span class="hljs-attr">type</span>: <span class="hljs-string">'to'</span>
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>The checkbox view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Checkbox = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-checkbox'</span>,
		<span class="hljs-attr">template</span>: wp.template(<span class="hljs-string">'revisions-checkbox'</span>),

		<span class="hljs-attr">events</span>: {
			<span class="hljs-string">'click .compare-two-revisions'</span>: <span class="hljs-string">'compareTwoToggle'</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:compareTwoMode'</span>, <span class="hljs-keyword">this</span>.updateCompareTwoMode );
		},

		<span class="hljs-attr">ready</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.model.revisions.length &lt; <span class="hljs-number">3</span> ) {
				$(<span class="hljs-string">'.revision-toggle-compare-mode'</span>).hide();
			}
		},

		<span class="hljs-attr">updateCompareTwoMode</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$(<span class="hljs-string">'.compare-two-revisions'</span>).prop( <span class="hljs-string">'checked'</span>, <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'compareTwoMode'</span>) );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Toggle the compare two mode feature when the compare two checkbox is checked.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		compareTwoToggle: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Activate compare two mode?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">compareTwoMode</span>: $(<span class="hljs-string">'.compare-two-revisions'</span>).prop(<span class="hljs-string">'checked'</span>) });
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>The tooltip view.
Encapsulates the tooltip.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Tooltip = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-tooltip'</span>,
		<span class="hljs-attr">template</span>: wp.template(<span class="hljs-string">'revisions-meta'</span>),

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:offset'</span>, <span class="hljs-keyword">this</span>.render );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:hovering'</span>, <span class="hljs-keyword">this</span>.toggleVisibility );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:scrubbing'</span>, <span class="hljs-keyword">this</span>.toggleVisibility );
		},

		<span class="hljs-attr">prepare</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">if</span> ( _.isNull( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'revision'</span>) ) ) {
				<span class="hljs-keyword">return</span>;
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> _.extend( { <span class="hljs-attr">type</span>: <span class="hljs-string">'tooltip'</span> }, {
					<span class="hljs-attr">attributes</span>: <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'revision'</span>).toJSON()
				});
			}
		},

		<span class="hljs-attr">render</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> otherDirection,
				direction,
				directionVal,
				flipped,
				css      = {},
				position = <span class="hljs-keyword">this</span>.model.revisions.indexOf( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'revision'</span>) ) + <span class="hljs-number">1</span>;

			flipped = ( position / <span class="hljs-keyword">this</span>.model.revisions.length ) &gt; <span class="hljs-number">0.5</span>;
			<span class="hljs-keyword">if</span> ( isRtl ) {
				direction = flipped ? <span class="hljs-string">'left'</span> : <span class="hljs-string">'right'</span>;
				directionVal = flipped ? <span class="hljs-string">'leftPlusWidth'</span> : direction;
			} <span class="hljs-keyword">else</span> {
				direction = flipped ? <span class="hljs-string">'right'</span> : <span class="hljs-string">'left'</span>;
				directionVal = flipped ? <span class="hljs-string">'rightPlusWidth'</span> : direction;
			}
			otherDirection = <span class="hljs-string">'right'</span> === direction ? <span class="hljs-string">'left'</span>: <span class="hljs-string">'right'</span>;
			wp.Backbone.View.prototype.render.apply( <span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span> );
			css[direction] = <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'offset'</span>)[directionVal] + <span class="hljs-string">'px'</span>;
			css[otherDirection] = <span class="hljs-string">''</span>;
			<span class="hljs-keyword">this</span>.$el.toggleClass( <span class="hljs-string">'flipped'</span>, flipped ).css( css );
		},

		<span class="hljs-attr">visible</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.model.get( <span class="hljs-string">'scrubbing'</span> ) || <span class="hljs-keyword">this</span>.model.get( <span class="hljs-string">'hovering'</span> );
		},

		<span class="hljs-attr">toggleVisibility</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.visible() ) {
				<span class="hljs-keyword">this</span>.$el.stop().show().fadeTo( <span class="hljs-number">100</span> - <span class="hljs-keyword">this</span>.el.style.opacity * <span class="hljs-number">100</span>, <span class="hljs-number">1</span> );
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.$el.stop().fadeTo( <span class="hljs-keyword">this</span>.el.style.opacity * <span class="hljs-number">300</span>, <span class="hljs-number">0</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ $(<span class="hljs-keyword">this</span>).hide(); } );
			}
			<span class="hljs-keyword">return</span>;
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>The buttons view.
Encapsulates all of the configuration for the previous/next buttons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Buttons = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-buttons'</span>,
		<span class="hljs-attr">template</span>: wp.template(<span class="hljs-string">'revisions-buttons'</span>),

		<span class="hljs-attr">events</span>: {
			<span class="hljs-string">'click .revisions-next .button'</span>: <span class="hljs-string">'nextRevision'</span>,
			<span class="hljs-string">'click .revisions-previous .button'</span>: <span class="hljs-string">'previousRevision'</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'update:revisions'</span>, <span class="hljs-keyword">this</span>.disabledButtonCheck );
		},

		<span class="hljs-attr">ready</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.disabledButtonCheck();
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Go to a specific model index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		gotoModel: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> toIndex </span>) </span>{
			<span class="hljs-keyword">var</span> attributes = {
				<span class="hljs-attr">to</span>: <span class="hljs-keyword">this</span>.model.revisions.at( toIndex )
			};</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>If we’re at the first revision, unset ‘from’.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( toIndex ) {
				attributes.from = <span class="hljs-keyword">this</span>.model.revisions.at( toIndex - <span class="hljs-number">1</span> );
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.model.unset(<span class="hljs-string">'from'</span>, { <span class="hljs-attr">silent</span>: <span class="hljs-literal">true</span> });
			}

			<span class="hljs-keyword">this</span>.model.set( attributes );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Go to the ‘next’ revision</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		nextRevision: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> toIndex = <span class="hljs-keyword">this</span>.model.revisions.indexOf( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'to'</span>) ) + <span class="hljs-number">1</span>;
			<span class="hljs-keyword">this</span>.gotoModel( toIndex );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Go to the ‘previous’ revision</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		previousRevision: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> toIndex = <span class="hljs-keyword">this</span>.model.revisions.indexOf( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'to'</span>) ) - <span class="hljs-number">1</span>;
			<span class="hljs-keyword">this</span>.gotoModel( toIndex );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Check to see if the Previous or Next buttons need to be disabled or enabled.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		disabledButtonCheck: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> maxVal   = <span class="hljs-keyword">this</span>.model.revisions.length - <span class="hljs-number">1</span>,
				minVal   = <span class="hljs-number">0</span>,
				next     = $(<span class="hljs-string">'.revisions-next .button'</span>),
				previous = $(<span class="hljs-string">'.revisions-previous .button'</span>),
				val      = <span class="hljs-keyword">this</span>.model.revisions.indexOf( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'to'</span>) );</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Disable “Next” button if you’re on the last node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			next.prop( <span class="hljs-string">'disabled'</span>, ( maxVal === val ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Disable “Previous” button if you’re on the first node.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			previous.prop( <span class="hljs-string">'disabled'</span>, ( minVal === val ) );
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>The slider view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Slider = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'wp-slider'</span>,
		<span class="hljs-attr">direction</span>: isRtl ? <span class="hljs-string">'right'</span> : <span class="hljs-string">'left'</span>,

		<span class="hljs-attr">events</span>: {
			<span class="hljs-string">'mousemove'</span> : <span class="hljs-string">'mouseMove'</span>
		},

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			_.bindAll( <span class="hljs-keyword">this</span>, <span class="hljs-string">'start'</span>, <span class="hljs-string">'slide'</span>, <span class="hljs-string">'stop'</span>, <span class="hljs-string">'mouseMove'</span>, <span class="hljs-string">'mouseEnter'</span>, <span class="hljs-string">'mouseLeave'</span> );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'update:slider'</span>, <span class="hljs-keyword">this</span>.applySliderSettings );
		},

		<span class="hljs-attr">ready</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$el.css(<span class="hljs-string">'width'</span>, ( <span class="hljs-keyword">this</span>.model.revisions.length * <span class="hljs-number">50</span> ) + <span class="hljs-string">'px'</span>);
			<span class="hljs-keyword">this</span>.$el.slider( _.extend( <span class="hljs-keyword">this</span>.model.toJSON(), {
				<span class="hljs-attr">start</span>: <span class="hljs-keyword">this</span>.start,
				<span class="hljs-attr">slide</span>: <span class="hljs-keyword">this</span>.slide,
				<span class="hljs-attr">stop</span>:  <span class="hljs-keyword">this</span>.stop
			}) );

			<span class="hljs-keyword">this</span>.$el.hoverIntent({
				<span class="hljs-attr">over</span>: <span class="hljs-keyword">this</span>.mouseEnter,
				<span class="hljs-attr">out</span>: <span class="hljs-keyword">this</span>.mouseLeave,
				<span class="hljs-attr">timeout</span>: <span class="hljs-number">800</span>
			});

			<span class="hljs-keyword">this</span>.applySliderSettings();
		},

		<span class="hljs-attr">mouseMove</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
			<span class="hljs-keyword">var</span> zoneCount         = <span class="hljs-keyword">this</span>.model.revisions.length - <span class="hljs-number">1</span>, <span class="hljs-comment">// One fewer zone than models</span>
				sliderFrom        = <span class="hljs-keyword">this</span>.$el.allOffsets()[<span class="hljs-keyword">this</span>.direction], <span class="hljs-comment">// "From" edge of slider</span>
				sliderWidth       = <span class="hljs-keyword">this</span>.$el.width(), <span class="hljs-comment">// Width of slider</span>
				tickWidth         = sliderWidth / zoneCount, <span class="hljs-comment">// Calculated width of zone</span>
				actualX           = ( isRtl ? $(<span class="hljs-built_in">window</span>).width() - e.pageX : e.pageX ) - sliderFrom, <span class="hljs-comment">// Flipped for RTL - sliderFrom;</span>
				currentModelIndex = <span class="hljs-built_in">Math</span>.floor( ( actualX  + ( tickWidth / <span class="hljs-number">2</span> )  ) / tickWidth ); <span class="hljs-comment">// Calculate the model index</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Ensure sane value for currentModelIndex.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( currentModelIndex &lt; <span class="hljs-number">0</span> ) {
				currentModelIndex = <span class="hljs-number">0</span>;
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( currentModelIndex &gt;= <span class="hljs-keyword">this</span>.model.revisions.length ) {
				currentModelIndex = <span class="hljs-keyword">this</span>.model.revisions.length - <span class="hljs-number">1</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Update the tooltip mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">hoveredRevision</span>: <span class="hljs-keyword">this</span>.model.revisions.at( currentModelIndex ) });
		},

		<span class="hljs-attr">mouseLeave</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">hovering</span>: <span class="hljs-literal">false</span> });
		},

		<span class="hljs-attr">mouseEnter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">hovering</span>: <span class="hljs-literal">true</span> });
		},

		<span class="hljs-attr">applySliderSettings</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$el.slider( _.pick( <span class="hljs-keyword">this</span>.model.toJSON(), <span class="hljs-string">'value'</span>, <span class="hljs-string">'values'</span>, <span class="hljs-string">'range'</span> ) );
			<span class="hljs-keyword">var</span> handles = <span class="hljs-keyword">this</span>.$(<span class="hljs-string">'a.ui-slider-handle'</span>);

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'compareTwoMode'</span>) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>in RTL mode the ‘left handle’ is the second in the slider, ‘right’ is first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				handles.first()
					.toggleClass( <span class="hljs-string">'to-handle'</span>, !! isRtl )
					.toggleClass( <span class="hljs-string">'from-handle'</span>, ! isRtl );
				handles.last()
					.toggleClass( <span class="hljs-string">'from-handle'</span>, !! isRtl )
					.toggleClass( <span class="hljs-string">'to-handle'</span>, ! isRtl );
			} <span class="hljs-keyword">else</span> {
				handles.removeClass(<span class="hljs-string">'from-handle to-handle'</span>);
			}
		},

		<span class="hljs-attr">start</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event, ui </span>) </span>{
			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">scrubbing</span>: <span class="hljs-literal">true</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Track the mouse position to enable smooth dragging,
overrides default jQuery UI step behavior.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$( <span class="hljs-built_in">window</span> ).on( <span class="hljs-string">'mousemove.wp.revisions'</span>, { <span class="hljs-attr">view</span>: <span class="hljs-keyword">this</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				<span class="hljs-keyword">var</span> handles,
					view              = e.data.view,
					leftDragBoundary  = view.$el.offset().left,
					sliderOffset      = leftDragBoundary,
					sliderRightEdge   = leftDragBoundary + view.$el.width(),
					rightDragBoundary = sliderRightEdge,
					leftDragReset     = <span class="hljs-string">'0'</span>,
					rightDragReset    = <span class="hljs-string">'100%'</span>,
					handle            = $( ui.handle );</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>In two handle mode, ensure handles can’t be dragged past each other.
Adjust left/right boundaries and reset points.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( view.model.get(<span class="hljs-string">'compareTwoMode'</span>) ) {
					handles = handle.parent().find(<span class="hljs-string">'.ui-slider-handle'</span>);
					<span class="hljs-keyword">if</span> ( handle.is( handles.first() ) ) { <span class="hljs-comment">// We're the left handle</span>
						rightDragBoundary = handles.last().offset().left;
						rightDragReset    = rightDragBoundary - sliderOffset;
					} <span class="hljs-keyword">else</span> { <span class="hljs-comment">// We're the right handle</span>
						leftDragBoundary = handles.first().offset().left + handles.first().width();
						leftDragReset    = leftDragBoundary - sliderOffset;
					}
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Follow mouse movements, as long as handle remains inside slider.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( e.pageX &lt; leftDragBoundary ) {
					handle.css( <span class="hljs-string">'left'</span>, leftDragReset ); <span class="hljs-comment">// Mouse to left of slider.</span>
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( e.pageX &gt; rightDragBoundary ) {
					handle.css( <span class="hljs-string">'left'</span>, rightDragReset ); <span class="hljs-comment">// Mouse to right of slider.</span>
				} <span class="hljs-keyword">else</span> {
					handle.css( <span class="hljs-string">'left'</span>, e.pageX - sliderOffset ); <span class="hljs-comment">// Mouse in slider.</span>
				}
			} );
		},

		<span class="hljs-attr">getPosition</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> position </span>) </span>{
			<span class="hljs-keyword">return</span> isRtl ? <span class="hljs-keyword">this</span>.model.revisions.length - position - <span class="hljs-number">1</span>: position;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Responds to slide events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		slide: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event, ui </span>) </span>{
			<span class="hljs-keyword">var</span> attributes, movedRevision;</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Compare two revisions mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'compareTwoMode'</span>) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Prevent sliders from occupying same spot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( ui.values[<span class="hljs-number">1</span>] === ui.values[<span class="hljs-number">0</span>] ) {
					<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
				}
				<span class="hljs-keyword">if</span> ( isRtl ) {
					ui.values.reverse();
				}
				attributes = {
					<span class="hljs-attr">from</span>: <span class="hljs-keyword">this</span>.model.revisions.at( <span class="hljs-keyword">this</span>.getPosition( ui.values[<span class="hljs-number">0</span>] ) ),
					<span class="hljs-attr">to</span>: <span class="hljs-keyword">this</span>.model.revisions.at( <span class="hljs-keyword">this</span>.getPosition( ui.values[<span class="hljs-number">1</span>] ) )
				};
			} <span class="hljs-keyword">else</span> {
				attributes = {
					<span class="hljs-attr">to</span>: <span class="hljs-keyword">this</span>.model.revisions.at( <span class="hljs-keyword">this</span>.getPosition( ui.value ) )
				};</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>If we’re at the first revision, unset ‘from’.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.getPosition( ui.value ) &gt; <span class="hljs-number">0</span> ) {
					attributes.from = <span class="hljs-keyword">this</span>.model.revisions.at( <span class="hljs-keyword">this</span>.getPosition( ui.value ) - <span class="hljs-number">1</span> );
				} <span class="hljs-keyword">else</span> {
					attributes.from = <span class="hljs-literal">undefined</span>;
				}
			}
			movedRevision = <span class="hljs-keyword">this</span>.model.revisions.at( <span class="hljs-keyword">this</span>.getPosition( ui.value ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>If we are scrubbing, a scrub to a revision is considered a hover</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'scrubbing'</span>) ) {
				attributes.hoveredRevision = movedRevision;
			}

			<span class="hljs-keyword">this</span>.model.set( attributes );
		},

		<span class="hljs-attr">stop</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			$( <span class="hljs-built_in">window</span> ).off(<span class="hljs-string">'mousemove.wp.revisions'</span>);
			<span class="hljs-keyword">this</span>.model.updateSliderSettings(); <span class="hljs-comment">// To snap us back to a tick mark</span>
			<span class="hljs-keyword">this</span>.model.set({ <span class="hljs-attr">scrubbing</span>: <span class="hljs-literal">false</span> });
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>The diff view.
This is the view for the current active diff.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.view.Diff = wp.Backbone.View.extend({
		<span class="hljs-attr">className</span>: <span class="hljs-string">'revisions-diff'</span>,
		<span class="hljs-attr">template</span>:  wp.template(<span class="hljs-string">'revisions-diff'</span>),</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Generate the options to be passed to the template.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		prepare: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">return</span> _.extend({ <span class="hljs-attr">fields</span>: <span class="hljs-keyword">this</span>.model.fields.toJSON() }, <span class="hljs-keyword">this</span>.options );
		}
	});</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>The revisions router.
Maintains the URL routes so browser URL matches state.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	revisions.Router = Backbone.Router.extend({
		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> options </span>) </span>{
			<span class="hljs-keyword">this</span>.model = options.model;</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Maintain state and history when navigating</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'update:diff'</span>, _.debounce( <span class="hljs-keyword">this</span>.updateUrl, <span class="hljs-number">250</span> ) );
			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.model, <span class="hljs-string">'change:compareTwoMode'</span>, <span class="hljs-keyword">this</span>.updateUrl );
		},

		<span class="hljs-attr">baseUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> url </span>) </span>{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'baseUrl'</span>) + url;
		},

		<span class="hljs-attr">updateUrl</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> <span class="hljs-keyword">from</span> = <span class="hljs-keyword">this</span>.model.has(<span class="hljs-string">'from'</span>) ? <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'from'</span>).id : <span class="hljs-number">0</span>,
				to   = <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'to'</span>).id;
			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.model.get(<span class="hljs-string">'compareTwoMode'</span> ) ) {
				<span class="hljs-keyword">this</span>.navigate( <span class="hljs-keyword">this</span>.baseUrl( <span class="hljs-string">'?from='</span> + <span class="hljs-keyword">from</span> + <span class="hljs-string">'&amp;to='</span> + to ), { <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> } );
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.navigate( <span class="hljs-keyword">this</span>.baseUrl( <span class="hljs-string">'?revision='</span> + to ), { <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> } );
			}
		},

		<span class="hljs-attr">handleRoute</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> a, b </span>) </span>{
			<span class="hljs-keyword">var</span> compareTwo = _.isUndefined( b );

			<span class="hljs-keyword">if</span> ( ! compareTwo ) {
				b = <span class="hljs-keyword">this</span>.model.revisions.get( a );
				a = <span class="hljs-keyword">this</span>.model.revisions.prev( b );
				b = b ? b.id : <span class="hljs-number">0</span>;
				a = a ? a.id : <span class="hljs-number">0</span>;
			}
		}
	});

	<span class="hljs-comment">/**
	 * Initialize the revisions UI for revision.php.
	 */</span>
	revisions.init = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> state;</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Bail if the current page is not revision.php.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( ! <span class="hljs-built_in">window</span>.adminpage || <span class="hljs-string">'revision-php'</span> !== <span class="hljs-built_in">window</span>.adminpage ) {
			<span class="hljs-keyword">return</span>;
		}

		state = <span class="hljs-keyword">new</span> revisions.model.FrameState({
			<span class="hljs-attr">initialDiffState</span>: {</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>wp_localize_script doesn’t stringifies ints, so cast them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				to: <span class="hljs-built_in">parseInt</span>( revisions.settings.to, <span class="hljs-number">10</span> ),
				<span class="hljs-attr">from</span>: <span class="hljs-built_in">parseInt</span>( revisions.settings.from, <span class="hljs-number">10</span> ),</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>wp_localize_script does not allow for top-level booleans so do a comparator here.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				compareTwoMode: ( revisions.settings.compareTwoMode === <span class="hljs-string">'1'</span> )
			},
			<span class="hljs-attr">diffData</span>: revisions.settings.diffData,
			<span class="hljs-attr">baseUrl</span>: revisions.settings.baseUrl,
			<span class="hljs-attr">postId</span>: <span class="hljs-built_in">parseInt</span>( revisions.settings.postId, <span class="hljs-number">10</span> )
		}, {
			<span class="hljs-attr">revisions</span>: <span class="hljs-keyword">new</span> revisions.model.Revisions( revisions.settings.revisionData )
		});

		revisions.view.frame = <span class="hljs-keyword">new</span> revisions.view.Frame({
			<span class="hljs-attr">model</span>: state
		}).render();
	};

	$( revisions.init );
}(jQuery));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
