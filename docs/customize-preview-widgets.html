<!DOCTYPE html>

<html>
<head>
  <title>customize-preview-widgets.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="bookmarklet.html">
                  bookmarklet.js
                </a>
              
                
                <a class="source" href="bookmarklet.min.html">
                  bookmarklet.min.js
                </a>
              
                
                <a class="source" href="color-picker.html">
                  color-picker.js
                </a>
              
                
                <a class="source" href="comment.html">
                  comment.js
                </a>
              
                
                <a class="source" href="common.html">
                  common.js
                </a>
              
                
                <a class="source" href="custom-background.html">
                  custom-background.js
                </a>
              
                
                <a class="source" href="custom-header.html">
                  custom-header.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-nav-menus.html">
                  customize-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-widgets.html">
                  customize-widgets.js
                </a>
              
                
                <a class="source" href="dashboard.html">
                  dashboard.js
                </a>
              
                
                <a class="source" href="edit-comments.html">
                  edit-comments.js
                </a>
              
                
                <a class="source" href="editor-expand.html">
                  editor-expand.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="farbtastic.html">
                  farbtastic.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="image-edit.html">
                  image-edit.js
                </a>
              
                
                <a class="source" href="inline-edit-post.html">
                  inline-edit-post.js
                </a>
              
                
                <a class="source" href="inline-edit-tax.html">
                  inline-edit-tax.js
                </a>
              
                
                <a class="source" href="iris.min.html">
                  iris.min.js
                </a>
              
                
                <a class="source" href="language-chooser.html">
                  language-chooser.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="media-gallery.html">
                  media-gallery.js
                </a>
              
                
                <a class="source" href="media-upload.html">
                  media-upload.js
                </a>
              
                
                <a class="source" href="media.html">
                  media.js
                </a>
              
                
                <a class="source" href="nav-menu.html">
                  nav-menu.js
                </a>
              
                
                <a class="source" href="password-strength-meter.html">
                  password-strength-meter.js
                </a>
              
                
                <a class="source" href="plugin-install.html">
                  plugin-install.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="postbox.html">
                  postbox.js
                </a>
              
                
                <a class="source" href="press-this.html">
                  press-this.js
                </a>
              
                
                <a class="source" href="revisions.html">
                  revisions.js
                </a>
              
                
                <a class="source" href="set-post-thumbnail.html">
                  set-post-thumbnail.js
                </a>
              
                
                <a class="source" href="svg-painter.html">
                  svg-painter.js
                </a>
              
                
                <a class="source" href="tags-box.html">
                  tags-box.js
                </a>
              
                
                <a class="source" href="tags-suggest.html">
                  tags-suggest.js
                </a>
              
                
                <a class="source" href="tags.html">
                  tags.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="updates.html">
                  updates.js
                </a>
              
                
                <a class="source" href="user-profile.html">
                  user-profile.js
                </a>
              
                
                <a class="source" href="user-suggest.html">
                  user-suggest.js
                </a>
              
                
                <a class="source" href="widgets.html">
                  widgets.js
                </a>
              
                
                <a class="source" href="media-audio-widget.html">
                  media-audio-widget.js
                </a>
              
                
                <a class="source" href="media-image-widget.html">
                  media-image-widget.js
                </a>
              
                
                <a class="source" href="media-video-widget.html">
                  media-video-widget.js
                </a>
              
                
                <a class="source" href="media-widgets.html">
                  media-widgets.js
                </a>
              
                
                <a class="source" href="text-widgets.html">
                  text-widgets.js
                </a>
              
                
                <a class="source" href="word-count.html">
                  word-count.js
                </a>
              
                
                <a class="source" href="wp-fullscreen-stub.html">
                  wp-fullscreen-stub.js
                </a>
              
                
                <a class="source" href="xfn.html">
                  xfn.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="theme-options.html">
                  theme-options.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="showcase.html">
                  showcase.js
                </a>
              
                
                <a class="source" href="color-scheme-control.html">
                  color-scheme-control.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="customizer.html">
                  customizer.js
                </a>
              
                
                <a class="source" href="featured-content-admin.html">
                  featured-content-admin.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="jquery.scrollTo.html">
                  jquery.scrollTo.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="admin-bar.html">
                  admin-bar.js
                </a>
              
                
                <a class="source" href="autosave.html">
                  autosave.js
                </a>
              
                
                <a class="source" href="backbone.html">
                  backbone.js
                </a>
              
                
                <a class="source" href="backbone.min.html">
                  backbone.min.js
                </a>
              
                
                <a class="source" href="colorpicker.html">
                  colorpicker.js
                </a>
              
                
                <a class="source" href="comment-reply.html">
                  comment-reply.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-base.html">
                  customize-base.js
                </a>
              
                
                <a class="source" href="customize-loader.html">
                  customize-loader.js
                </a>
              
                
                <a class="source" href="customize-models.html">
                  customize-models.js
                </a>
              
                
                <a class="source" href="customize-preview-nav-menus.html">
                  customize-preview-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-preview-widgets.html">
                  customize-preview-widgets.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="customize-selective-refresh.html">
                  customize-selective-refresh.js
                </a>
              
                
                <a class="source" href="customize-views.html">
                  customize-views.js
                </a>
              
                
                <a class="source" href="heartbeat.html">
                  heartbeat.js
                </a>
              
                
                <a class="source" href="hoverIntent.html">
                  hoverIntent.js
                </a>
              
                
                <a class="source" href="imagesloaded.min.html">
                  imagesloaded.min.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.html">
                  jquery.imgareaselect.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.min.html">
                  jquery.imgareaselect.min.js
                </a>
              
                
                <a class="source" href="jquery.Jcrop.min.html">
                  jquery.Jcrop.min.js
                </a>
              
                
                <a class="source" href="jquery-migrate.html">
                  jquery-migrate.js
                </a>
              
                
                <a class="source" href="jquery-migrate.min.html">
                  jquery-migrate.min.js
                </a>
              
                
                <a class="source" href="jquery.color.min.html">
                  jquery.color.min.js
                </a>
              
                
                <a class="source" href="jquery.form.html">
                  jquery.form.js
                </a>
              
                
                <a class="source" href="jquery.form.min.html">
                  jquery.form.min.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.html">
                  jquery.hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.min.html">
                  jquery.hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.html">
                  jquery.js
                </a>
              
                
                <a class="source" href="jquery.masonry.html">
                  jquery.masonry.js
                </a>
              
                
                <a class="source" href="jquery.masonry.min.html">
                  jquery.masonry.min.js
                </a>
              
                
                <a class="source" href="jquery.query.html">
                  jquery.query.js
                </a>
              
                
                <a class="source" href="jquery.schedule.html">
                  jquery.schedule.js
                </a>
              
                
                <a class="source" href="jquery.serialize-object.html">
                  jquery.serialize-object.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.html">
                  jquery.table-hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.min.html">
                  jquery.table-hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.html">
                  jquery.ui.touch-punch.js
                </a>
              
                
                <a class="source" href="suggest.html">
                  suggest.js
                </a>
              
                
                <a class="source" href="suggest.min.html">
                  suggest.min.js
                </a>
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="autocomplete.html">
                  autocomplete.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="datepicker.html">
                  datepicker.js
                </a>
              
                
                <a class="source" href="dialog.html">
                  dialog.js
                </a>
              
                
                <a class="source" href="draggable.html">
                  draggable.js
                </a>
              
                
                <a class="source" href="droppable.html">
                  droppable.js
                </a>
              
                
                <a class="source" href="effect-blind.html">
                  effect-blind.js
                </a>
              
                
                <a class="source" href="effect-bounce.html">
                  effect-bounce.js
                </a>
              
                
                <a class="source" href="effect-clip.html">
                  effect-clip.js
                </a>
              
                
                <a class="source" href="effect-drop.html">
                  effect-drop.js
                </a>
              
                
                <a class="source" href="effect-explode.html">
                  effect-explode.js
                </a>
              
                
                <a class="source" href="effect-fade.html">
                  effect-fade.js
                </a>
              
                
                <a class="source" href="effect-fold.html">
                  effect-fold.js
                </a>
              
                
                <a class="source" href="effect-highlight.html">
                  effect-highlight.js
                </a>
              
                
                <a class="source" href="effect-puff.html">
                  effect-puff.js
                </a>
              
                
                <a class="source" href="effect-pulsate.html">
                  effect-pulsate.js
                </a>
              
                
                <a class="source" href="effect-scale.html">
                  effect-scale.js
                </a>
              
                
                <a class="source" href="effect-shake.html">
                  effect-shake.js
                </a>
              
                
                <a class="source" href="effect-size.html">
                  effect-size.js
                </a>
              
                
                <a class="source" href="effect-slide.html">
                  effect-slide.js
                </a>
              
                
                <a class="source" href="effect-transfer.html">
                  effect-transfer.js
                </a>
              
                
                <a class="source" href="effect.html">
                  effect.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="position.html">
                  position.js
                </a>
              
                
                <a class="source" href="progressbar.html">
                  progressbar.js
                </a>
              
                
                <a class="source" href="resizable.html">
                  resizable.js
                </a>
              
                
                <a class="source" href="selectable.html">
                  selectable.js
                </a>
              
                
                <a class="source" href="selectmenu.html">
                  selectmenu.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="sortable.html">
                  sortable.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="widget.html">
                  widget.js
                </a>
              
                
                <a class="source" href="json2.html">
                  json2.js
                </a>
              
                
                <a class="source" href="masonry.min.html">
                  masonry.min.js
                </a>
              
                
                <a class="source" href="mce-view.html">
                  mce-view.js
                </a>
              
                
                <a class="source" href="media-audiovideo.html">
                  media-audiovideo.js
                </a>
              
                
                <a class="source" href="media-editor.html">
                  media-editor.js
                </a>
              
                
                <a class="source" href="media-grid.html">
                  media-grid.js
                </a>
              
                
                <a class="source" href="media-models.html">
                  media-models.js
                </a>
              
                
                <a class="source" href="media-views.html">
                  media-views.js
                </a>
              
                
                <a class="source" href="audiovideo.manifest.html">
                  audiovideo.manifest.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="collection-add.html">
                  collection-add.js
                </a>
              
                
                <a class="source" href="collection-edit.html">
                  collection-edit.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-image-cropper.html">
                  customize-image-cropper.js
                </a>
              
                
                <a class="source" href="edit-attachment-metadata.html">
                  edit-attachment-metadata.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="featured-image.html">
                  featured-image.js
                </a>
              
                
                <a class="source" href="gallery-add.html">
                  gallery-add.js
                </a>
              
                
                <a class="source" href="gallery-edit.html">
                  gallery-edit.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="media-library.html">
                  media-library.js
                </a>
              
                
                <a class="source" href="region.html">
                  region.js
                </a>
              
                
                <a class="source" href="replace-image.html">
                  replace-image.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="state-machine.html">
                  state-machine.js
                </a>
              
                
                <a class="source" href="state.html">
                  state.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="grid.manifest.html">
                  grid.manifest.js
                </a>
              
                
                <a class="source" href="models.manifest.html">
                  models.manifest.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="post-image.html">
                  post-image.js
                </a>
              
                
                <a class="source" href="post-media.html">
                  post-media.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="selection-sync.html">
                  selection-sync.js
                </a>
              
                
                <a class="source" href="views.manifest.html">
                  views.manifest.js
                </a>
              
                
                <a class="source" href="attachment-compat.html">
                  attachment-compat.js
                </a>
              
                
                <a class="source" href="attachment-filters.html">
                  attachment-filters.js
                </a>
              
                
                <a class="source" href="all.html">
                  all.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="uploaded.html">
                  uploaded.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="details-two-column.html">
                  details-two-column.js
                </a>
              
                
                <a class="source" href="details.html">
                  details.js
                </a>
              
                
                <a class="source" href="edit-library.html">
                  edit-library.js
                </a>
              
                
                <a class="source" href="edit-selection.html">
                  edit-selection.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="browser.html">
                  browser.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="button-group.html">
                  button-group.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="delete-selected-permanently.html">
                  delete-selected-permanently.js
                </a>
              
                
                <a class="source" href="delete-selected.html">
                  delete-selected.js
                </a>
              
                
                <a class="source" href="select-mode-toggle.html">
                  select-mode-toggle.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="edit-image-details.html">
                  edit-image-details.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="image.html">
                  image.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="url.html">
                  url.js
                </a>
              
                
                <a class="source" href="focus-manager.html">
                  focus-manager.js
                </a>
              
                
                <a class="source" href="frame.html">
                  frame.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="edit-attachments.html">
                  edit-attachments.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="iframe.html">
                  iframe.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="label.html">
                  label.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="media-frame.html">
                  media-frame.js
                </a>
              
                
                <a class="source" href="menu-item.html">
                  menu-item.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="priority-list.html">
                  priority-list.js
                </a>
              
                
                <a class="source" href="router-item.html">
                  router-item.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="attachment-display.html">
                  attachment-display.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="playlist.html">
                  playlist.js
                </a>
              
                
                <a class="source" href="sidebar.html">
                  sidebar.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="site-icon-preview.html">
                  site-icon-preview.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="toolbar.html">
                  toolbar.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="inline.html">
                  inline.js
                </a>
              
                
                <a class="source" href="status-error.html">
                  status-error.js
                </a>
              
                
                <a class="source" href="status.html">
                  status.js
                </a>
              
                
                <a class="source" href="window.html">
                  window.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="view.html">
                  view.js
                </a>
              
                
                <a class="source" href="froogaloop.min.html">
                  froogaloop.min.js
                </a>
              
                
                <a class="source" href="mediaelement-and-player.min.html">
                  mediaelement-and-player.min.js
                </a>
              
                
                <a class="source" href="wp-mediaelement.html">
                  wp-mediaelement.js
                </a>
              
                
                <a class="source" href="wp-playlist.html">
                  wp-playlist.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="plupload.full.min.html">
                  plupload.full.min.js
                </a>
              
                
                <a class="source" href="wp-plupload.html">
                  wp-plupload.js
                </a>
              
                
                <a class="source" href="quicktags.html">
                  quicktags.js
                </a>
              
                
                <a class="source" href="shortcode.html">
                  shortcode.js
                </a>
              
                
                <a class="source" href="swfobject.html">
                  swfobject.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="handlers.min.html">
                  handlers.min.js
                </a>
              
                
                <a class="source" href="swfupload.cookies.html">
                  swfupload.cookies.js
                </a>
              
                
                <a class="source" href="swfupload.queue.html">
                  swfupload.queue.js
                </a>
              
                
                <a class="source" href="swfupload.speed.html">
                  swfupload.speed.js
                </a>
              
                
                <a class="source" href="swfupload.swfobject.html">
                  swfupload.swfobject.js
                </a>
              
                
                <a class="source" href="swfupload.html">
                  swfupload.js
                </a>
              
                
                <a class="source" href="thickbox.html">
                  thickbox.js
                </a>
              
                
                <a class="source" href="wp-langs-en.html">
                  wp-langs-en.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="tiny_mce_popup.html">
                  tiny_mce_popup.js
                </a>
              
                
                <a class="source" href="tinymce.html">
                  tinymce.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="editable_selects.html">
                  editable_selects.js
                </a>
              
                
                <a class="source" href="form_utils.html">
                  form_utils.js
                </a>
              
                
                <a class="source" href="mctabs.html">
                  mctabs.js
                </a>
              
                
                <a class="source" href="validate.html">
                  validate.js
                </a>
              
                
                <a class="source" href="tw-sack.html">
                  tw-sack.js
                </a>
              
                
                <a class="source" href="twemoji.html">
                  twemoji.js
                </a>
              
                
                <a class="source" href="underscore.html">
                  underscore.js
                </a>
              
                
                <a class="source" href="underscore.min.html">
                  underscore.min.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="wp-a11y.html">
                  wp-a11y.js
                </a>
              
                
                <a class="source" href="wp-ajax-response.html">
                  wp-ajax-response.js
                </a>
              
                
                <a class="source" href="wp-api.html">
                  wp-api.js
                </a>
              
                
                <a class="source" href="wp-auth-check.html">
                  wp-auth-check.js
                </a>
              
                
                <a class="source" href="wp-backbone.html">
                  wp-backbone.js
                </a>
              
                
                <a class="source" href="wp-custom-header.html">
                  wp-custom-header.js
                </a>
              
                
                <a class="source" href="wp-embed-template.html">
                  wp-embed-template.js
                </a>
              
                
                <a class="source" href="wp-embed.html">
                  wp-embed.js
                </a>
              
                
                <a class="source" href="wp-emoji-loader.html">
                  wp-emoji-loader.js
                </a>
              
                
                <a class="source" href="wp-emoji.html">
                  wp-emoji.js
                </a>
              
                
                <a class="source" href="wp-list-revisions.html">
                  wp-list-revisions.js
                </a>
              
                
                <a class="source" href="wp-lists.html">
                  wp-lists.js
                </a>
              
                
                <a class="source" href="wp-pointer.html">
                  wp-pointer.js
                </a>
              
                
                <a class="source" href="wp-util.html">
                  wp-util.js
                </a>
              
                
                <a class="source" href="wpdialog.html">
                  wpdialog.js
                </a>
              
                
                <a class="source" href="wplink.html">
                  wplink.js
                </a>
              
                
                <a class="source" href="zxcvbn-async.html">
                  zxcvbn-async.js
                </a>
              
                
                <a class="source" href="zxcvbn.min.html">
                  zxcvbn.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>customize-preview-widgets.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global _wpWidgetCustomizerPreviewSettings */</span>
wp.customize.widgetsPreview = wp.customize.WidgetCustomizerPreview = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> $, _, wp, api </span>) </span>{

	<span class="hljs-keyword">var</span> self;

	self = {
		<span class="hljs-attr">renderedSidebars</span>: {},
		<span class="hljs-attr">renderedWidgets</span>: {},
		<span class="hljs-attr">registeredSidebars</span>: [],
		<span class="hljs-attr">registeredWidgets</span>: {},
		<span class="hljs-attr">widgetSelectors</span>: [],
		<span class="hljs-attr">preview</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">l10n</span>: {
			<span class="hljs-attr">widgetTooltip</span>: <span class="hljs-string">''</span>
		},
		<span class="hljs-attr">selectiveRefreshableWidgets</span>: {}
	};

	<span class="hljs-comment">/**
	 * Init widgets preview.
	 *
	 * @since 4.5.0
	 */</span>
	self.init = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

		self.preview = api.preview;
		<span class="hljs-keyword">if</span> ( ! _.isEmpty( self.selectiveRefreshableWidgets ) ) {
			self.addPartials();
		}

		self.buildWidgetSelectors();
		self.highlightControls();

		self.preview.bind( <span class="hljs-string">'highlight-widget'</span>, self.highlightWidget );

		api.preview.bind( <span class="hljs-string">'active'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			self.highlightControls();
		} );
	};

	<span class="hljs-comment">/**
	 * Partial representing a widget instance.
	 *
	 * @class
	 * @augments wp.customize.selectiveRefresh.Partial
	 * @since 4.5.0
	 */</span>
	self.WidgetPartial = api.selectiveRefresh.Partial.extend({

		<span class="hljs-comment">/**
		 * Constructor.
		 *
		 * @since 4.5.0
		 * @param {string} id - Partial ID.
		 * @param {Object} options
		 * @param {Object} options.params
		 */</span>
		initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id, options </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, matches;
			matches = id.match( <span class="hljs-regexp">/^widget\[(.+)]$/</span> );
			<span class="hljs-keyword">if</span> ( ! matches ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Illegal id for widget partial.'</span> );
			}

			partial.widgetId = matches[<span class="hljs-number">1</span>];
			partial.widgetIdParts = self.parseWidgetId( partial.widgetId );
			options = options || {};
			options.params = _.extend(
				{
					<span class="hljs-attr">settings</span>: [ self.getWidgetSettingId( partial.widgetId ) ],
					<span class="hljs-attr">containerInclusive</span>: <span class="hljs-literal">true</span>
				},
				options.params || {}
			);

			api.selectiveRefresh.Partial.prototype.initialize.call( partial, id, options );
		},

		<span class="hljs-comment">/**
		 * Refresh widget partial.
		 *
		 * @returns {Promise}
		 */</span>
		refresh: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, refreshDeferred;
			<span class="hljs-keyword">if</span> ( ! self.selectiveRefreshableWidgets[ partial.widgetIdParts.idBase ] ) {
				refreshDeferred = $.Deferred();
				refreshDeferred.reject();
				partial.fallback();
				<span class="hljs-keyword">return</span> refreshDeferred.promise();
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> api.selectiveRefresh.Partial.prototype.refresh.call( partial );
			}
		},

		<span class="hljs-comment">/**
		 * Send widget-updated message to parent so spinner will get removed from widget control.
		 *
		 * @inheritdoc
		 * @param {wp.customize.selectiveRefresh.Placement} placement
		 */</span>
		renderContent: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">if</span> ( api.selectiveRefresh.Partial.prototype.renderContent.call( partial, placement ) ) {
				api.preview.send( <span class="hljs-string">'widget-updated'</span>, partial.widgetId );
				api.selectiveRefresh.trigger( <span class="hljs-string">'widget-updated'</span>, partial );
			}
		}
	});

	<span class="hljs-comment">/**
	 * Partial representing a widget area.
	 *
	 * @class
	 * @augments wp.customize.selectiveRefresh.Partial
	 * @since 4.5.0
	 */</span>
	self.SidebarPartial = api.selectiveRefresh.Partial.extend({

		<span class="hljs-comment">/**
		 * Constructor.
		 *
		 * @since 4.5.0
		 * @param {string} id - Partial ID.
		 * @param {Object} options
		 * @param {Object} options.params
		 */</span>
		initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id, options </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, matches;
			matches = id.match( <span class="hljs-regexp">/^sidebar\[(.+)]$/</span> );
			<span class="hljs-keyword">if</span> ( ! matches ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Illegal id for sidebar partial.'</span> );
			}
			partial.sidebarId = matches[<span class="hljs-number">1</span>];

			options = options || {};
			options.params = _.extend(
				{
					<span class="hljs-attr">settings</span>: [ <span class="hljs-string">'sidebars_widgets['</span> + partial.sidebarId + <span class="hljs-string">']'</span> ]
				},
				options.params || {}
			);

			api.selectiveRefresh.Partial.prototype.initialize.call( partial, id, options );

			<span class="hljs-keyword">if</span> ( ! partial.params.sidebarArgs ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'The sidebarArgs param was not provided.'</span> );
			}
			<span class="hljs-keyword">if</span> ( partial.params.settings.length &gt; <span class="hljs-number">1</span> ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Expected SidebarPartial to only have one associated setting'</span> );
			}
		},

		<span class="hljs-comment">/**
		 * Set up the partial.
		 *
		 * @since 4.5.0
		 */</span>
		ready: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> sidebarPartial = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Watch for changes to the sidebar_widgets setting.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_.each( sidebarPartial.settings(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> settingId </span>) </span>{
				api( settingId ).bind( _.bind( sidebarPartial.handleSettingChange, sidebarPartial ) );
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Trigger an event for this sidebar being updated whenever a widget inside is rendered.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			api.selectiveRefresh.bind( <span class="hljs-string">'partial-content-rendered'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
				<span class="hljs-keyword">var</span> isAssignedWidgetPartial = (
					placement.partial.extended( self.WidgetPartial ) &amp;&amp;
					( <span class="hljs-number">-1</span> !== _.indexOf( sidebarPartial.getWidgetIds(), placement.partial.widgetId ) )
				);
				<span class="hljs-keyword">if</span> ( isAssignedWidgetPartial ) {
					api.selectiveRefresh.trigger( <span class="hljs-string">'sidebar-updated'</span>, sidebarPartial );
				}
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Make sure that a widget partial has a container in the DOM prior to a refresh.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			api.bind( <span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetSetting </span>) </span>{
				<span class="hljs-keyword">var</span> widgetId, parsedId;
				parsedId = self.parseWidgetSettingId( widgetSetting.id );
				<span class="hljs-keyword">if</span> ( ! parsedId ) {
					<span class="hljs-keyword">return</span>;
				}
				widgetId = parsedId.idBase;
				<span class="hljs-keyword">if</span> ( parsedId.number ) {
					widgetId += <span class="hljs-string">'-'</span> + <span class="hljs-built_in">String</span>( parsedId.number );
				}
				<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> !== _.indexOf( sidebarPartial.getWidgetIds(), widgetId ) ) {
					sidebarPartial.ensureWidgetPlacementContainers( widgetId );
				}
			} );
		},

		<span class="hljs-comment">/**
		 * Get the before/after boundary nodes for all instances of this sidebar (usually one).
		 *
		 * Note that TreeWalker is not implemented in IE8.
		 *
		 * @since 4.5.0
		 * @returns {Array.&lt;{before: Comment, after: Comment, instanceNumber: number}&gt;}
		 */</span>
		findDynamicSidebarBoundaryNodes: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, regExp, boundaryNodes = {}, recursiveCommentTraversal;
			regExp = <span class="hljs-regexp">/^(dynamic_sidebar_before|dynamic_sidebar_after):(.+):(\d+)$/</span>;
			recursiveCommentTraversal = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> childNodes </span>) </span>{
				_.each( childNodes, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> node </span>) </span>{
					<span class="hljs-keyword">var</span> matches;
					<span class="hljs-keyword">if</span> ( <span class="hljs-number">8</span> === node.nodeType ) {
						matches = node.nodeValue.match( regExp );
						<span class="hljs-keyword">if</span> ( ! matches || matches[<span class="hljs-number">2</span>] !== partial.sidebarId ) {
							<span class="hljs-keyword">return</span>;
						}
						<span class="hljs-keyword">if</span> ( _.isUndefined( boundaryNodes[ matches[<span class="hljs-number">3</span>] ] ) ) {
							boundaryNodes[ matches[<span class="hljs-number">3</span>] ] = {
								<span class="hljs-attr">before</span>: <span class="hljs-literal">null</span>,
								<span class="hljs-attr">after</span>: <span class="hljs-literal">null</span>,
								<span class="hljs-attr">instanceNumber</span>: <span class="hljs-built_in">parseInt</span>( matches[<span class="hljs-number">3</span>], <span class="hljs-number">10</span> )
							};
						}
						<span class="hljs-keyword">if</span> ( <span class="hljs-string">'dynamic_sidebar_before'</span> === matches[<span class="hljs-number">1</span>] ) {
							boundaryNodes[ matches[<span class="hljs-number">3</span>] ].before = node;
						} <span class="hljs-keyword">else</span> {
							boundaryNodes[ matches[<span class="hljs-number">3</span>] ].after = node;
						}
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-number">1</span> === node.nodeType ) {
						recursiveCommentTraversal( node.childNodes );
					}
				} );
			};

			recursiveCommentTraversal( <span class="hljs-built_in">document</span>.body.childNodes );
			<span class="hljs-keyword">return</span> _.values( boundaryNodes );
		},

		<span class="hljs-comment">/**
		 * Get the placements for this partial.
		 *
		 * @since 4.5.0
		 * @returns {Array}
		 */</span>
		placements: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">return</span> _.map( partial.findDynamicSidebarBoundaryNodes(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> boundaryNodes </span>) </span>{
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> api.selectiveRefresh.Placement( {
					<span class="hljs-attr">partial</span>: partial,
					<span class="hljs-attr">container</span>: <span class="hljs-literal">null</span>,
					<span class="hljs-attr">startNode</span>: boundaryNodes.before,
					<span class="hljs-attr">endNode</span>: boundaryNodes.after,
					<span class="hljs-attr">context</span>: {
						<span class="hljs-attr">instanceNumber</span>: boundaryNodes.instanceNumber
					}
				} );
			} );
		},

		<span class="hljs-comment">/**
		 * Get the list of widget IDs associated with this widget area.
		 *
		 * @since 4.5.0
		 *
		 * @returns {Array}
		 */</span>
		getWidgetIds: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> sidebarPartial = <span class="hljs-keyword">this</span>, settingId, widgetIds;
			settingId = sidebarPartial.settings()[<span class="hljs-number">0</span>];
			<span class="hljs-keyword">if</span> ( ! settingId ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Missing associated setting.'</span> );
			}
			<span class="hljs-keyword">if</span> ( ! api.has( settingId ) ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Setting does not exist.'</span> );
			}
			widgetIds = api( settingId ).get();
			<span class="hljs-keyword">if</span> ( ! _.isArray( widgetIds ) ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Expected setting to be array of widget IDs'</span> );
			}
			<span class="hljs-keyword">return</span> widgetIds.slice( <span class="hljs-number">0</span> );
		},

		<span class="hljs-comment">/**
		 * Reflow widgets in the sidebar, ensuring they have the proper position in the DOM.
		 *
		 * @since 4.5.0
		 *
		 * @return {Array.&lt;wp.customize.selectiveRefresh.Placement&gt;} List of placements that were reflowed.
		 */</span>
		reflowWidgets: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> sidebarPartial = <span class="hljs-keyword">this</span>, sidebarPlacements, widgetIds, widgetPartials, sortedSidebarContainers = [];
			widgetIds = sidebarPartial.getWidgetIds();
			sidebarPlacements = sidebarPartial.placements();

			widgetPartials = {};
			_.each( widgetIds, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
				<span class="hljs-keyword">var</span> widgetPartial = api.selectiveRefresh.partial( <span class="hljs-string">'widget['</span> + widgetId + <span class="hljs-string">']'</span> );
				<span class="hljs-keyword">if</span> ( widgetPartial ) {
					widgetPartials[ widgetId ] = widgetPartial;
				}
			} );

			_.each( sidebarPlacements, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> sidebarPlacement </span>) </span>{
				<span class="hljs-keyword">var</span> sidebarWidgets = [], needsSort = <span class="hljs-literal">false</span>, thisPosition, lastPosition = <span class="hljs-number">-1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Gather list of widget partial containers in this sidebar, and determine if a sort is needed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				_.each( widgetPartials, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetPartial </span>) </span>{
					_.each( widgetPartial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetPlacement </span>) </span>{

						<span class="hljs-keyword">if</span> ( sidebarPlacement.context.instanceNumber === widgetPlacement.context.sidebar_instance_number ) {
							thisPosition = widgetPlacement.container.index();
							sidebarWidgets.push( {
								<span class="hljs-attr">partial</span>: widgetPartial,
								<span class="hljs-attr">placement</span>: widgetPlacement,
								<span class="hljs-attr">position</span>: thisPosition
							} );
							<span class="hljs-keyword">if</span> ( thisPosition &lt; lastPosition ) {
								needsSort = <span class="hljs-literal">true</span>;
							}
							lastPosition = thisPosition;
						}
					} );
				} );

				<span class="hljs-keyword">if</span> ( needsSort ) {
					_.each( sidebarWidgets, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> sidebarWidget </span>) </span>{
						sidebarPlacement.endNode.parentNode.insertBefore(
							sidebarWidget.placement.container[<span class="hljs-number">0</span>],
							sidebarPlacement.endNode
						);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>@todo Rename partial-placement-moved?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						api.selectiveRefresh.trigger( <span class="hljs-string">'partial-content-moved'</span>, sidebarWidget.placement );
					} );

					sortedSidebarContainers.push( sidebarPlacement );
				}
			} );

			<span class="hljs-keyword">if</span> ( sortedSidebarContainers.length &gt; <span class="hljs-number">0</span> ) {
				api.selectiveRefresh.trigger( <span class="hljs-string">'sidebar-updated'</span>, sidebarPartial );
			}

			<span class="hljs-keyword">return</span> sortedSidebarContainers;
		},

		<span class="hljs-comment">/**
		 * Make sure there is a widget instance container in this sidebar for the given widget ID.
		 *
		 * @since 4.5.0
		 *
		 * @param {string} widgetId
		 * @returns {wp.customize.selectiveRefresh.Partial} Widget instance partial.
		 */</span>
		ensureWidgetPlacementContainers: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
			<span class="hljs-keyword">var</span> sidebarPartial = <span class="hljs-keyword">this</span>, widgetPartial, wasInserted = <span class="hljs-literal">false</span>, partialId = <span class="hljs-string">'widget['</span> + widgetId + <span class="hljs-string">']'</span>;
			widgetPartial = api.selectiveRefresh.partial( partialId );
			<span class="hljs-keyword">if</span> ( ! widgetPartial ) {
				widgetPartial = <span class="hljs-keyword">new</span> self.WidgetPartial( partialId, {
					<span class="hljs-attr">params</span>: {}
				} );
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Make sure that there is a container element for the widget in the sidebar, if at least a placeholder.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_.each( sidebarPartial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> sidebarPlacement </span>) </span>{
				<span class="hljs-keyword">var</span> foundWidgetPlacement, widgetContainerElement;

				foundWidgetPlacement = _.find( widgetPartial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetPlacement </span>) </span>{
					<span class="hljs-keyword">return</span> ( widgetPlacement.context.sidebar_instance_number === sidebarPlacement.context.instanceNumber );
				} );
				<span class="hljs-keyword">if</span> ( foundWidgetPlacement ) {
					<span class="hljs-keyword">return</span>;
				}

				widgetContainerElement = $(
					sidebarPartial.params.sidebarArgs.before_widget.replace( <span class="hljs-regexp">/%1\$s/g</span>, widgetId ).replace( <span class="hljs-regexp">/%2\$s/g</span>, <span class="hljs-string">'widget'</span> ) +
					sidebarPartial.params.sidebarArgs.after_widget
				);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Handle rare case where before_widget and after_widget are empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( ! widgetContainerElement[<span class="hljs-number">0</span>] ) {
					<span class="hljs-keyword">return</span>;
				}

				widgetContainerElement.attr( <span class="hljs-string">'data-customize-partial-id'</span>, widgetPartial.id );
				widgetContainerElement.attr( <span class="hljs-string">'data-customize-partial-type'</span>, <span class="hljs-string">'widget'</span> );
				widgetContainerElement.attr( <span class="hljs-string">'data-customize-widget-id'</span>, widgetId );

				<span class="hljs-comment">/*
				 * Make sure the widget container element has the customize-container context data.
				 * The sidebar_instance_number is used to disambiguate multiple instances of the
				 * same sidebar are rendered onto the template, and so the same widget is embedded
				 * multiple times.
				 */</span>
				widgetContainerElement.data( <span class="hljs-string">'customize-partial-placement-context'</span>, {
					<span class="hljs-string">'sidebar_id'</span>: sidebarPartial.sidebarId,
					<span class="hljs-string">'sidebar_instance_number'</span>: sidebarPlacement.context.instanceNumber
				} );

				sidebarPlacement.endNode.parentNode.insertBefore( widgetContainerElement[<span class="hljs-number">0</span>], sidebarPlacement.endNode );
				wasInserted = <span class="hljs-literal">true</span>;
			} );

			api.selectiveRefresh.partial.add( widgetPartial.id, widgetPartial );

			<span class="hljs-keyword">if</span> ( wasInserted ) {
				sidebarPartial.reflowWidgets();
			}

			<span class="hljs-keyword">return</span> widgetPartial;
		},

		<span class="hljs-comment">/**
		 * Handle change to the sidebars_widgets[] setting.
		 *
		 * @since 4.5.0
		 *
		 * @param {Array} newWidgetIds New widget ids.
		 * @param {Array} oldWidgetIds Old widget ids.
		 */</span>
		handleSettingChange: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> newWidgetIds, oldWidgetIds </span>) </span>{
			<span class="hljs-keyword">var</span> sidebarPartial = <span class="hljs-keyword">this</span>, needsRefresh, widgetsRemoved, widgetsAdded, addedWidgetPartials = [];

			needsRefresh = (
				( oldWidgetIds.length &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-number">0</span> === newWidgetIds.length ) ||
				( newWidgetIds.length &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-number">0</span> === oldWidgetIds.length )
			);
			<span class="hljs-keyword">if</span> ( needsRefresh ) {
				sidebarPartial.fallback();
				<span class="hljs-keyword">return</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Handle removal of widgets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			widgetsRemoved = _.difference( oldWidgetIds, newWidgetIds );
			_.each( widgetsRemoved, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> removedWidgetId </span>) </span>{
				<span class="hljs-keyword">var</span> widgetPartial = api.selectiveRefresh.partial( <span class="hljs-string">'widget['</span> + removedWidgetId + <span class="hljs-string">']'</span> );
				<span class="hljs-keyword">if</span> ( widgetPartial ) {
					_.each( widgetPartial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
						<span class="hljs-keyword">var</span> isRemoved = (
							placement.context.sidebar_id === sidebarPartial.sidebarId ||
							( placement.context.sidebar_args &amp;&amp; placement.context.sidebar_args.id === sidebarPartial.sidebarId )
						);
						<span class="hljs-keyword">if</span> ( isRemoved ) {
							placement.container.remove();
						}
					} );
				}
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Handle insertion of widgets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			widgetsAdded = _.difference( newWidgetIds, oldWidgetIds );
			_.each( widgetsAdded, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> addedWidgetId </span>) </span>{
				<span class="hljs-keyword">var</span> widgetPartial = sidebarPartial.ensureWidgetPlacementContainers( addedWidgetId );
				addedWidgetPartials.push( widgetPartial );
			} );

			_.each( addedWidgetPartials, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetPartial </span>) </span>{
				widgetPartial.refresh();
			} );

			api.selectiveRefresh.trigger( <span class="hljs-string">'sidebar-updated'</span>, sidebarPartial );
		},

		<span class="hljs-comment">/**
		 * Note that the meat is handled in handleSettingChange because it has the context of which widgets were removed.
		 *
		 * @since 4.5.0
		 */</span>
		refresh: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, deferred = $.Deferred();

			deferred.fail( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				partial.fallback();
			} );

			<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === partial.placements().length ) {
				deferred.reject();
			} <span class="hljs-keyword">else</span> {
				_.each( partial.reflowWidgets(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> sidebarPlacement </span>) </span>{
					api.selectiveRefresh.trigger( <span class="hljs-string">'partial-content-rendered'</span>, sidebarPlacement );
				} );
				deferred.resolve();
			}

			<span class="hljs-keyword">return</span> deferred.promise();
		}
	});

	api.selectiveRefresh.partialConstructor.sidebar = self.SidebarPartial;
	api.selectiveRefresh.partialConstructor.widget = self.WidgetPartial;

	<span class="hljs-comment">/**
	 * Add partials for the registered widget areas (sidebars).
	 *
	 * @since 4.5.0
	 */</span>
	self.addPartials = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		_.each( self.registeredSidebars, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> registeredSidebar </span>) </span>{
			<span class="hljs-keyword">var</span> partial, partialId = <span class="hljs-string">'sidebar['</span> + registeredSidebar.id + <span class="hljs-string">']'</span>;
			partial = api.selectiveRefresh.partial( partialId );
			<span class="hljs-keyword">if</span> ( ! partial ) {
				partial = <span class="hljs-keyword">new</span> self.SidebarPartial( partialId, {
					<span class="hljs-attr">params</span>: {
						<span class="hljs-attr">sidebarArgs</span>: registeredSidebar
					}
				} );
				api.selectiveRefresh.partial.add( partial.id, partial );
			}
		} );
	};

	<span class="hljs-comment">/**
	 * Calculate the selector for the sidebar's widgets based on the registered sidebar's info.
	 *
	 * @since 3.9.0
	 */</span>
	self.buildWidgetSelectors = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

		$.each( self.registeredSidebars, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> i, sidebar </span>) </span>{
			<span class="hljs-keyword">var</span> widgetTpl = [
					sidebar.before_widget,
					sidebar.before_title,
					sidebar.after_title,
					sidebar.after_widget
				].join( <span class="hljs-string">''</span> ),
				emptyWidget,
				widgetSelector,
				widgetClasses;

			emptyWidget = $( widgetTpl );
			widgetSelector = emptyWidget.prop( <span class="hljs-string">'tagName'</span> ) || <span class="hljs-string">''</span>;
			widgetClasses = emptyWidget.prop( <span class="hljs-string">'className'</span> ) || <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Prevent a rare case when before_widget, before_title, after_title and after_widget is empty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( ! widgetClasses ) {
				<span class="hljs-keyword">return</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Remove class names that incorporate the string formatting placeholders %1$s and %2$s.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			widgetClasses = widgetClasses.replace( <span class="hljs-regexp">/\S*%[12]\$s\S*/g</span>, <span class="hljs-string">''</span> );
			widgetClasses = widgetClasses.replace( <span class="hljs-regexp">/^\s+|\s+$/g</span>, <span class="hljs-string">''</span> );
			<span class="hljs-keyword">if</span> ( widgetClasses ) {
				widgetSelector += <span class="hljs-string">'.'</span> + widgetClasses.split( <span class="hljs-regexp">/\s+/</span> ).join( <span class="hljs-string">'.'</span> );
			}
			self.widgetSelectors.push( widgetSelector );
		});
	};

	<span class="hljs-comment">/**
	 * Highlight the widget on widget updates or widget control mouse overs.
	 *
	 * @since 3.9.0
	 * @param  {string} widgetId ID of the widget.
	 */</span>
	self.highlightWidget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> $body = $( <span class="hljs-built_in">document</span>.body ),
			$widget = $( <span class="hljs-string">'#'</span> + widgetId );

		$body.find( <span class="hljs-string">'.widget-customizer-highlighted-widget'</span> ).removeClass( <span class="hljs-string">'widget-customizer-highlighted-widget'</span> );

		$widget.addClass( <span class="hljs-string">'widget-customizer-highlighted-widget'</span> );
		setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			$widget.removeClass( <span class="hljs-string">'widget-customizer-highlighted-widget'</span> );
		}, <span class="hljs-number">500</span> );
	};

	<span class="hljs-comment">/**
	 * Show a title and highlight widgets on hover. On shift+clicking
	 * focus the widget control.
	 *
	 * @since 3.9.0
	 */</span>
	self.highlightControls = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>,
			selector = <span class="hljs-keyword">this</span>.widgetSelectors.join( <span class="hljs-string">','</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Skip adding highlights if not in the customizer preview iframe.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( ! api.settings.channel ) {
			<span class="hljs-keyword">return</span>;
		}

		$( selector ).attr( <span class="hljs-string">'title'</span>, <span class="hljs-keyword">this</span>.l10n.widgetTooltip );

		$( <span class="hljs-built_in">document</span> ).on( <span class="hljs-string">'mouseenter'</span>, selector, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			self.preview.send( <span class="hljs-string">'highlight-widget-control'</span>, $( <span class="hljs-keyword">this</span> ).prop( <span class="hljs-string">'id'</span> ) );
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Open expand the widget control when shift+clicking the widget element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		$( <span class="hljs-built_in">document</span> ).on( <span class="hljs-string">'click'</span>, selector, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
			<span class="hljs-keyword">if</span> ( ! e.shiftKey ) {
				<span class="hljs-keyword">return</span>;
			}
			e.preventDefault();

			self.preview.send( <span class="hljs-string">'focus-widget-control'</span>, $( <span class="hljs-keyword">this</span> ).prop( <span class="hljs-string">'id'</span> ) );
		});
	};

	<span class="hljs-comment">/**
	 * Parse a widget ID.
	 *
	 * @since 4.5.0
	 *
	 * @param {string} widgetId Widget ID.
	 * @returns {{idBase: string, number: number|null}}
	 */</span>
	self.parseWidgetId = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> matches, parsed = {
			<span class="hljs-attr">idBase</span>: <span class="hljs-string">''</span>,
			<span class="hljs-attr">number</span>: <span class="hljs-literal">null</span>
		};

		matches = widgetId.match( <span class="hljs-regexp">/^(.+)-(\d+)$/</span> );
		<span class="hljs-keyword">if</span> ( matches ) {
			parsed.idBase = matches[<span class="hljs-number">1</span>];
			parsed.number = <span class="hljs-built_in">parseInt</span>( matches[<span class="hljs-number">2</span>], <span class="hljs-number">10</span> );
		} <span class="hljs-keyword">else</span> {
			parsed.idBase = widgetId; <span class="hljs-comment">// Likely an old single widget.</span>
		}

		<span class="hljs-keyword">return</span> parsed;
	};

	<span class="hljs-comment">/**
	 * Parse a widget setting ID.
	 *
	 * @since 4.5.0
	 *
	 * @param {string} settingId Widget setting ID.
	 * @returns {{idBase: string, number: number|null}|null}
	 */</span>
	self.parseWidgetSettingId = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> settingId </span>) </span>{
		<span class="hljs-keyword">var</span> matches, parsed = {
			<span class="hljs-attr">idBase</span>: <span class="hljs-string">''</span>,
			<span class="hljs-attr">number</span>: <span class="hljs-literal">null</span>
		};

		matches = settingId.match( <span class="hljs-regexp">/^widget_([^\[]+?)(?:\[(\d+)])?$/</span> );
		<span class="hljs-keyword">if</span> ( ! matches ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
		}
		parsed.idBase = matches[<span class="hljs-number">1</span>];
		<span class="hljs-keyword">if</span> ( matches[<span class="hljs-number">2</span>] ) {
			parsed.number = <span class="hljs-built_in">parseInt</span>( matches[<span class="hljs-number">2</span>], <span class="hljs-number">10</span> );
		}
		<span class="hljs-keyword">return</span> parsed;
	};

	<span class="hljs-comment">/**
	 * Convert a widget ID into a Customizer setting ID.
	 *
	 * @since 4.5.0
	 *
	 * @param {string} widgetId Widget ID.
	 * @returns {string} settingId Setting ID.
	 */</span>
	self.getWidgetSettingId = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> parsed = <span class="hljs-keyword">this</span>.parseWidgetId( widgetId ), settingId;

		settingId = <span class="hljs-string">'widget_'</span> + parsed.idBase;
		<span class="hljs-keyword">if</span> ( parsed.number ) {
			settingId += <span class="hljs-string">'['</span> + <span class="hljs-built_in">String</span>( parsed.number ) + <span class="hljs-string">']'</span>;
		}

		<span class="hljs-keyword">return</span> settingId;
	};

	api.bind( <span class="hljs-string">'preview-ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		$.extend( self, _wpWidgetCustomizerPreviewSettings );
		self.init();
	});

	<span class="hljs-keyword">return</span> self;
})( jQuery, _, wp, wp.customize );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
