<!DOCTYPE html>

<html>
<head>
  <title>customize-widgets.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="bookmarklet.html">
                  bookmarklet.js
                </a>
              
                
                <a class="source" href="bookmarklet.min.html">
                  bookmarklet.min.js
                </a>
              
                
                <a class="source" href="color-picker.html">
                  color-picker.js
                </a>
              
                
                <a class="source" href="comment.html">
                  comment.js
                </a>
              
                
                <a class="source" href="common.html">
                  common.js
                </a>
              
                
                <a class="source" href="custom-background.html">
                  custom-background.js
                </a>
              
                
                <a class="source" href="custom-header.html">
                  custom-header.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-nav-menus.html">
                  customize-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-widgets.html">
                  customize-widgets.js
                </a>
              
                
                <a class="source" href="dashboard.html">
                  dashboard.js
                </a>
              
                
                <a class="source" href="edit-comments.html">
                  edit-comments.js
                </a>
              
                
                <a class="source" href="editor-expand.html">
                  editor-expand.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="farbtastic.html">
                  farbtastic.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="image-edit.html">
                  image-edit.js
                </a>
              
                
                <a class="source" href="inline-edit-post.html">
                  inline-edit-post.js
                </a>
              
                
                <a class="source" href="inline-edit-tax.html">
                  inline-edit-tax.js
                </a>
              
                
                <a class="source" href="iris.min.html">
                  iris.min.js
                </a>
              
                
                <a class="source" href="language-chooser.html">
                  language-chooser.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="media-gallery.html">
                  media-gallery.js
                </a>
              
                
                <a class="source" href="media-upload.html">
                  media-upload.js
                </a>
              
                
                <a class="source" href="media.html">
                  media.js
                </a>
              
                
                <a class="source" href="nav-menu.html">
                  nav-menu.js
                </a>
              
                
                <a class="source" href="password-strength-meter.html">
                  password-strength-meter.js
                </a>
              
                
                <a class="source" href="plugin-install.html">
                  plugin-install.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="postbox.html">
                  postbox.js
                </a>
              
                
                <a class="source" href="press-this.html">
                  press-this.js
                </a>
              
                
                <a class="source" href="revisions.html">
                  revisions.js
                </a>
              
                
                <a class="source" href="set-post-thumbnail.html">
                  set-post-thumbnail.js
                </a>
              
                
                <a class="source" href="svg-painter.html">
                  svg-painter.js
                </a>
              
                
                <a class="source" href="tags-box.html">
                  tags-box.js
                </a>
              
                
                <a class="source" href="tags-suggest.html">
                  tags-suggest.js
                </a>
              
                
                <a class="source" href="tags.html">
                  tags.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="updates.html">
                  updates.js
                </a>
              
                
                <a class="source" href="user-profile.html">
                  user-profile.js
                </a>
              
                
                <a class="source" href="user-suggest.html">
                  user-suggest.js
                </a>
              
                
                <a class="source" href="widgets.html">
                  widgets.js
                </a>
              
                
                <a class="source" href="media-audio-widget.html">
                  media-audio-widget.js
                </a>
              
                
                <a class="source" href="media-image-widget.html">
                  media-image-widget.js
                </a>
              
                
                <a class="source" href="media-video-widget.html">
                  media-video-widget.js
                </a>
              
                
                <a class="source" href="media-widgets.html">
                  media-widgets.js
                </a>
              
                
                <a class="source" href="text-widgets.html">
                  text-widgets.js
                </a>
              
                
                <a class="source" href="word-count.html">
                  word-count.js
                </a>
              
                
                <a class="source" href="wp-fullscreen-stub.html">
                  wp-fullscreen-stub.js
                </a>
              
                
                <a class="source" href="xfn.html">
                  xfn.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="theme-options.html">
                  theme-options.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="showcase.html">
                  showcase.js
                </a>
              
                
                <a class="source" href="color-scheme-control.html">
                  color-scheme-control.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="customizer.html">
                  customizer.js
                </a>
              
                
                <a class="source" href="featured-content-admin.html">
                  featured-content-admin.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="jquery.scrollTo.html">
                  jquery.scrollTo.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="admin-bar.html">
                  admin-bar.js
                </a>
              
                
                <a class="source" href="autosave.html">
                  autosave.js
                </a>
              
                
                <a class="source" href="backbone.html">
                  backbone.js
                </a>
              
                
                <a class="source" href="backbone.min.html">
                  backbone.min.js
                </a>
              
                
                <a class="source" href="colorpicker.html">
                  colorpicker.js
                </a>
              
                
                <a class="source" href="comment-reply.html">
                  comment-reply.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-base.html">
                  customize-base.js
                </a>
              
                
                <a class="source" href="customize-loader.html">
                  customize-loader.js
                </a>
              
                
                <a class="source" href="customize-models.html">
                  customize-models.js
                </a>
              
                
                <a class="source" href="customize-preview-nav-menus.html">
                  customize-preview-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-preview-widgets.html">
                  customize-preview-widgets.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="customize-selective-refresh.html">
                  customize-selective-refresh.js
                </a>
              
                
                <a class="source" href="customize-views.html">
                  customize-views.js
                </a>
              
                
                <a class="source" href="heartbeat.html">
                  heartbeat.js
                </a>
              
                
                <a class="source" href="hoverIntent.html">
                  hoverIntent.js
                </a>
              
                
                <a class="source" href="imagesloaded.min.html">
                  imagesloaded.min.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.html">
                  jquery.imgareaselect.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.min.html">
                  jquery.imgareaselect.min.js
                </a>
              
                
                <a class="source" href="jquery.Jcrop.min.html">
                  jquery.Jcrop.min.js
                </a>
              
                
                <a class="source" href="jquery-migrate.html">
                  jquery-migrate.js
                </a>
              
                
                <a class="source" href="jquery-migrate.min.html">
                  jquery-migrate.min.js
                </a>
              
                
                <a class="source" href="jquery.color.min.html">
                  jquery.color.min.js
                </a>
              
                
                <a class="source" href="jquery.form.html">
                  jquery.form.js
                </a>
              
                
                <a class="source" href="jquery.form.min.html">
                  jquery.form.min.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.html">
                  jquery.hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.min.html">
                  jquery.hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.html">
                  jquery.js
                </a>
              
                
                <a class="source" href="jquery.masonry.html">
                  jquery.masonry.js
                </a>
              
                
                <a class="source" href="jquery.masonry.min.html">
                  jquery.masonry.min.js
                </a>
              
                
                <a class="source" href="jquery.query.html">
                  jquery.query.js
                </a>
              
                
                <a class="source" href="jquery.schedule.html">
                  jquery.schedule.js
                </a>
              
                
                <a class="source" href="jquery.serialize-object.html">
                  jquery.serialize-object.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.html">
                  jquery.table-hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.min.html">
                  jquery.table-hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.html">
                  jquery.ui.touch-punch.js
                </a>
              
                
                <a class="source" href="suggest.html">
                  suggest.js
                </a>
              
                
                <a class="source" href="suggest.min.html">
                  suggest.min.js
                </a>
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="autocomplete.html">
                  autocomplete.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="datepicker.html">
                  datepicker.js
                </a>
              
                
                <a class="source" href="dialog.html">
                  dialog.js
                </a>
              
                
                <a class="source" href="draggable.html">
                  draggable.js
                </a>
              
                
                <a class="source" href="droppable.html">
                  droppable.js
                </a>
              
                
                <a class="source" href="effect-blind.html">
                  effect-blind.js
                </a>
              
                
                <a class="source" href="effect-bounce.html">
                  effect-bounce.js
                </a>
              
                
                <a class="source" href="effect-clip.html">
                  effect-clip.js
                </a>
              
                
                <a class="source" href="effect-drop.html">
                  effect-drop.js
                </a>
              
                
                <a class="source" href="effect-explode.html">
                  effect-explode.js
                </a>
              
                
                <a class="source" href="effect-fade.html">
                  effect-fade.js
                </a>
              
                
                <a class="source" href="effect-fold.html">
                  effect-fold.js
                </a>
              
                
                <a class="source" href="effect-highlight.html">
                  effect-highlight.js
                </a>
              
                
                <a class="source" href="effect-puff.html">
                  effect-puff.js
                </a>
              
                
                <a class="source" href="effect-pulsate.html">
                  effect-pulsate.js
                </a>
              
                
                <a class="source" href="effect-scale.html">
                  effect-scale.js
                </a>
              
                
                <a class="source" href="effect-shake.html">
                  effect-shake.js
                </a>
              
                
                <a class="source" href="effect-size.html">
                  effect-size.js
                </a>
              
                
                <a class="source" href="effect-slide.html">
                  effect-slide.js
                </a>
              
                
                <a class="source" href="effect-transfer.html">
                  effect-transfer.js
                </a>
              
                
                <a class="source" href="effect.html">
                  effect.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="position.html">
                  position.js
                </a>
              
                
                <a class="source" href="progressbar.html">
                  progressbar.js
                </a>
              
                
                <a class="source" href="resizable.html">
                  resizable.js
                </a>
              
                
                <a class="source" href="selectable.html">
                  selectable.js
                </a>
              
                
                <a class="source" href="selectmenu.html">
                  selectmenu.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="sortable.html">
                  sortable.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="widget.html">
                  widget.js
                </a>
              
                
                <a class="source" href="json2.html">
                  json2.js
                </a>
              
                
                <a class="source" href="masonry.min.html">
                  masonry.min.js
                </a>
              
                
                <a class="source" href="mce-view.html">
                  mce-view.js
                </a>
              
                
                <a class="source" href="media-audiovideo.html">
                  media-audiovideo.js
                </a>
              
                
                <a class="source" href="media-editor.html">
                  media-editor.js
                </a>
              
                
                <a class="source" href="media-grid.html">
                  media-grid.js
                </a>
              
                
                <a class="source" href="media-models.html">
                  media-models.js
                </a>
              
                
                <a class="source" href="media-views.html">
                  media-views.js
                </a>
              
                
                <a class="source" href="audiovideo.manifest.html">
                  audiovideo.manifest.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="collection-add.html">
                  collection-add.js
                </a>
              
                
                <a class="source" href="collection-edit.html">
                  collection-edit.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-image-cropper.html">
                  customize-image-cropper.js
                </a>
              
                
                <a class="source" href="edit-attachment-metadata.html">
                  edit-attachment-metadata.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="featured-image.html">
                  featured-image.js
                </a>
              
                
                <a class="source" href="gallery-add.html">
                  gallery-add.js
                </a>
              
                
                <a class="source" href="gallery-edit.html">
                  gallery-edit.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="media-library.html">
                  media-library.js
                </a>
              
                
                <a class="source" href="region.html">
                  region.js
                </a>
              
                
                <a class="source" href="replace-image.html">
                  replace-image.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="state-machine.html">
                  state-machine.js
                </a>
              
                
                <a class="source" href="state.html">
                  state.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="grid.manifest.html">
                  grid.manifest.js
                </a>
              
                
                <a class="source" href="models.manifest.html">
                  models.manifest.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="post-image.html">
                  post-image.js
                </a>
              
                
                <a class="source" href="post-media.html">
                  post-media.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="selection-sync.html">
                  selection-sync.js
                </a>
              
                
                <a class="source" href="views.manifest.html">
                  views.manifest.js
                </a>
              
                
                <a class="source" href="attachment-compat.html">
                  attachment-compat.js
                </a>
              
                
                <a class="source" href="attachment-filters.html">
                  attachment-filters.js
                </a>
              
                
                <a class="source" href="all.html">
                  all.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="uploaded.html">
                  uploaded.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="details-two-column.html">
                  details-two-column.js
                </a>
              
                
                <a class="source" href="details.html">
                  details.js
                </a>
              
                
                <a class="source" href="edit-library.html">
                  edit-library.js
                </a>
              
                
                <a class="source" href="edit-selection.html">
                  edit-selection.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="browser.html">
                  browser.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="button-group.html">
                  button-group.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="delete-selected-permanently.html">
                  delete-selected-permanently.js
                </a>
              
                
                <a class="source" href="delete-selected.html">
                  delete-selected.js
                </a>
              
                
                <a class="source" href="select-mode-toggle.html">
                  select-mode-toggle.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="edit-image-details.html">
                  edit-image-details.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="image.html">
                  image.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="url.html">
                  url.js
                </a>
              
                
                <a class="source" href="focus-manager.html">
                  focus-manager.js
                </a>
              
                
                <a class="source" href="frame.html">
                  frame.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="edit-attachments.html">
                  edit-attachments.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="iframe.html">
                  iframe.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="label.html">
                  label.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="media-frame.html">
                  media-frame.js
                </a>
              
                
                <a class="source" href="menu-item.html">
                  menu-item.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="priority-list.html">
                  priority-list.js
                </a>
              
                
                <a class="source" href="router-item.html">
                  router-item.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="attachment-display.html">
                  attachment-display.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="playlist.html">
                  playlist.js
                </a>
              
                
                <a class="source" href="sidebar.html">
                  sidebar.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="site-icon-preview.html">
                  site-icon-preview.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="toolbar.html">
                  toolbar.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="inline.html">
                  inline.js
                </a>
              
                
                <a class="source" href="status-error.html">
                  status-error.js
                </a>
              
                
                <a class="source" href="status.html">
                  status.js
                </a>
              
                
                <a class="source" href="window.html">
                  window.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="view.html">
                  view.js
                </a>
              
                
                <a class="source" href="froogaloop.min.html">
                  froogaloop.min.js
                </a>
              
                
                <a class="source" href="mediaelement-and-player.min.html">
                  mediaelement-and-player.min.js
                </a>
              
                
                <a class="source" href="wp-mediaelement.html">
                  wp-mediaelement.js
                </a>
              
                
                <a class="source" href="wp-playlist.html">
                  wp-playlist.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="plupload.full.min.html">
                  plupload.full.min.js
                </a>
              
                
                <a class="source" href="wp-plupload.html">
                  wp-plupload.js
                </a>
              
                
                <a class="source" href="quicktags.html">
                  quicktags.js
                </a>
              
                
                <a class="source" href="shortcode.html">
                  shortcode.js
                </a>
              
                
                <a class="source" href="swfobject.html">
                  swfobject.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="handlers.min.html">
                  handlers.min.js
                </a>
              
                
                <a class="source" href="swfupload.cookies.html">
                  swfupload.cookies.js
                </a>
              
                
                <a class="source" href="swfupload.queue.html">
                  swfupload.queue.js
                </a>
              
                
                <a class="source" href="swfupload.speed.html">
                  swfupload.speed.js
                </a>
              
                
                <a class="source" href="swfupload.swfobject.html">
                  swfupload.swfobject.js
                </a>
              
                
                <a class="source" href="swfupload.html">
                  swfupload.js
                </a>
              
                
                <a class="source" href="thickbox.html">
                  thickbox.js
                </a>
              
                
                <a class="source" href="wp-langs-en.html">
                  wp-langs-en.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="tiny_mce_popup.html">
                  tiny_mce_popup.js
                </a>
              
                
                <a class="source" href="tinymce.html">
                  tinymce.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="editable_selects.html">
                  editable_selects.js
                </a>
              
                
                <a class="source" href="form_utils.html">
                  form_utils.js
                </a>
              
                
                <a class="source" href="mctabs.html">
                  mctabs.js
                </a>
              
                
                <a class="source" href="validate.html">
                  validate.js
                </a>
              
                
                <a class="source" href="tw-sack.html">
                  tw-sack.js
                </a>
              
                
                <a class="source" href="twemoji.html">
                  twemoji.js
                </a>
              
                
                <a class="source" href="underscore.html">
                  underscore.js
                </a>
              
                
                <a class="source" href="underscore.min.html">
                  underscore.min.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="wp-a11y.html">
                  wp-a11y.js
                </a>
              
                
                <a class="source" href="wp-ajax-response.html">
                  wp-ajax-response.js
                </a>
              
                
                <a class="source" href="wp-api.html">
                  wp-api.js
                </a>
              
                
                <a class="source" href="wp-auth-check.html">
                  wp-auth-check.js
                </a>
              
                
                <a class="source" href="wp-backbone.html">
                  wp-backbone.js
                </a>
              
                
                <a class="source" href="wp-custom-header.html">
                  wp-custom-header.js
                </a>
              
                
                <a class="source" href="wp-embed-template.html">
                  wp-embed-template.js
                </a>
              
                
                <a class="source" href="wp-embed.html">
                  wp-embed.js
                </a>
              
                
                <a class="source" href="wp-emoji-loader.html">
                  wp-emoji-loader.js
                </a>
              
                
                <a class="source" href="wp-emoji.html">
                  wp-emoji.js
                </a>
              
                
                <a class="source" href="wp-list-revisions.html">
                  wp-list-revisions.js
                </a>
              
                
                <a class="source" href="wp-lists.html">
                  wp-lists.js
                </a>
              
                
                <a class="source" href="wp-pointer.html">
                  wp-pointer.js
                </a>
              
                
                <a class="source" href="wp-util.html">
                  wp-util.js
                </a>
              
                
                <a class="source" href="wpdialog.html">
                  wpdialog.js
                </a>
              
                
                <a class="source" href="wplink.html">
                  wplink.js
                </a>
              
                
                <a class="source" href="zxcvbn-async.html">
                  zxcvbn-async.js
                </a>
              
                
                <a class="source" href="zxcvbn.min.html">
                  zxcvbn.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>customize-widgets.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global _wpCustomizeWidgetsSettings */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> wp, $ </span>)</span>{

	<span class="hljs-keyword">if</span> ( ! wp || ! wp.customize ) { <span class="hljs-keyword">return</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Set up our namespace…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> api = wp.customize,
		l10n;

	api.Widgets = api.Widgets || {};
	api.Widgets.savedWidgetIds = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Link settings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	api.Widgets.data = _wpCustomizeWidgetsSettings || {};
	l10n = api.Widgets.data.l10n;

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.WidgetModel
	 *
	 * A single widget model.
	 *
	 * @constructor
	 * @augments Backbone.Model
	 */</span>
	api.Widgets.WidgetModel = Backbone.Model.extend({
		<span class="hljs-attr">id</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">temp_id</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">classname</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">control_tpl</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">description</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">is_disabled</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">is_multi</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">multi_number</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">name</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">id_base</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">transport</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">params</span>: [],
		<span class="hljs-attr">width</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">height</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">search_matched</span>: <span class="hljs-literal">true</span>
	});

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.WidgetCollection
	 *
	 * Collection for widget models.
	 *
	 * @constructor
	 * @augments Backbone.Model
	 */</span>
	api.Widgets.WidgetCollection = Backbone.Collection.extend({
		<span class="hljs-attr">model</span>: api.Widgets.WidgetModel,</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Controls searching on the current widget collection
and triggers an update event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		doSearch: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> value </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Don’t do anything if we’ve already done this search
Useful because the search handler fires multiple times per keystroke</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.terms === value ) {
				<span class="hljs-keyword">return</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Updates terms with the value passed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.terms = value;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If we have terms, run a search…</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.terms.length &gt; <span class="hljs-number">0</span> ) {
				<span class="hljs-keyword">this</span>.search( <span class="hljs-keyword">this</span>.terms );
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>If search is blank, set all the widgets as they matched the search to reset the views.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.terms === <span class="hljs-string">''</span> ) {
				<span class="hljs-keyword">this</span>.each( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> widget </span>) </span>{
					widget.set( <span class="hljs-string">'search_matched'</span>, <span class="hljs-literal">true</span> );
				} );
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Performs a search within the collection
@uses RegExp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		search: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> term </span>) </span>{
			<span class="hljs-keyword">var</span> match, haystack;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Escape the term string for RegExp meta characters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			term = term.replace( <span class="hljs-regexp">/[-\/\\^$*+?.()|[\]{}]/g</span>, <span class="hljs-string">'\\$&amp;'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Consider spaces as word delimiters and match the whole string
so matching terms can be combined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			term = term.replace( <span class="hljs-regexp">/ /g</span>, <span class="hljs-string">')(?=.*'</span> );
			match = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>( <span class="hljs-string">'^(?=.*'</span> + term + <span class="hljs-string">').+'</span>, <span class="hljs-string">'i'</span> );

			<span class="hljs-keyword">this</span>.each( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> data </span>) </span>{
				haystack = [ data.get( <span class="hljs-string">'name'</span> ), data.get( <span class="hljs-string">'id'</span> ), data.get( <span class="hljs-string">'description'</span> ) ].join( <span class="hljs-string">' '</span> );
				data.set( <span class="hljs-string">'search_matched'</span>, match.test( haystack ) );
			} );
		}
	});
	api.Widgets.availableWidgets = <span class="hljs-keyword">new</span> api.Widgets.WidgetCollection( api.Widgets.data.availableWidgets );

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.SidebarModel
	 *
	 * A single sidebar model.
	 *
	 * @constructor
	 * @augments Backbone.Model
	 */</span>
	api.Widgets.SidebarModel = Backbone.Model.extend({
		<span class="hljs-attr">after_title</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">after_widget</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">before_title</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">before_widget</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-string">'class'</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">description</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">id</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">name</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">is_rendered</span>: <span class="hljs-literal">false</span>
	});

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.SidebarCollection
	 *
	 * Collection for sidebar models.
	 *
	 * @constructor
	 * @augments Backbone.Collection
	 */</span>
	api.Widgets.SidebarCollection = Backbone.Collection.extend({
		<span class="hljs-attr">model</span>: api.Widgets.SidebarModel
	});
	api.Widgets.registeredSidebars = <span class="hljs-keyword">new</span> api.Widgets.SidebarCollection( api.Widgets.data.registeredSidebars );

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.AvailableWidgetsPanelView
	 *
	 * View class for the available widgets panel.
	 *
	 * @constructor
	 * @augments wp.Backbone.View
	 * @augments Backbone.View
	 */</span>
	api.Widgets.AvailableWidgetsPanelView = wp.Backbone.View.extend({

		<span class="hljs-attr">el</span>: <span class="hljs-string">'#available-widgets'</span>,

		<span class="hljs-attr">events</span>: {
			<span class="hljs-string">'input #widgets-search'</span>: <span class="hljs-string">'search'</span>,
			<span class="hljs-string">'keyup #widgets-search'</span>: <span class="hljs-string">'search'</span>,
			<span class="hljs-string">'focus .widget-tpl'</span> : <span class="hljs-string">'focus'</span>,
			<span class="hljs-string">'click .widget-tpl'</span> : <span class="hljs-string">'_submit'</span>,
			<span class="hljs-string">'keypress .widget-tpl'</span> : <span class="hljs-string">'_submit'</span>,
			<span class="hljs-string">'keydown'</span> : <span class="hljs-string">'keyboardAccessible'</span>
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Cache current selected widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		selected: <span class="hljs-literal">null</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Cache sidebar control which has opened panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		currentSidebarControl: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">$search</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">$clearResults</span>: <span class="hljs-literal">null</span>,
		<span class="hljs-attr">searchMatchesCount</span>: <span class="hljs-literal">null</span>,

		<span class="hljs-attr">initialize</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

			<span class="hljs-keyword">this</span>.$search = $( <span class="hljs-string">'#widgets-search'</span> );

			<span class="hljs-keyword">this</span>.$clearResults = <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.clear-results'</span> );

			_.bindAll( <span class="hljs-keyword">this</span>, <span class="hljs-string">'close'</span> );

			<span class="hljs-keyword">this</span>.listenTo( <span class="hljs-keyword">this</span>.collection, <span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.updateList );

			<span class="hljs-keyword">this</span>.updateList();</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Set the initial search count to the number of available widgets.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.searchMatchesCount = <span class="hljs-keyword">this</span>.collection.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>If the available widgets panel is open and the customize controls are
interacted with (i.e. available widgets panel is blurred) then close the
available widgets panel. Also close on back button click.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$( <span class="hljs-string">'#customize-controls, #available-widgets .customize-section-title'</span> ).on( <span class="hljs-string">'click keydown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				<span class="hljs-keyword">var</span> isAddNewBtn = $( e.target ).is( <span class="hljs-string">'.add-new-widget, .add-new-widget *'</span> );
				<span class="hljs-keyword">if</span> ( $( <span class="hljs-string">'body'</span> ).hasClass( <span class="hljs-string">'adding-widget'</span> ) &amp;&amp; ! isAddNewBtn ) {
					self.close();
				}
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Clear the search results and trigger a <code>keyup</code> event to fire a new search.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.$clearResults.on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.$search.val( <span class="hljs-string">''</span> ).focus().trigger( <span class="hljs-string">'keyup'</span> );
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Close the panel if the URL in the preview changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			api.previewer.bind( <span class="hljs-string">'url'</span>, <span class="hljs-keyword">this</span>.close );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Performs a search and handles selected widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		search: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
			<span class="hljs-keyword">var</span> firstVisible;

			<span class="hljs-keyword">this</span>.collection.doSearch( event.target.value );</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Update the search matches count.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.updateSearchMatchesCount();</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Announce how many search results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.announceSearchMatches();</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Remove a widget from being selected if it is no longer visible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.selected &amp;&amp; ! <span class="hljs-keyword">this</span>.selected.is( <span class="hljs-string">':visible'</span> ) ) {
				<span class="hljs-keyword">this</span>.selected.removeClass( <span class="hljs-string">'selected'</span> );
				<span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If a widget was selected but the filter value has been cleared out, clear selection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.selected &amp;&amp; ! event.target.value ) {
				<span class="hljs-keyword">this</span>.selected.removeClass( <span class="hljs-string">'selected'</span> );
				<span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>If a filter has been entered and a widget hasn’t been selected, select the first one shown</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">this</span>.selected &amp;&amp; event.target.value ) {
				firstVisible = <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'&gt; .widget-tpl:visible:first'</span> );
				<span class="hljs-keyword">if</span> ( firstVisible.length ) {
					<span class="hljs-keyword">this</span>.select( firstVisible );
				}
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Toggle the clear search results button.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( <span class="hljs-string">''</span> !== event.target.value ) {
				<span class="hljs-keyword">this</span>.$clearResults.addClass( <span class="hljs-string">'is-visible'</span> );
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-string">''</span> === event.target.value ) {
				<span class="hljs-keyword">this</span>.$clearResults.removeClass( <span class="hljs-string">'is-visible'</span> );
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Set a CSS class on the search container when there are no search results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">this</span>.searchMatchesCount ) {
				<span class="hljs-keyword">this</span>.$el.addClass( <span class="hljs-string">'no-widgets-found'</span> );
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.$el.removeClass( <span class="hljs-string">'no-widgets-found'</span> );
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Update the count of the available widgets that have the <code>search_matched</code> attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		updateSearchMatchesCount: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.searchMatchesCount = <span class="hljs-keyword">this</span>.collection.where({ <span class="hljs-attr">search_matched</span>: <span class="hljs-literal">true</span> }).length;
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Send a message to the aria-live region to announce how many search results.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		announceSearchMatches: _.debounce( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> message = l10n.widgetsFound.replace( <span class="hljs-string">'%d'</span>, <span class="hljs-keyword">this</span>.searchMatchesCount ) ;

			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">this</span>.searchMatchesCount ) {
				message = l10n.noWidgetsFound;
			}

			wp.a11y.speak( message );
		}, <span class="hljs-number">500</span> ),</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Changes visibility of available widgets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		updateList: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.collection.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widget </span>) </span>{
				<span class="hljs-keyword">var</span> widgetTpl = $( <span class="hljs-string">'#widget-tpl-'</span> + widget.id );
				widgetTpl.toggle( widget.get( <span class="hljs-string">'search_matched'</span> ) &amp;&amp; ! widget.get( <span class="hljs-string">'is_disabled'</span> ) );
				<span class="hljs-keyword">if</span> ( widget.get( <span class="hljs-string">'is_disabled'</span> ) &amp;&amp; widgetTpl.is( <span class="hljs-keyword">this</span>.selected ) ) {
					<span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>;
				}
			} );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Highlights a widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		select: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetTpl </span>) </span>{
			<span class="hljs-keyword">this</span>.selected = $( widgetTpl );
			<span class="hljs-keyword">this</span>.selected.siblings( <span class="hljs-string">'.widget-tpl'</span> ).removeClass( <span class="hljs-string">'selected'</span> );
			<span class="hljs-keyword">this</span>.selected.addClass( <span class="hljs-string">'selected'</span> );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Highlights a widget on focus</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		focus: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
			<span class="hljs-keyword">this</span>.select( $( event.currentTarget ) );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Submit handler for keypress and click on widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_submit: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Only proceed with keypress if it is Enter or Spacebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( event.type === <span class="hljs-string">'keypress'</span> &amp;&amp; ( event.which !== <span class="hljs-number">13</span> &amp;&amp; event.which !== <span class="hljs-number">32</span> ) ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">this</span>.submit( $( event.currentTarget ) );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Adds a selected widget to the sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		submit: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetTpl </span>) </span>{
			<span class="hljs-keyword">var</span> widgetId, widget, widgetFormControl;

			<span class="hljs-keyword">if</span> ( ! widgetTpl ) {
				widgetTpl = <span class="hljs-keyword">this</span>.selected;
			}

			<span class="hljs-keyword">if</span> ( ! widgetTpl || ! <span class="hljs-keyword">this</span>.currentSidebarControl ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">this</span>.select( widgetTpl );

			widgetId = $( <span class="hljs-keyword">this</span>.selected ).data( <span class="hljs-string">'widget-id'</span> );
			widget = <span class="hljs-keyword">this</span>.collection.findWhere( { <span class="hljs-attr">id</span>: widgetId } );
			<span class="hljs-keyword">if</span> ( ! widget ) {
				<span class="hljs-keyword">return</span>;
			}

			widgetFormControl = <span class="hljs-keyword">this</span>.currentSidebarControl.addWidget( widget.get( <span class="hljs-string">'id_base'</span> ) );
			<span class="hljs-keyword">if</span> ( widgetFormControl ) {
				widgetFormControl.focus();
			}

			<span class="hljs-keyword">this</span>.close();
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Opens the panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		open: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> sidebarControl </span>) </span>{
			<span class="hljs-keyword">this</span>.currentSidebarControl = sidebarControl;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Wide widget controls appear over the preview, and so they need to be collapsed when the panel opens</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			_( <span class="hljs-keyword">this</span>.currentSidebarControl.getWidgetFormControls() ).each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> control </span>) </span>{
				<span class="hljs-keyword">if</span> ( control.params.is_wide ) {
					control.collapseForm();
				}
			} );

			$( <span class="hljs-string">'body'</span> ).addClass( <span class="hljs-string">'adding-widget'</span> );

			<span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'.selected'</span> ).removeClass( <span class="hljs-string">'selected'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Reset search</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.collection.doSearch( <span class="hljs-string">''</span> );

			<span class="hljs-keyword">if</span> ( ! api.settings.browser.mobile ) {
				<span class="hljs-keyword">this</span>.$search.focus();
			}
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Closes the panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		close: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> options </span>) </span>{
			options = options || {};

			<span class="hljs-keyword">if</span> ( options.returnFocus &amp;&amp; <span class="hljs-keyword">this</span>.currentSidebarControl ) {
				<span class="hljs-keyword">this</span>.currentSidebarControl.container.find( <span class="hljs-string">'.add-new-widget'</span> ).focus();
			}

			<span class="hljs-keyword">this</span>.currentSidebarControl = <span class="hljs-literal">null</span>;
			<span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>;

			$( <span class="hljs-string">'body'</span> ).removeClass( <span class="hljs-string">'adding-widget'</span> );

			<span class="hljs-keyword">this</span>.$search.val( <span class="hljs-string">''</span> );
		},</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Add keyboard accessiblity to the panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		keyboardAccessible: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
			<span class="hljs-keyword">var</span> isEnter = ( event.which === <span class="hljs-number">13</span> ),
				isEsc = ( event.which === <span class="hljs-number">27</span> ),
				isDown = ( event.which === <span class="hljs-number">40</span> ),
				isUp = ( event.which === <span class="hljs-number">38</span> ),
				isTab = ( event.which === <span class="hljs-number">9</span> ),
				isShift = ( event.shiftKey ),
				selected = <span class="hljs-literal">null</span>,
				firstVisible = <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'&gt; .widget-tpl:visible:first'</span> ),
				lastVisible = <span class="hljs-keyword">this</span>.$el.find( <span class="hljs-string">'&gt; .widget-tpl:visible:last'</span> ),
				isSearchFocused = $( event.target ).is( <span class="hljs-keyword">this</span>.$search ),
				isLastWidgetFocused = $( event.target ).is( <span class="hljs-string">'.widget-tpl:visible:last'</span> );

			<span class="hljs-keyword">if</span> ( isDown || isUp ) {
				<span class="hljs-keyword">if</span> ( isDown ) {
					<span class="hljs-keyword">if</span> ( isSearchFocused ) {
						selected = firstVisible;
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.selected &amp;&amp; <span class="hljs-keyword">this</span>.selected.nextAll( <span class="hljs-string">'.widget-tpl:visible'</span> ).length !== <span class="hljs-number">0</span> ) {
						selected = <span class="hljs-keyword">this</span>.selected.nextAll( <span class="hljs-string">'.widget-tpl:visible:first'</span> );
					}
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( isUp ) {
					<span class="hljs-keyword">if</span> ( isSearchFocused ) {
						selected = lastVisible;
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.selected &amp;&amp; <span class="hljs-keyword">this</span>.selected.prevAll( <span class="hljs-string">'.widget-tpl:visible'</span> ).length !== <span class="hljs-number">0</span> ) {
						selected = <span class="hljs-keyword">this</span>.selected.prevAll( <span class="hljs-string">'.widget-tpl:visible:first'</span> );
					}
				}

				<span class="hljs-keyword">this</span>.select( selected );

				<span class="hljs-keyword">if</span> ( selected ) {
					selected.focus();
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">this</span>.$search.focus();
				}

				<span class="hljs-keyword">return</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>If enter pressed but nothing entered, don’t do anything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( isEnter &amp;&amp; ! <span class="hljs-keyword">this</span>.$search.val() ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">if</span> ( isEnter ) {
				<span class="hljs-keyword">this</span>.submit();
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( isEsc ) {
				<span class="hljs-keyword">this</span>.close( { <span class="hljs-attr">returnFocus</span>: <span class="hljs-literal">true</span> } );
			}

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.currentSidebarControl &amp;&amp; isTab &amp;&amp; ( isShift &amp;&amp; isSearchFocused || ! isShift &amp;&amp; isLastWidgetFocused ) ) {
				<span class="hljs-keyword">this</span>.currentSidebarControl.container.find( <span class="hljs-string">'.add-new-widget'</span> ).focus();
				event.preventDefault();
			}
		}
	});

	<span class="hljs-comment">/**
	 * Handlers for the widget-synced event, organized by widget ID base.
	 * Other widgets may provide their own update handlers by adding
	 * listeners for the widget-synced event.
	 */</span>
	api.Widgets.formSyncHandlers = {

		<span class="hljs-comment">/**
		 * @param {jQuery.Event} e
		 * @param {jQuery} widget
		 * @param {String} newForm
		 */</span>
		rss: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e, widget, newForm </span>) </span>{
			<span class="hljs-keyword">var</span> oldWidgetError = widget.find( <span class="hljs-string">'.widget-error:first'</span> ),
				newWidgetError = $( <span class="hljs-string">'&lt;div&gt;'</span> + newForm + <span class="hljs-string">'&lt;/div&gt;'</span> ).find( <span class="hljs-string">'.widget-error:first'</span> );

			<span class="hljs-keyword">if</span> ( oldWidgetError.length &amp;&amp; newWidgetError.length ) {
				oldWidgetError.replaceWith( newWidgetError );
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( oldWidgetError.length ) {
				oldWidgetError.remove();
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( newWidgetError.length ) {
				widget.find( <span class="hljs-string">'.widget-content:first'</span> ).prepend( newWidgetError );
			}
		}
	};

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.WidgetControl
	 *
	 * Customizer control for widgets.
	 * Note that 'widget_form' must match the WP_Widget_Form_Customize_Control::$type
	 *
	 * @constructor
	 * @augments wp.customize.Control
	 */</span>
	api.Widgets.WidgetControl = api.Control.extend({
		<span class="hljs-attr">defaultExpandedArguments</span>: {
			<span class="hljs-attr">duration</span>: <span class="hljs-string">'fast'</span>,
			<span class="hljs-attr">completeCallback</span>: $.noop
		},

		<span class="hljs-comment">/**
		 * @since 4.1.0
		 */</span>
		initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id, options </span>) </span>{
			<span class="hljs-keyword">var</span> control = <span class="hljs-keyword">this</span>;

			control.widgetControlEmbedded = <span class="hljs-literal">false</span>;
			control.widgetContentEmbedded = <span class="hljs-literal">false</span>;
			control.expanded = <span class="hljs-keyword">new</span> api.Value( <span class="hljs-literal">false</span> );
			control.expandedArgumentsQueue = [];
			control.expanded.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> expanded </span>) </span>{
				<span class="hljs-keyword">var</span> args = control.expandedArgumentsQueue.shift();
				args = $.extend( {}, control.defaultExpandedArguments, args );
				control.onChangeExpanded( expanded, args );
			});
			control.altNotice = <span class="hljs-literal">true</span>;

			api.Control.prototype.initialize.call( control, id, options );
		},

		<span class="hljs-comment">/**
		 * Set up the control.
		 *
		 * @since 3.9.0
		 */</span>
		ready: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> control = <span class="hljs-keyword">this</span>;

			<span class="hljs-comment">/*
			 * Embed a placeholder once the section is expanded. The full widget
			 * form content will be embedded once the control itself is expanded,
			 * and at this point the widget-added event will be triggered.
			 */</span>
			<span class="hljs-keyword">if</span> ( ! control.section() ) {
				control.embedWidgetControl();
			} <span class="hljs-keyword">else</span> {
				api.section( control.section(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> section </span>) </span>{
					<span class="hljs-keyword">var</span> onExpanded = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> isExpanded </span>) </span>{
						<span class="hljs-keyword">if</span> ( isExpanded ) {
							control.embedWidgetControl();
							section.expanded.unbind( onExpanded );
						}
					};
					<span class="hljs-keyword">if</span> ( section.expanded() ) {
						onExpanded( <span class="hljs-literal">true</span> );
					} <span class="hljs-keyword">else</span> {
						section.expanded.bind( onExpanded );
					}
				} );
			}
		},

		<span class="hljs-comment">/**
		 * Embed the .widget element inside the li container.
		 *
		 * @since 4.4.0
		 */</span>
		embedWidgetControl: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> control = <span class="hljs-keyword">this</span>, widgetControl;

			<span class="hljs-keyword">if</span> ( control.widgetControlEmbedded ) {
				<span class="hljs-keyword">return</span>;
			}
			control.widgetControlEmbedded = <span class="hljs-literal">true</span>;

			widgetControl = $( control.params.widget_control );
			control.container.append( widgetControl );

			control._setupModel();
			control._setupWideWidget();
			control._setupControlToggle();

			control._setupWidgetTitle();
			control._setupReorderUI();
			control._setupHighlightEffects();
			control._setupUpdateUI();
			control._setupRemoveUI();
		},

		<span class="hljs-comment">/**
		 * Embed the actual widget form inside of .widget-content and finally trigger the widget-added event.
		 *
		 * @since 4.4.0
		 */</span>
		embedWidgetContent: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> control = <span class="hljs-keyword">this</span>, widgetContent;

			control.embedWidgetControl();
			<span class="hljs-keyword">if</span> ( control.widgetContentEmbedded ) {
				<span class="hljs-keyword">return</span>;
			}
			control.widgetContentEmbedded = <span class="hljs-literal">true</span>;

			widgetContent = $( control.params.widget_content );
			control.container.find( <span class="hljs-string">'.widget-content:first'</span> ).append( widgetContent );

			<span class="hljs-comment">/*
			 * Trigger widget-added event so that plugins can attach any event
			 * listeners and dynamic UI elements.
			 */</span>
			$( <span class="hljs-built_in">document</span> ).trigger( <span class="hljs-string">'widget-added'</span>, [ control.container.find( <span class="hljs-string">'.widget:first'</span> ) ] );

		},

		<span class="hljs-comment">/**
		 * Handle changes to the setting
		 */</span>
		_setupModel: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, rememberSavedWidgetId;</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Remember saved widgets so we know which to trash (move to inactive widgets sidebar)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			rememberSavedWidgetId = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				api.Widgets.savedWidgetIds[self.params.widget_id] = <span class="hljs-literal">true</span>;
			};
			api.bind( <span class="hljs-string">'ready'</span>, rememberSavedWidgetId );
			api.bind( <span class="hljs-string">'saved'</span>, rememberSavedWidgetId );

			<span class="hljs-keyword">this</span>._updateCount = <span class="hljs-number">0</span>;
			<span class="hljs-keyword">this</span>.isWidgetUpdating = <span class="hljs-literal">false</span>;
			<span class="hljs-keyword">this</span>.liveUpdateMode = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Update widget whenever model changes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.setting.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> to, from </span>) </span>{
				<span class="hljs-keyword">if</span> ( ! _( <span class="hljs-keyword">from</span> ).isEqual( to ) &amp;&amp; ! self.isWidgetUpdating ) {
					self.updateWidget( { <span class="hljs-attr">instance</span>: to } );
				}
			} );
		},

		<span class="hljs-comment">/**
		 * Add special behaviors for wide widget controls
		 */</span>
		_setupWideWidget: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, $widgetInside, $widgetForm, $customizeSidebar,
				$themeControlsContainer, positionWidget;

			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">this</span>.params.is_wide ) {
				<span class="hljs-keyword">return</span>;
			}

			$widgetInside = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-inside'</span> );
			$widgetForm = $widgetInside.find( <span class="hljs-string">'&gt; .form'</span> );
			$customizeSidebar = $( <span class="hljs-string">'.wp-full-overlay-sidebar-content:first'</span> );
			<span class="hljs-keyword">this</span>.container.addClass( <span class="hljs-string">'wide-widget-control'</span> );

			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-content:first'</span> ).css( {
				<span class="hljs-string">'max-width'</span>: <span class="hljs-keyword">this</span>.params.width,
				<span class="hljs-string">'min-height'</span>: <span class="hljs-keyword">this</span>.params.height
			} );

			<span class="hljs-comment">/**
			 * Keep the widget-inside positioned so the top of fixed-positioned
			 * element is at the same top position as the widget-top. When the
			 * widget-top is scrolled out of view, keep the widget-top in view;
			 * likewise, don't allow the widget to drop off the bottom of the window.
			 * If a widget is too tall to fit in the window, don't let the height
			 * exceed the window height so that the contents of the widget control
			 * will become scrollable (overflow:auto).
			 */</span>
			positionWidget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> offsetTop = self.container.offset().top,
					windowHeight = $( <span class="hljs-built_in">window</span> ).height(),
					formHeight = $widgetForm.outerHeight(),
					top;
				$widgetInside.css( <span class="hljs-string">'max-height'</span>, windowHeight );
				top = <span class="hljs-built_in">Math</span>.max(
					<span class="hljs-number">0</span>, <span class="hljs-comment">// prevent top from going off screen</span>
					<span class="hljs-built_in">Math</span>.min(
						<span class="hljs-built_in">Math</span>.max( offsetTop, <span class="hljs-number">0</span> ), <span class="hljs-comment">// distance widget in panel is from top of screen</span>
						windowHeight - formHeight <span class="hljs-comment">// flush up against bottom of screen</span>
					)
				);
				$widgetInside.css( <span class="hljs-string">'top'</span>, top );
			};

			$themeControlsContainer = $( <span class="hljs-string">'#customize-theme-controls'</span> );
			<span class="hljs-keyword">this</span>.container.on( <span class="hljs-string">'expand'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				positionWidget();
				$customizeSidebar.on( <span class="hljs-string">'scroll'</span>, positionWidget );
				$( <span class="hljs-built_in">window</span> ).on( <span class="hljs-string">'resize'</span>, positionWidget );
				$themeControlsContainer.on( <span class="hljs-string">'expanded collapsed'</span>, positionWidget );
			} );
			<span class="hljs-keyword">this</span>.container.on( <span class="hljs-string">'collapsed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$customizeSidebar.off( <span class="hljs-string">'scroll'</span>, positionWidget );
				$( <span class="hljs-built_in">window</span> ).off( <span class="hljs-string">'resize'</span>, positionWidget );
				$themeControlsContainer.off( <span class="hljs-string">'expanded collapsed'</span>, positionWidget );
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Reposition whenever a sidebar’s widgets are changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			api.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> setting </span>) </span>{
				<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === setting.id.indexOf( <span class="hljs-string">'sidebars_widgets['</span> ) ) {
					setting.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">if</span> ( self.container.hasClass( <span class="hljs-string">'expanded'</span> ) ) {
							positionWidget();
						}
					} );
				}
			} );
		},

		<span class="hljs-comment">/**
		 * Show/hide the control when clicking on the form title, when clicking
		 * the close button
		 */</span>
		_setupControlToggle: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, $closeBtn;

			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-top'</span> ).on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				e.preventDefault();
				<span class="hljs-keyword">var</span> sidebarWidgetsControl = self.getSidebarWidgetsControl();
				<span class="hljs-keyword">if</span> ( sidebarWidgetsControl.isReordering ) {
					<span class="hljs-keyword">return</span>;
				}
				self.expanded( ! self.expanded() );
			} );

			$closeBtn = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-control-close'</span> );
			$closeBtn.on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				e.preventDefault();
				self.collapse();
				self.container.find( <span class="hljs-string">'.widget-top .widget-action:first'</span> ).focus(); <span class="hljs-comment">// keyboard accessibility</span>
			} );
		},

		<span class="hljs-comment">/**
		 * Update the title of the form if a title field is entered
		 */</span>
		_setupWidgetTitle: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, updateTitle;

			updateTitle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> title = self.setting().title,
					inWidgetTitle = self.container.find( <span class="hljs-string">'.in-widget-title'</span> );

				<span class="hljs-keyword">if</span> ( title ) {
					inWidgetTitle.text( <span class="hljs-string">': '</span> + title );
				} <span class="hljs-keyword">else</span> {
					inWidgetTitle.text( <span class="hljs-string">''</span> );
				}
			};
			<span class="hljs-keyword">this</span>.setting.bind( updateTitle );
			updateTitle();
		},

		<span class="hljs-comment">/**
		 * Set up the widget-reorder-nav
		 */</span>
		_setupReorderUI: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, selectSidebarItem, $moveWidgetArea,
				$reorderNav, updateAvailableSidebars, template;

			<span class="hljs-comment">/**
			 * select the provided sidebar list item in the move widget area
			 *
			 * @param {jQuery} li
			 */</span>
			selectSidebarItem = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> li </span>) </span>{
				li.siblings( <span class="hljs-string">'.selected'</span> ).removeClass( <span class="hljs-string">'selected'</span> );
				li.addClass( <span class="hljs-string">'selected'</span> );
				<span class="hljs-keyword">var</span> isSelfSidebar = ( li.data( <span class="hljs-string">'id'</span> ) === self.params.sidebar_id );
				self.container.find( <span class="hljs-string">'.move-widget-btn'</span> ).prop( <span class="hljs-string">'disabled'</span>, isSelfSidebar );
			};

			<span class="hljs-comment">/**
			 * Add the widget reordering elements to the widget control
			 */</span>
			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-title-action'</span> ).after( $( api.Widgets.data.tpl.widgetReorderNav ) );


			template = _.template( api.Widgets.data.tpl.moveWidgetArea );
			$moveWidgetArea = $( template( {
					<span class="hljs-attr">sidebars</span>: _( api.Widgets.registeredSidebars.toArray() ).pluck( <span class="hljs-string">'attributes'</span> )
				} )
			);
			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-top'</span> ).after( $moveWidgetArea );

			<span class="hljs-comment">/**
			 * Update available sidebars when their rendered state changes
			 */</span>
			updateAvailableSidebars = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> $sidebarItems = $moveWidgetArea.find( <span class="hljs-string">'li'</span> ), selfSidebarItem,
					renderedSidebarCount = <span class="hljs-number">0</span>;

				selfSidebarItem = $sidebarItems.filter( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
					<span class="hljs-keyword">return</span> $( <span class="hljs-keyword">this</span> ).data( <span class="hljs-string">'id'</span> ) === self.params.sidebar_id;
				} );

				$sidebarItems.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> li = $( <span class="hljs-keyword">this</span> ),
						sidebarId, sidebar, sidebarIsRendered;

					sidebarId = li.data( <span class="hljs-string">'id'</span> );
					sidebar = api.Widgets.registeredSidebars.get( sidebarId );
					sidebarIsRendered = sidebar.get( <span class="hljs-string">'is_rendered'</span> );

					li.toggle( sidebarIsRendered );

					<span class="hljs-keyword">if</span> ( sidebarIsRendered ) {
						renderedSidebarCount += <span class="hljs-number">1</span>;
					}

					<span class="hljs-keyword">if</span> ( li.hasClass( <span class="hljs-string">'selected'</span> ) &amp;&amp; ! sidebarIsRendered ) {
						selectSidebarItem( selfSidebarItem );
					}
				} );

				<span class="hljs-keyword">if</span> ( renderedSidebarCount &gt; <span class="hljs-number">1</span> ) {
					self.container.find( <span class="hljs-string">'.move-widget'</span> ).show();
				} <span class="hljs-keyword">else</span> {
					self.container.find( <span class="hljs-string">'.move-widget'</span> ).hide();
				}
			};

			updateAvailableSidebars();
			api.Widgets.registeredSidebars.on( <span class="hljs-string">'change:is_rendered'</span>, updateAvailableSidebars );

			<span class="hljs-comment">/**
			 * Handle clicks for up/down/move on the reorder nav
			 */</span>
			$reorderNav = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-reorder-nav'</span> );
			$reorderNav.find( <span class="hljs-string">'.move-widget, .move-widget-down, .move-widget-up'</span> ).each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$( <span class="hljs-keyword">this</span> ).prepend( self.container.find( <span class="hljs-string">'.widget-title'</span> ).text() + <span class="hljs-string">': '</span> );
			} ).on( <span class="hljs-string">'click keypress'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
				<span class="hljs-keyword">if</span> ( event.type === <span class="hljs-string">'keypress'</span> &amp;&amp; ( event.which !== <span class="hljs-number">13</span> &amp;&amp; event.which !== <span class="hljs-number">32</span> ) ) {
					<span class="hljs-keyword">return</span>;
				}
				$( <span class="hljs-keyword">this</span> ).focus();

				<span class="hljs-keyword">if</span> ( $( <span class="hljs-keyword">this</span> ).is( <span class="hljs-string">'.move-widget'</span> ) ) {
					self.toggleWidgetMoveArea();
				} <span class="hljs-keyword">else</span> {
					<span class="hljs-keyword">var</span> isMoveDown = $( <span class="hljs-keyword">this</span> ).is( <span class="hljs-string">'.move-widget-down'</span> ),
						isMoveUp = $( <span class="hljs-keyword">this</span> ).is( <span class="hljs-string">'.move-widget-up'</span> ),
						i = self.getWidgetSidebarPosition();

					<span class="hljs-keyword">if</span> ( ( isMoveUp &amp;&amp; i === <span class="hljs-number">0</span> ) || ( isMoveDown &amp;&amp; i === self.getSidebarWidgetsControl().setting().length - <span class="hljs-number">1</span> ) ) {
						<span class="hljs-keyword">return</span>;
					}

					<span class="hljs-keyword">if</span> ( isMoveUp ) {
						self.moveUp();
						wp.a11y.speak( l10n.widgetMovedUp );
					} <span class="hljs-keyword">else</span> {
						self.moveDown();
						wp.a11y.speak( l10n.widgetMovedDown );
					}

					$( <span class="hljs-keyword">this</span> ).focus(); <span class="hljs-comment">// re-focus after the container was moved</span>
				}
			} );

			<span class="hljs-comment">/**
			 * Handle selecting a sidebar to move to
			 */</span>
			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-area-select'</span> ).on( <span class="hljs-string">'click keypress'</span>, <span class="hljs-string">'li'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
				<span class="hljs-keyword">if</span> ( event.type === <span class="hljs-string">'keypress'</span> &amp;&amp; ( event.which !== <span class="hljs-number">13</span> &amp;&amp; event.which !== <span class="hljs-number">32</span> ) ) {
					<span class="hljs-keyword">return</span>;
				}
				event.preventDefault();
				selectSidebarItem( $( <span class="hljs-keyword">this</span> ) );
			} );

			<span class="hljs-comment">/**
			 * Move widget to another sidebar
			 */</span>
			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.move-widget-btn'</span> ).click( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.getSidebarWidgetsControl().toggleReordering( <span class="hljs-literal">false</span> );

				<span class="hljs-keyword">var</span> oldSidebarId = self.params.sidebar_id,
					newSidebarId = self.container.find( <span class="hljs-string">'.widget-area-select li.selected'</span> ).data( <span class="hljs-string">'id'</span> ),
					oldSidebarWidgetsSetting, newSidebarWidgetsSetting,
					oldSidebarWidgetIds, newSidebarWidgetIds, i;

				oldSidebarWidgetsSetting = api( <span class="hljs-string">'sidebars_widgets['</span> + oldSidebarId + <span class="hljs-string">']'</span> );
				newSidebarWidgetsSetting = api( <span class="hljs-string">'sidebars_widgets['</span> + newSidebarId + <span class="hljs-string">']'</span> );
				oldSidebarWidgetIds = <span class="hljs-built_in">Array</span>.prototype.slice.call( oldSidebarWidgetsSetting() );
				newSidebarWidgetIds = <span class="hljs-built_in">Array</span>.prototype.slice.call( newSidebarWidgetsSetting() );

				i = self.getWidgetSidebarPosition();
				oldSidebarWidgetIds.splice( i, <span class="hljs-number">1</span> );
				newSidebarWidgetIds.push( self.params.widget_id );

				oldSidebarWidgetsSetting( oldSidebarWidgetIds );
				newSidebarWidgetsSetting( newSidebarWidgetIds );

				self.focus();
			} );
		},

		<span class="hljs-comment">/**
		 * Highlight widgets in preview when interacted with in the Customizer
		 */</span>
		_setupHighlightEffects: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Highlight whenever hovering or clicking over the form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.container.on( <span class="hljs-string">'mouseenter click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.setting.previewer.send( <span class="hljs-string">'highlight-widget'</span>, self.params.widget_id );
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Highlight when the setting is updated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.setting.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.setting.previewer.send( <span class="hljs-string">'highlight-widget'</span>, self.params.widget_id );
			} );
		},

		<span class="hljs-comment">/**
		 * Set up event handlers for widget updating
		 */</span>
		_setupUpdateUI: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, $widgetRoot, $widgetContent,
				$saveBtn, updateWidgetDebounced, formSyncHandler;

			$widgetRoot = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget:first'</span> );
			$widgetContent = $widgetRoot.find( <span class="hljs-string">'.widget-content:first'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Configure update button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$saveBtn = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-control-save'</span> );
			$saveBtn.val( l10n.saveBtnLabel );
			$saveBtn.attr( <span class="hljs-string">'title'</span>, l10n.saveBtnTooltip );
			$saveBtn.removeClass( <span class="hljs-string">'button-primary'</span> );
			$saveBtn.on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				e.preventDefault();
				self.updateWidget( { <span class="hljs-attr">disable_form</span>: <span class="hljs-literal">true</span> } ); <span class="hljs-comment">// @todo disable_form is unused?</span>
			} );

			updateWidgetDebounced = _.debounce( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.updateWidget();
			}, <span class="hljs-number">250</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Trigger widget form update when hitting Enter within an input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$widgetContent.on( <span class="hljs-string">'keydown'</span>, <span class="hljs-string">'input'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				<span class="hljs-keyword">if</span> ( <span class="hljs-number">13</span> === e.which ) { <span class="hljs-comment">// Enter</span>
					e.preventDefault();
					self.updateWidget( { <span class="hljs-attr">ignoreActiveElement</span>: <span class="hljs-literal">true</span> } );
				}
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Handle widgets that support live previews</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$widgetContent.on( <span class="hljs-string">'change input propertychange'</span>, <span class="hljs-string">':input'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				<span class="hljs-keyword">if</span> ( ! self.liveUpdateMode ) {
					<span class="hljs-keyword">return</span>;
				}
				<span class="hljs-keyword">if</span> ( e.type === <span class="hljs-string">'change'</span> || ( <span class="hljs-keyword">this</span>.checkValidity &amp;&amp; <span class="hljs-keyword">this</span>.checkValidity() ) ) {
					updateWidgetDebounced();
				}
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Remove loading indicators when the setting is saved and the preview updates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.setting.previewer.channel.bind( <span class="hljs-string">'synced'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.container.removeClass( <span class="hljs-string">'previewer-loading'</span> );
			} );

			api.previewer.bind( <span class="hljs-string">'widget-updated'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> updatedWidgetId </span>) </span>{
				<span class="hljs-keyword">if</span> ( updatedWidgetId === self.params.widget_id ) {
					self.container.removeClass( <span class="hljs-string">'previewer-loading'</span> );
				}
			} );

			formSyncHandler = api.Widgets.formSyncHandlers[ <span class="hljs-keyword">this</span>.params.widget_id_base ];
			<span class="hljs-keyword">if</span> ( formSyncHandler ) {
				$( <span class="hljs-built_in">document</span> ).on( <span class="hljs-string">'widget-synced'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e, widget </span>) </span>{
					<span class="hljs-keyword">if</span> ( $widgetRoot.is( widget ) ) {
						formSyncHandler.apply( <span class="hljs-built_in">document</span>, <span class="hljs-built_in">arguments</span> );
					}
				} );
			}
		},

		<span class="hljs-comment">/**
		 * Update widget control to indicate whether it is currently rendered.
		 *
		 * Overrides api.Control.toggle()
		 *
		 * @since 4.1.0
		 *
		 * @param {Boolean}   active
		 * @param {Object}    args
		 * @param {Callback}  args.completeCallback
		 */</span>
		onChangeActive: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> active, args </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Note: there is a second ‘args’ parameter being passed, merged on top of this.defaultActiveArguments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">this</span>.container.toggleClass( <span class="hljs-string">'widget-rendered'</span>, active );
			<span class="hljs-keyword">if</span> ( args.completeCallback ) {
				args.completeCallback();
			}
		},

		<span class="hljs-comment">/**
		 * Set up event handlers for widget removal
		 */</span>
		_setupRemoveUI: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, $removeBtn, replaceDeleteWithRemove;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Configure remove button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$removeBtn = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-control-remove'</span> );
			$removeBtn.on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				e.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Find an adjacent element to add focus to when this widget goes away</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">var</span> $adjacentFocusTarget;
				<span class="hljs-keyword">if</span> ( self.container.next().is( <span class="hljs-string">'.customize-control-widget_form'</span> ) ) {
					$adjacentFocusTarget = self.container.next().find( <span class="hljs-string">'.widget-action:first'</span> );
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( self.container.prev().is( <span class="hljs-string">'.customize-control-widget_form'</span> ) ) {
					$adjacentFocusTarget = self.container.prev().find( <span class="hljs-string">'.widget-action:first'</span> );
				} <span class="hljs-keyword">else</span> {
					$adjacentFocusTarget = self.container.next( <span class="hljs-string">'.customize-control-sidebar_widgets'</span> ).find( <span class="hljs-string">'.add-new-widget:first'</span> );
				}

				self.container.slideUp( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> sidebarsWidgetsControl = api.Widgets.getSidebarWidgetControlContainingWidget( self.params.widget_id ),
						sidebarWidgetIds, i;

					<span class="hljs-keyword">if</span> ( ! sidebarsWidgetsControl ) {
						<span class="hljs-keyword">return</span>;
					}

					sidebarWidgetIds = sidebarsWidgetsControl.setting().slice();
					i = _.indexOf( sidebarWidgetIds, self.params.widget_id );
					<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> === i ) {
						<span class="hljs-keyword">return</span>;
					}

					sidebarWidgetIds.splice( i, <span class="hljs-number">1</span> );
					sidebarsWidgetsControl.setting( sidebarWidgetIds );

					$adjacentFocusTarget.focus(); <span class="hljs-comment">// keyboard accessibility</span>
				} );
			} );

			replaceDeleteWithRemove = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$removeBtn.text( l10n.removeBtnLabel ); <span class="hljs-comment">// wp_widget_control() outputs the button as "Delete"</span>
				$removeBtn.attr( <span class="hljs-string">'title'</span>, l10n.removeBtnTooltip );
			};

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.params.is_new ) {
				api.bind( <span class="hljs-string">'saved'</span>, replaceDeleteWithRemove );
			} <span class="hljs-keyword">else</span> {
				replaceDeleteWithRemove();
			}
		},

		<span class="hljs-comment">/**
		 * Find all inputs in a widget container that should be considered when
		 * comparing the loaded form with the sanitized form, whose fields will
		 * be aligned to copy the sanitized over. The elements returned by this
		 * are passed into this._getInputsSignature(), and they are iterated
		 * over when copying sanitized values over to the form loaded.
		 *
		 * @param {jQuery} container element in which to look for inputs
		 * @returns {jQuery} inputs
		 * @private
		 */</span>
		_getInputs: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> container </span>) </span>{
			<span class="hljs-keyword">return</span> $( container ).find( <span class="hljs-string">':input[name]'</span> );
		},

		<span class="hljs-comment">/**
		 * Iterate over supplied inputs and create a signature string for all of them together.
		 * This string can be used to compare whether or not the form has all of the same fields.
		 *
		 * @param {jQuery} inputs
		 * @returns {string}
		 * @private
		 */</span>
		_getInputsSignature: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> inputs </span>) </span>{
			<span class="hljs-keyword">var</span> inputsSignatures = _( inputs ).map( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> input </span>) </span>{
				<span class="hljs-keyword">var</span> $input = $( input ), signatureParts;

				<span class="hljs-keyword">if</span> ( $input.is( <span class="hljs-string">':checkbox, :radio'</span> ) ) {
					signatureParts = [ $input.attr( <span class="hljs-string">'id'</span> ), $input.attr( <span class="hljs-string">'name'</span> ), $input.prop( <span class="hljs-string">'value'</span> ) ];
				} <span class="hljs-keyword">else</span> {
					signatureParts = [ $input.attr( <span class="hljs-string">'id'</span> ), $input.attr( <span class="hljs-string">'name'</span> ) ];
				}

				<span class="hljs-keyword">return</span> signatureParts.join( <span class="hljs-string">','</span> );
			} );

			<span class="hljs-keyword">return</span> inputsSignatures.join( <span class="hljs-string">';'</span> );
		},

		<span class="hljs-comment">/**
		 * Get the state for an input depending on its type.
		 *
		 * @param {jQuery|Element} input
		 * @returns {string|boolean|array|*}
		 * @private
		 */</span>
		_getInputState: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> input </span>) </span>{
			input = $( input );
			<span class="hljs-keyword">if</span> ( input.is( <span class="hljs-string">':radio, :checkbox'</span> ) ) {
				<span class="hljs-keyword">return</span> input.prop( <span class="hljs-string">'checked'</span> );
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( input.is( <span class="hljs-string">'select[multiple]'</span> ) ) {
				<span class="hljs-keyword">return</span> input.find( <span class="hljs-string">'option:selected'</span> ).map( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">return</span> $( <span class="hljs-keyword">this</span> ).val();
				} ).get();
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> input.val();
			}
		},

		<span class="hljs-comment">/**
		 * Update an input's state based on its type.
		 *
		 * @param {jQuery|Element} input
		 * @param {string|boolean|array|*} state
		 * @private
		 */</span>
		_setInputState: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> input, state </span>) </span>{
			input = $( input );
			<span class="hljs-keyword">if</span> ( input.is( <span class="hljs-string">':radio, :checkbox'</span> ) ) {
				input.prop( <span class="hljs-string">'checked'</span>, state );
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( input.is( <span class="hljs-string">'select[multiple]'</span> ) ) {
				<span class="hljs-keyword">if</span> ( ! $.isArray( state ) ) {
					state = [];
				} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Make sure all state items are strings since the DOM value is a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					state = _.map( state, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> value </span>) </span>{
						<span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>( value );
					} );
				}
				input.find( <span class="hljs-string">'option'</span> ).each( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
					$( <span class="hljs-keyword">this</span> ).prop( <span class="hljs-string">'selected'</span>, <span class="hljs-number">-1</span> !== _.indexOf( state, <span class="hljs-built_in">String</span>( <span class="hljs-keyword">this</span>.value ) ) );
				} );
			} <span class="hljs-keyword">else</span> {
				input.val( state );
			}
		},

		<span class="hljs-comment">/***********************************************************************
		 * Begin public API methods
		 **********************************************************************/</span>

		<span class="hljs-comment">/**
		 * @return {wp.customize.controlConstructor.sidebar_widgets[]}
		 */</span>
		getSidebarWidgetsControl: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> settingId, sidebarWidgetsControl;

			settingId = <span class="hljs-string">'sidebars_widgets['</span> + <span class="hljs-keyword">this</span>.params.sidebar_id + <span class="hljs-string">']'</span>;
			sidebarWidgetsControl = api.control( settingId );

			<span class="hljs-keyword">if</span> ( ! sidebarWidgetsControl ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">return</span> sidebarWidgetsControl;
		},

		<span class="hljs-comment">/**
		 * Submit the widget form via Ajax and get back the updated instance,
		 * along with the new widget control form to render.
		 *
		 * @param {object} [args]
		 * @param {Object|null} [args.instance=null]  When the model changes, the instance is sent here; otherwise, the inputs from the form are used
		 * @param {Function|null} [args.complete=null]  Function which is called when the request finishes. Context is bound to the control. First argument is any error. Following arguments are for success.
		 * @param {Boolean} [args.ignoreActiveElement=false] Whether or not updating a field will be deferred if focus is still on the element.
		 */</span>
		updateWidget: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> args </span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, instanceOverride, completeCallback, $widgetRoot, $widgetContent,
				updateNumber, params, data, $inputs, processing, jqxhr, isChanged;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>The updateWidget logic requires that the form fields to be fully present.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			self.embedWidgetContent();

			args = $.extend( {
				<span class="hljs-attr">instance</span>: <span class="hljs-literal">null</span>,
				<span class="hljs-attr">complete</span>: <span class="hljs-literal">null</span>,
				<span class="hljs-attr">ignoreActiveElement</span>: <span class="hljs-literal">false</span>
			}, args );

			instanceOverride = args.instance;
			completeCallback = args.complete;

			<span class="hljs-keyword">this</span>._updateCount += <span class="hljs-number">1</span>;
			updateNumber = <span class="hljs-keyword">this</span>._updateCount;

			$widgetRoot = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget:first'</span> );
			$widgetContent = $widgetRoot.find( <span class="hljs-string">'.widget-content:first'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Remove a previous error message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$widgetContent.find( <span class="hljs-string">'.widget-error'</span> ).remove();

			<span class="hljs-keyword">this</span>.container.addClass( <span class="hljs-string">'widget-form-loading'</span> );
			<span class="hljs-keyword">this</span>.container.addClass( <span class="hljs-string">'previewer-loading'</span> );
			processing = api.state( <span class="hljs-string">'processing'</span> );
			processing( processing() + <span class="hljs-number">1</span> );

			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">this</span>.liveUpdateMode ) {
				<span class="hljs-keyword">this</span>.container.addClass( <span class="hljs-string">'widget-form-disabled'</span> );
			}

			params = {};
			params.action = <span class="hljs-string">'update-widget'</span>;
			params.wp_customize = <span class="hljs-string">'on'</span>;
			params.nonce = api.settings.nonce[<span class="hljs-string">'update-widget'</span>];
			params.customize_theme = api.settings.theme.stylesheet;
			params.customized = wp.customize.previewer.query().customized;

			data = $.param( params );
			$inputs = <span class="hljs-keyword">this</span>._getInputs( $widgetContent );</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Store the value we’re submitting in data so that when the response comes back,
we know if it got sanitized; if there is no difference in the sanitized value,
then we do not need to touch the UI and mess up the user’s ongoing editing.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			$inputs.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$( <span class="hljs-keyword">this</span> ).data( <span class="hljs-string">'state'</span> + updateNumber, self._getInputState( <span class="hljs-keyword">this</span> ) );
			} );

			<span class="hljs-keyword">if</span> ( instanceOverride ) {
				data += <span class="hljs-string">'&amp;'</span> + $.param( { <span class="hljs-string">'sanitized_widget_setting'</span>: <span class="hljs-built_in">JSON</span>.stringify( instanceOverride ) } );
			} <span class="hljs-keyword">else</span> {
				data += <span class="hljs-string">'&amp;'</span> + $inputs.serialize();
			}
			data += <span class="hljs-string">'&amp;'</span> + $widgetContent.find( <span class="hljs-string">'~ :input'</span> ).serialize();

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._previousUpdateRequest ) {
				<span class="hljs-keyword">this</span>._previousUpdateRequest.abort();
			}
			jqxhr = $.post( wp.ajax.settings.url, data );
			<span class="hljs-keyword">this</span>._previousUpdateRequest = jqxhr;

			jqxhr.done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> r </span>) </span>{
				<span class="hljs-keyword">var</span> message, sanitizedForm,	$sanitizedInputs, hasSameInputsInResponse,
					isLiveUpdateAborted = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Check if the user is logged out.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( <span class="hljs-string">'0'</span> === r ) {
					api.previewer.preview.iframe.hide();
					api.previewer.login().done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
						self.updateWidget( args );
						api.previewer.preview.iframe.show();
					} );
					<span class="hljs-keyword">return</span>;
				}</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Check for cheaters.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				<span class="hljs-keyword">if</span> ( <span class="hljs-string">'-1'</span> === r ) {
					api.previewer.cheatin();
					<span class="hljs-keyword">return</span>;
				}

				<span class="hljs-keyword">if</span> ( r.success ) {
					sanitizedForm = $( <span class="hljs-string">'&lt;div&gt;'</span> + r.data.form + <span class="hljs-string">'&lt;/div&gt;'</span> );
					$sanitizedInputs = self._getInputs( sanitizedForm );
					hasSameInputsInResponse = self._getInputsSignature( $inputs ) === self._getInputsSignature( $sanitizedInputs );</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Restore live update mode if sanitized fields are now aligned with the existing fields</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( hasSameInputsInResponse &amp;&amp; ! self.liveUpdateMode ) {
						self.liveUpdateMode = <span class="hljs-literal">true</span>;
						self.container.removeClass( <span class="hljs-string">'widget-form-disabled'</span> );
						self.container.find( <span class="hljs-string">'input[name="savewidget"]'</span> ).hide();
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Sync sanitized field states to existing fields if they are aligned</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( hasSameInputsInResponse &amp;&amp; self.liveUpdateMode ) {
						$inputs.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> i </span>) </span>{
							<span class="hljs-keyword">var</span> $input = $( <span class="hljs-keyword">this</span> ),
								$sanitizedInput = $( $sanitizedInputs[i] ),
								submittedState, sanitizedState,	canUpdateState;

							submittedState = $input.data( <span class="hljs-string">'state'</span> + updateNumber );
							sanitizedState = self._getInputState( $sanitizedInput );
							$input.data( <span class="hljs-string">'sanitized'</span>, sanitizedState );

							canUpdateState = ( ! _.isEqual( submittedState, sanitizedState ) &amp;&amp; ( args.ignoreActiveElement || ! $input.is( <span class="hljs-built_in">document</span>.activeElement ) ) );
							<span class="hljs-keyword">if</span> ( canUpdateState ) {
								self._setInputState( $input, sanitizedState );
							}
						} );

						$( <span class="hljs-built_in">document</span> ).trigger( <span class="hljs-string">'widget-synced'</span>, [ $widgetRoot, r.data.form ] );</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Otherwise, if sanitized fields are not aligned with existing fields, disable live update mode if enabled</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( self.liveUpdateMode ) {
						self.liveUpdateMode = <span class="hljs-literal">false</span>;
						self.container.find( <span class="hljs-string">'input[name="savewidget"]'</span> ).show();
						isLiveUpdateAborted = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Otherwise, replace existing form with the sanitized form</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					} <span class="hljs-keyword">else</span> {
						$widgetContent.html( r.data.form );

						self.container.removeClass( <span class="hljs-string">'widget-form-disabled'</span> );

						$( <span class="hljs-built_in">document</span> ).trigger( <span class="hljs-string">'widget-updated'</span>, [ $widgetRoot ] );
					}

					<span class="hljs-comment">/**
					 * If the old instance is identical to the new one, there is nothing new
					 * needing to be rendered, and so we can preempt the event for the
					 * preview finishing loading.
					 */</span>
					isChanged = ! isLiveUpdateAborted &amp;&amp; ! _( self.setting() ).isEqual( r.data.instance );
					<span class="hljs-keyword">if</span> ( isChanged ) {
						self.isWidgetUpdating = <span class="hljs-literal">true</span>; <span class="hljs-comment">// suppress triggering another updateWidget</span>
						self.setting( r.data.instance );
						self.isWidgetUpdating = <span class="hljs-literal">false</span>;
					} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>no change was made, so stop the spinner now instead of when the preview would updates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						self.container.removeClass( <span class="hljs-string">'previewer-loading'</span> );
					}

					<span class="hljs-keyword">if</span> ( completeCallback ) {
						completeCallback.call( self, <span class="hljs-literal">null</span>, { <span class="hljs-attr">noChange</span>: ! isChanged, <span class="hljs-attr">ajaxFinished</span>: <span class="hljs-literal">true</span> } );
					}
				} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>General error message</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					message = l10n.error;

					<span class="hljs-keyword">if</span> ( r.data &amp;&amp; r.data.message ) {
						message = r.data.message;
					}

					<span class="hljs-keyword">if</span> ( completeCallback ) {
						completeCallback.call( self, message );
					} <span class="hljs-keyword">else</span> {
						$widgetContent.prepend( <span class="hljs-string">'&lt;p class="widget-error"&gt;&lt;strong&gt;'</span> + message + <span class="hljs-string">'&lt;/strong&gt;&lt;/p&gt;'</span> );
					}
				}
			} );

			jqxhr.fail( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> jqXHR, textStatus </span>) </span>{
				<span class="hljs-keyword">if</span> ( completeCallback ) {
					completeCallback.call( self, textStatus );
				}
			} );

			jqxhr.always( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.container.removeClass( <span class="hljs-string">'widget-form-loading'</span> );

				$inputs.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					$( <span class="hljs-keyword">this</span> ).removeData( <span class="hljs-string">'state'</span> + updateNumber );
				} );

				processing( processing() - <span class="hljs-number">1</span> );
			} );
		},

		<span class="hljs-comment">/**
		 * Expand the accordion section containing a control
		 */</span>
		expandControlSection: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			api.Control.prototype.expand.call( <span class="hljs-keyword">this</span> );
		},

		<span class="hljs-comment">/**
		 * @since 4.1.0
		 *
		 * @param {Boolean} expanded
		 * @param {Object} [params]
		 * @returns {Boolean} false if state already applied
		 */</span>
		_toggleExpanded: api.Section.prototype._toggleExpanded,

		<span class="hljs-comment">/**
		 * @since 4.1.0
		 *
		 * @param {Object} [params]
		 * @returns {Boolean} false if already expanded
		 */</span>
		expand: api.Section.prototype.expand,

		<span class="hljs-comment">/**
		 * Expand the widget form control
		 *
		 * @deprecated 4.1.0 Use this.expand() instead.
		 */</span>
		expandForm: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.expand();
		},

		<span class="hljs-comment">/**
		 * @since 4.1.0
		 *
		 * @param {Object} [params]
		 * @returns {Boolean} false if already collapsed
		 */</span>
		collapse: api.Section.prototype.collapse,

		<span class="hljs-comment">/**
		 * Collapse the widget form control
		 *
		 * @deprecated 4.1.0 Use this.collapse() instead.
		 */</span>
		collapseForm: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.collapse();
		},

		<span class="hljs-comment">/**
		 * Expand or collapse the widget control
		 *
		 * @deprecated this is poor naming, and it is better to directly set control.expanded( showOrHide )
		 *
		 * @param {boolean|undefined} [showOrHide] If not supplied, will be inverse of current visibility
		 */</span>
		toggleForm: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> showOrHide </span>) </span>{
			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> showOrHide === <span class="hljs-string">'undefined'</span> ) {
				showOrHide = ! <span class="hljs-keyword">this</span>.expanded();
			}
			<span class="hljs-keyword">this</span>.expanded( showOrHide );
		},

		<span class="hljs-comment">/**
		 * Respond to change in the expanded state.
		 *
		 * @param {Boolean} expanded
		 * @param {Object} args  merged on top of this.defaultActiveArguments
		 */</span>
		onChangeExpanded: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> expanded, args </span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, $widget, $inside, complete, prevComplete, expandControl, $toggleBtn;

			self.embedWidgetControl(); <span class="hljs-comment">// Make sure the outer form is embedded so that the expanded state can be set in the UI.</span>
			<span class="hljs-keyword">if</span> ( expanded ) {
				self.embedWidgetContent();
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>If the expanded state is unchanged only manipulate container expanded states</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( args.unchanged ) {
				<span class="hljs-keyword">if</span> ( expanded ) {
					api.Control.prototype.expand.call( self, {
						<span class="hljs-attr">completeCallback</span>:  args.completeCallback
					});
				}
				<span class="hljs-keyword">return</span>;
			}

			$widget = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'div.widget:first'</span> );
			$inside = $widget.find( <span class="hljs-string">'.widget-inside:first'</span> );
			$toggleBtn = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.widget-top button.widget-action'</span> );

			expandControl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Close all other widget controls before expanding this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				api.control.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> otherControl </span>) </span>{
					<span class="hljs-keyword">if</span> ( self.params.type === otherControl.params.type &amp;&amp; self !== otherControl ) {
						otherControl.collapse();
					}
				} );

				complete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					self.container.removeClass( <span class="hljs-string">'expanding'</span> );
					self.container.addClass( <span class="hljs-string">'expanded'</span> );
					$toggleBtn.attr( <span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'true'</span> );
					self.container.trigger( <span class="hljs-string">'expanded'</span> );
				};
				<span class="hljs-keyword">if</span> ( args.completeCallback ) {
					prevComplete = complete;
					complete = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
						prevComplete();
						args.completeCallback();
					};
				}

				<span class="hljs-keyword">if</span> ( self.params.is_wide ) {
					$inside.fadeIn( args.duration, complete );
				} <span class="hljs-keyword">else</span> {
					$inside.slideDown( args.duration, complete );
				}

				self.container.trigger( <span class="hljs-string">'expand'</span> );
				self.container.addClass( <span class="hljs-string">'expanding'</span> );
			};

			<span class="hljs-keyword">if</span> ( expanded ) {
				<span class="hljs-keyword">if</span> ( api.section.has( self.section() ) ) {
					api.section( self.section() ).expand( {
						<span class="hljs-attr">completeCallback</span>: expandControl
					} );
				} <span class="hljs-keyword">else</span> {
					expandControl();
				}
			} <span class="hljs-keyword">else</span> {
				complete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					self.container.removeClass( <span class="hljs-string">'collapsing'</span> );
					self.container.removeClass( <span class="hljs-string">'expanded'</span> );
					$toggleBtn.attr( <span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'false'</span> );
					self.container.trigger( <span class="hljs-string">'collapsed'</span> );
				};
				<span class="hljs-keyword">if</span> ( args.completeCallback ) {
					prevComplete = complete;
					complete = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
						prevComplete();
						args.completeCallback();
					};
				}

				self.container.trigger( <span class="hljs-string">'collapse'</span> );
				self.container.addClass( <span class="hljs-string">'collapsing'</span> );

				<span class="hljs-keyword">if</span> ( self.params.is_wide ) {
					$inside.fadeOut( args.duration, complete );
				} <span class="hljs-keyword">else</span> {
					$inside.slideUp( args.duration, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
						$widget.css( { <span class="hljs-attr">width</span>:<span class="hljs-string">''</span>, <span class="hljs-attr">margin</span>:<span class="hljs-string">''</span> } );
						complete();
					} );
				}
			}
		},

		<span class="hljs-comment">/**
		 * Get the position (index) of the widget in the containing sidebar
		 *
		 * @returns {Number}
		 */</span>
		getWidgetSidebarPosition: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> sidebarWidgetIds, position;

			sidebarWidgetIds = <span class="hljs-keyword">this</span>.getSidebarWidgetsControl().setting();
			position = _.indexOf( sidebarWidgetIds, <span class="hljs-keyword">this</span>.params.widget_id );

			<span class="hljs-keyword">if</span> ( position === <span class="hljs-number">-1</span> ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">return</span> position;
		},

		<span class="hljs-comment">/**
		 * Move widget up one in the sidebar
		 */</span>
		moveUp: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>._moveWidgetByOne( <span class="hljs-number">-1</span> );
		},

		<span class="hljs-comment">/**
		 * Move widget up one in the sidebar
		 */</span>
		moveDown: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>._moveWidgetByOne( <span class="hljs-number">1</span> );
		},

		<span class="hljs-comment">/**
		 * @private
		 *
		 * @param {Number} offset 1|-1
		 */</span>
		_moveWidgetByOne: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> offset </span>) </span>{
			<span class="hljs-keyword">var</span> i, sidebarWidgetsSetting, sidebarWidgetIds,	adjacentWidgetId;

			i = <span class="hljs-keyword">this</span>.getWidgetSidebarPosition();

			sidebarWidgetsSetting = <span class="hljs-keyword">this</span>.getSidebarWidgetsControl().setting;
			sidebarWidgetIds = <span class="hljs-built_in">Array</span>.prototype.slice.call( sidebarWidgetsSetting() ); <span class="hljs-comment">// clone</span>
			adjacentWidgetId = sidebarWidgetIds[i + offset];
			sidebarWidgetIds[i + offset] = <span class="hljs-keyword">this</span>.params.widget_id;
			sidebarWidgetIds[i] = adjacentWidgetId;

			sidebarWidgetsSetting( sidebarWidgetIds );
		},

		<span class="hljs-comment">/**
		 * Toggle visibility of the widget move area
		 *
		 * @param {Boolean} [showOrHide]
		 */</span>
		toggleWidgetMoveArea: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> showOrHide </span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, $moveWidgetArea;

			$moveWidgetArea = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.move-widget-area'</span> );

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> showOrHide === <span class="hljs-string">'undefined'</span> ) {
				showOrHide = ! $moveWidgetArea.hasClass( <span class="hljs-string">'active'</span> );
			}

			<span class="hljs-keyword">if</span> ( showOrHide ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>reset the selected sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				$moveWidgetArea.find( <span class="hljs-string">'.selected'</span> ).removeClass( <span class="hljs-string">'selected'</span> );

				$moveWidgetArea.find( <span class="hljs-string">'li'</span> ).filter( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">return</span> $( <span class="hljs-keyword">this</span> ).data( <span class="hljs-string">'id'</span> ) === self.params.sidebar_id;
				} ).addClass( <span class="hljs-string">'selected'</span> );

				<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.move-widget-btn'</span> ).prop( <span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span> );
			}

			$moveWidgetArea.toggleClass( <span class="hljs-string">'active'</span>, showOrHide );
		},

		<span class="hljs-comment">/**
		 * Highlight the widget control and section
		 */</span>
		highlightSectionAndControl: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> $target;

			<span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.container.is( <span class="hljs-string">':hidden'</span> ) ) {
				$target = <span class="hljs-keyword">this</span>.container.closest( <span class="hljs-string">'.control-section'</span> );
			} <span class="hljs-keyword">else</span> {
				$target = <span class="hljs-keyword">this</span>.container;
			}

			$( <span class="hljs-string">'.highlighted'</span> ).removeClass( <span class="hljs-string">'highlighted'</span> );
			$target.addClass( <span class="hljs-string">'highlighted'</span> );

			setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				$target.removeClass( <span class="hljs-string">'highlighted'</span> );
			}, <span class="hljs-number">500</span> );
		}
	} );

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.WidgetsPanel
	 *
	 * Customizer panel containing the widget area sections.
	 *
	 * @since 4.4.0
	 */</span>
	api.Widgets.WidgetsPanel = api.Panel.extend({

		<span class="hljs-comment">/**
		 * Add and manage the display of the no-rendered-areas notice.
		 *
		 * @since 4.4.0
		 */</span>
		ready: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> panel = <span class="hljs-keyword">this</span>;

			api.Panel.prototype.ready.call( panel );

			panel.deferred.embedded.done(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> panelMetaContainer, noticeContainer, updateNotice, getActiveSectionCount, shouldShowNotice;
				panelMetaContainer = panel.container.find( <span class="hljs-string">'.panel-meta'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>@todo This should use the Notifications API introduced to panels. See <a href="https://core.trac.wordpress.org/ticket/38794">https://core.trac.wordpress.org/ticket/38794</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				noticeContainer = $( <span class="hljs-string">'&lt;div&gt;&lt;/div&gt;'</span>, {
					<span class="hljs-string">'class'</span>: <span class="hljs-string">'no-widget-areas-rendered-notice'</span>
				});
				panelMetaContainer.append( noticeContainer );

				<span class="hljs-comment">/**
				 * Get the number of active sections in the panel.
				 *
				 * @return {number} Number of active sidebar sections.
				 */</span>
				getActiveSectionCount = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">return</span> _.filter( panel.sections(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> section </span>) </span>{
						<span class="hljs-keyword">return</span> section.active();
					} ).length;
				};

				<span class="hljs-comment">/**
				 * Determine whether or not the notice should be displayed.
				 *
				 * @return {boolean}
				 */</span>
				shouldShowNotice = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> activeSectionCount = getActiveSectionCount();
					<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === activeSectionCount ) {
						<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-keyword">return</span> activeSectionCount !== api.Widgets.data.registeredSidebars.length;
					}
				};

				<span class="hljs-comment">/**
				 * Update the notice.
				 *
				 * @returns {void}
				 */</span>
				updateNotice = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> activeSectionCount = getActiveSectionCount(), someRenderedMessage, nonRenderedAreaCount, registeredAreaCount;
					noticeContainer.empty();

					registeredAreaCount = api.Widgets.data.registeredSidebars.length;
					<span class="hljs-keyword">if</span> ( activeSectionCount !== registeredAreaCount ) {

						<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> !== activeSectionCount ) {
							nonRenderedAreaCount = registeredAreaCount - activeSectionCount;
							someRenderedMessage = l10n.someAreasShown[ nonRenderedAreaCount ];
						} <span class="hljs-keyword">else</span> {
							someRenderedMessage = l10n.noAreasShown;
						}
						<span class="hljs-keyword">if</span> ( someRenderedMessage ) {
							noticeContainer.append( $( <span class="hljs-string">'&lt;p&gt;&lt;/p&gt;'</span>, {
								<span class="hljs-attr">text</span>: someRenderedMessage
							} ) );
						}

						noticeContainer.append( $( <span class="hljs-string">'&lt;p&gt;&lt;/p&gt;'</span>, {
							<span class="hljs-attr">text</span>: l10n.navigatePreview
						} ) );
					}
				};
				updateNotice();

				<span class="hljs-comment">/*
				 * Set the initial visibility state for rendered notice.
				 * Update the visibility of the notice whenever a reflow happens.
				 */</span>
				noticeContainer.toggle( shouldShowNotice() );
				api.previewer.deferred.active.done( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
					noticeContainer.toggle( shouldShowNotice() );
				});
				api.bind( <span class="hljs-string">'pane-contents-reflowed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> duration = ( <span class="hljs-string">'resolved'</span> === api.previewer.deferred.active.state() ) ? <span class="hljs-string">'fast'</span> : <span class="hljs-number">0</span>;
					updateNotice();
					<span class="hljs-keyword">if</span> ( shouldShowNotice() ) {
						noticeContainer.slideDown( duration );
					} <span class="hljs-keyword">else</span> {
						noticeContainer.slideUp( duration );
					}
				});
			});
		},

		<span class="hljs-comment">/**
		 * Allow an active widgets panel to be contextually active even when it has no active sections (widget areas).
		 *
		 * This ensures that the widgets panel appears even when there are no
		 * sidebars displayed on the URL currently being previewed.
		 *
		 * @since 4.4.0
		 *
		 * @returns {boolean}
		 */</span>
		isContextuallyActive: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> panel = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">return</span> panel.active();
		}
	});

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.SidebarSection
	 *
	 * Customizer section representing a widget area widget
	 *
	 * @since 4.1.0
	 */</span>
	api.Widgets.SidebarSection = api.Section.extend({

		<span class="hljs-comment">/**
		 * Sync the section's active state back to the Backbone model's is_rendered attribute
		 *
		 * @since 4.1.0
		 */</span>
		ready: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> section = <span class="hljs-keyword">this</span>, registeredSidebar;
			api.Section.prototype.ready.call( <span class="hljs-keyword">this</span> );
			registeredSidebar = api.Widgets.registeredSidebars.get( section.params.sidebarId );
			section.active.bind( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> active </span>) </span>{
				registeredSidebar.set( <span class="hljs-string">'is_rendered'</span>, active );
			});
			registeredSidebar.set( <span class="hljs-string">'is_rendered'</span>, section.active() );
		}
	});

	<span class="hljs-comment">/**
	 * wp.customize.Widgets.SidebarControl
	 *
	 * Customizer control for widgets.
	 * Note that 'sidebar_widgets' must match the WP_Widget_Area_Customize_Control::$type
	 *
	 * @since 3.9.0
	 *
	 * @constructor
	 * @augments wp.customize.Control
	 */</span>
	api.Widgets.SidebarControl = api.Control.extend({

		<span class="hljs-comment">/**
		 * Set up the control
		 */</span>
		ready: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">this</span>.$controlSection = <span class="hljs-keyword">this</span>.container.closest( <span class="hljs-string">'.control-section'</span> );
			<span class="hljs-keyword">this</span>.$sectionContent = <span class="hljs-keyword">this</span>.container.closest( <span class="hljs-string">'.accordion-section-content'</span> );

			<span class="hljs-keyword">this</span>._setupModel();
			<span class="hljs-keyword">this</span>._setupSortable();
			<span class="hljs-keyword">this</span>._setupAddition();
			<span class="hljs-keyword">this</span>._applyCardinalOrderClassNames();
		},

		<span class="hljs-comment">/**
		 * Update ordering of widget control forms when the setting is updated
		 */</span>
		_setupModel: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

			<span class="hljs-keyword">this</span>.setting.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> newWidgetIds, oldWidgetIds </span>) </span>{
				<span class="hljs-keyword">var</span> widgetFormControls, removedWidgetIds, priority;

				removedWidgetIds = _( oldWidgetIds ).difference( newWidgetIds );</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Filter out any persistent widget IDs for widgets which have been deactivated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				newWidgetIds = _( newWidgetIds ).filter( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> newWidgetId </span>) </span>{
					<span class="hljs-keyword">var</span> parsedWidgetId = parseWidgetId( newWidgetId );

					<span class="hljs-keyword">return</span> !! api.Widgets.availableWidgets.findWhere( { <span class="hljs-attr">id_base</span>: parsedWidgetId.id_base } );
				} );

				widgetFormControls = _( newWidgetIds ).map( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
					<span class="hljs-keyword">var</span> widgetFormControl = api.Widgets.getWidgetFormControlForWidget( widgetId );

					<span class="hljs-keyword">if</span> ( ! widgetFormControl ) {
						widgetFormControl = self.addWidget( widgetId );
					}

					<span class="hljs-keyword">return</span> widgetFormControl;
				} );</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Sort widget controls to their new positions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				widgetFormControls.sort( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> a, b </span>) </span>{
					<span class="hljs-keyword">var</span> aIndex = _.indexOf( newWidgetIds, a.params.widget_id ),
						bIndex = _.indexOf( newWidgetIds, b.params.widget_id );
					<span class="hljs-keyword">return</span> aIndex - bIndex;
				});

				priority = <span class="hljs-number">0</span>;
				_( widgetFormControls ).each( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> control </span>) </span>{
					control.priority( priority );
					control.section( self.section() );
					priority += <span class="hljs-number">1</span>;
				});
				self.priority( priority ); <span class="hljs-comment">// Make sure sidebar control remains at end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Re-sort widget form controls (including widgets form other sidebars newly moved here)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				self._applyCardinalOrderClassNames();</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>If the widget was dragged into the sidebar, make sure the sidebar_id param is updated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				_( widgetFormControls ).each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetFormControl </span>) </span>{
					widgetFormControl.params.sidebar_id = self.params.sidebar_id;
				} );</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Cleanup after widget removal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				_( removedWidgetIds ).each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> removedWidgetId </span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Using setTimeout so that when moving a widget to another sidebar, the other sidebars_widgets settings get a chance to update</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
						<span class="hljs-keyword">var</span> removedControl, wasDraggedToAnotherSidebar, inactiveWidgets, removedIdBase,
							widget, isPresentInAnotherSidebar = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Check if the widget is in another sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						api.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> otherSetting </span>) </span>{
							<span class="hljs-keyword">if</span> ( otherSetting.id === self.setting.id || <span class="hljs-number">0</span> !== otherSetting.id.indexOf( <span class="hljs-string">'sidebars_widgets['</span> ) || otherSetting.id === <span class="hljs-string">'sidebars_widgets[wp_inactive_widgets]'</span> ) {
								<span class="hljs-keyword">return</span>;
							}

							<span class="hljs-keyword">var</span> otherSidebarWidgets = otherSetting(), i;

							i = _.indexOf( otherSidebarWidgets, removedWidgetId );
							<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> !== i ) {
								isPresentInAnotherSidebar = <span class="hljs-literal">true</span>;
							}
						} );</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>If the widget is present in another sidebar, abort!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( isPresentInAnotherSidebar ) {
							<span class="hljs-keyword">return</span>;
						}

						removedControl = api.Widgets.getWidgetFormControlForWidget( removedWidgetId );</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Detect if widget control was dragged to another sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						wasDraggedToAnotherSidebar = removedControl &amp;&amp; $.contains( <span class="hljs-built_in">document</span>, removedControl.container[<span class="hljs-number">0</span>] ) &amp;&amp; ! $.contains( self.$sectionContent[<span class="hljs-number">0</span>], removedControl.container[<span class="hljs-number">0</span>] );</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Delete any widget form controls for removed widgets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( removedControl &amp;&amp; ! wasDraggedToAnotherSidebar ) {
							api.control.remove( removedControl.id );
							removedControl.container.remove();
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Move widget to inactive widgets sidebar (move it to trash) if has been previously saved
This prevents the inactive widgets sidebar from overflowing with throwaway widgets</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						<span class="hljs-keyword">if</span> ( api.Widgets.savedWidgetIds[removedWidgetId] ) {
							inactiveWidgets = api.value( <span class="hljs-string">'sidebars_widgets[wp_inactive_widgets]'</span> )().slice();
							inactiveWidgets.push( removedWidgetId );
							api.value( <span class="hljs-string">'sidebars_widgets[wp_inactive_widgets]'</span> )( _( inactiveWidgets ).unique() );
						}</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Make old single widget available for adding again</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>						removedIdBase = parseWidgetId( removedWidgetId ).id_base;
						widget = api.Widgets.availableWidgets.findWhere( { <span class="hljs-attr">id_base</span>: removedIdBase } );
						<span class="hljs-keyword">if</span> ( widget &amp;&amp; ! widget.get( <span class="hljs-string">'is_multi'</span> ) ) {
							widget.set( <span class="hljs-string">'is_disabled'</span>, <span class="hljs-literal">false</span> );
						}
					} );

				} );
			} );
		},

		<span class="hljs-comment">/**
		 * Allow widgets in sidebar to be re-ordered, and for the order to be previewed
		 */</span>
		_setupSortable: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

			<span class="hljs-keyword">this</span>.isReordering = <span class="hljs-literal">false</span>;

			<span class="hljs-comment">/**
			 * Update widget order setting when controls are re-ordered
			 */</span>
			<span class="hljs-keyword">this</span>.$sectionContent.sortable( {
				<span class="hljs-attr">items</span>: <span class="hljs-string">'&gt; .customize-control-widget_form'</span>,
				<span class="hljs-attr">handle</span>: <span class="hljs-string">'.widget-top'</span>,
				<span class="hljs-attr">axis</span>: <span class="hljs-string">'y'</span>,
				<span class="hljs-attr">tolerance</span>: <span class="hljs-string">'pointer'</span>,
				<span class="hljs-attr">connectWith</span>: <span class="hljs-string">'.accordion-section-content:has(.customize-control-sidebar_widgets)'</span>,
				<span class="hljs-attr">update</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> widgetContainerIds = self.$sectionContent.sortable( <span class="hljs-string">'toArray'</span> ), widgetIds;

					widgetIds = $.map( widgetContainerIds, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetContainerId </span>) </span>{
						<span class="hljs-keyword">return</span> $( <span class="hljs-string">'#'</span> + widgetContainerId ).find( <span class="hljs-string">':input[name=widget-id]'</span> ).val();
					} );

					self.setting( widgetIds );
				}
			} );

			<span class="hljs-comment">/**
			 * Expand other Customizer sidebar section when dragging a control widget over it,
			 * allowing the control to be dropped into another section
			 */</span>
			<span class="hljs-keyword">this</span>.$controlSection.find( <span class="hljs-string">'.accordion-section-title'</span> ).droppable({
				<span class="hljs-attr">accept</span>: <span class="hljs-string">'.customize-control-widget_form'</span>,
				<span class="hljs-attr">over</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					<span class="hljs-keyword">var</span> section = api.section( self.section.get() );
					section.expand({
						<span class="hljs-attr">allowMultiple</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// Prevent the section being dragged from to be collapsed</span>
						completeCallback: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>@todo It is not clear when refreshPositions should be called on which sections, or if it is even needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>							api.section.each( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> otherSection </span>) </span>{
								<span class="hljs-keyword">if</span> ( otherSection.container.find( <span class="hljs-string">'.customize-control-sidebar_widgets'</span> ).length ) {
									otherSection.container.find( <span class="hljs-string">'.accordion-section-content:first'</span> ).sortable( <span class="hljs-string">'refreshPositions'</span> );
								}
							} );
						}
					});
				}
			});

			<span class="hljs-comment">/**
			 * Keyboard-accessible reordering
			 */</span>
			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.reorder-toggle'</span> ).on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				self.toggleReordering( ! self.isReordering );
			} );
		},

		<span class="hljs-comment">/**
		 * Set up UI for adding a new widget
		 */</span>
		_setupAddition: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

			<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.add-new-widget'</span> ).on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> addNewWidgetBtn = $( <span class="hljs-keyword">this</span> );

				<span class="hljs-keyword">if</span> ( self.$sectionContent.hasClass( <span class="hljs-string">'reordering'</span> ) ) {
					<span class="hljs-keyword">return</span>;
				}

				<span class="hljs-keyword">if</span> ( ! $( <span class="hljs-string">'body'</span> ).hasClass( <span class="hljs-string">'adding-widget'</span> ) ) {
					addNewWidgetBtn.attr( <span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'true'</span> );
					api.Widgets.availableWidgetsPanel.open( self );
				} <span class="hljs-keyword">else</span> {
					addNewWidgetBtn.attr( <span class="hljs-string">'aria-expanded'</span>, <span class="hljs-string">'false'</span> );
					api.Widgets.availableWidgetsPanel.close();
				}
			} );
		},

		<span class="hljs-comment">/**
		 * Add classes to the widget_form controls to assist with styling
		 */</span>
		_applyCardinalOrderClassNames: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> widgetControls = [];
			_.each( <span class="hljs-keyword">this</span>.setting(), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"> widgetId </span>) </span>{
				<span class="hljs-keyword">var</span> widgetControl = api.Widgets.getWidgetFormControlForWidget( widgetId );
				<span class="hljs-keyword">if</span> ( widgetControl ) {
					widgetControls.push( widgetControl );
				}
			});

			<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === widgetControls.length || ( <span class="hljs-number">1</span> === api.Widgets.registeredSidebars.length &amp;&amp; widgetControls.length &lt;= <span class="hljs-number">1</span> ) ) {
				<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.reorder-toggle'</span> ).hide();
				<span class="hljs-keyword">return</span>;
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.reorder-toggle'</span> ).show();
			}

			$( widgetControls ).each( <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
				$( <span class="hljs-keyword">this</span>.container )
					.removeClass( <span class="hljs-string">'first-widget'</span> )
					.removeClass( <span class="hljs-string">'last-widget'</span> )
					.find( <span class="hljs-string">'.move-widget-down, .move-widget-up'</span> ).prop( <span class="hljs-string">'tabIndex'</span>, <span class="hljs-number">0</span> );
			});

			_.first( widgetControls ).container
				.addClass( <span class="hljs-string">'first-widget'</span> )
				.find( <span class="hljs-string">'.move-widget-up'</span> ).prop( <span class="hljs-string">'tabIndex'</span>, <span class="hljs-number">-1</span> );

			_.last( widgetControls ).container
				.addClass( <span class="hljs-string">'last-widget'</span> )
				.find( <span class="hljs-string">'.move-widget-down'</span> ).prop( <span class="hljs-string">'tabIndex'</span>, <span class="hljs-number">-1</span> );
		},


		<span class="hljs-comment">/***********************************************************************
		 * Begin public API methods
		 **********************************************************************/</span>

		<span class="hljs-comment">/**
		 * Enable/disable the reordering UI
		 *
		 * @param {Boolean} showOrHide to enable/disable reordering
		 *
		 * @todo We should have a reordering state instead and rename this to onChangeReordering
		 */</span>
		toggleReordering: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> showOrHide </span>) </span>{
			<span class="hljs-keyword">var</span> addNewWidgetBtn = <span class="hljs-keyword">this</span>.$sectionContent.find( <span class="hljs-string">'.add-new-widget'</span> ),
				reorderBtn = <span class="hljs-keyword">this</span>.container.find( <span class="hljs-string">'.reorder-toggle'</span> ),
				widgetsTitle = <span class="hljs-keyword">this</span>.$sectionContent.find( <span class="hljs-string">'.widget-title'</span> );

			showOrHide = <span class="hljs-built_in">Boolean</span>( showOrHide );

			<span class="hljs-keyword">if</span> ( showOrHide === <span class="hljs-keyword">this</span>.$sectionContent.hasClass( <span class="hljs-string">'reordering'</span> ) ) {
				<span class="hljs-keyword">return</span>;
			}

			<span class="hljs-keyword">this</span>.isReordering = showOrHide;
			<span class="hljs-keyword">this</span>.$sectionContent.toggleClass( <span class="hljs-string">'reordering'</span>, showOrHide );

			<span class="hljs-keyword">if</span> ( showOrHide ) {
				_( <span class="hljs-keyword">this</span>.getWidgetFormControls() ).each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> formControl </span>) </span>{
					formControl.collapse();
				} );

				addNewWidgetBtn.attr({ <span class="hljs-string">'tabindex'</span>: <span class="hljs-string">'-1'</span>, <span class="hljs-string">'aria-hidden'</span>: <span class="hljs-string">'true'</span> });
				reorderBtn.attr( <span class="hljs-string">'aria-label'</span>, l10n.reorderLabelOff );
				wp.a11y.speak( l10n.reorderModeOn );</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Hide widget titles while reordering: title is already in the reorder controls.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				widgetsTitle.attr( <span class="hljs-string">'aria-hidden'</span>, <span class="hljs-string">'true'</span> );
			} <span class="hljs-keyword">else</span> {
				addNewWidgetBtn.removeAttr( <span class="hljs-string">'tabindex aria-hidden'</span> );
				reorderBtn.attr( <span class="hljs-string">'aria-label'</span>, l10n.reorderLabelOn );
				wp.a11y.speak( l10n.reorderModeOff );
				widgetsTitle.attr( <span class="hljs-string">'aria-hidden'</span>, <span class="hljs-string">'false'</span> );
			}
		},

		<span class="hljs-comment">/**
		 * Get the widget_form Customize controls associated with the current sidebar.
		 *
		 * @since 3.9.0
		 * @return {wp.customize.controlConstructor.widget_form[]}
		 */</span>
		getWidgetFormControls: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> formControls = [];

			_( <span class="hljs-keyword">this</span>.setting() ).each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
				<span class="hljs-keyword">var</span> settingId = widgetIdToSettingId( widgetId ),
					formControl = api.control( settingId );
				<span class="hljs-keyword">if</span> ( formControl ) {
					formControls.push( formControl );
				}
			} );

			<span class="hljs-keyword">return</span> formControls;
		},

		<span class="hljs-comment">/**
		 * @param {string} widgetId or an id_base for adding a previously non-existing widget
		 * @returns {object|false} widget_form control instance, or false on error
		 */</span>
		addWidget: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
			<span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>, controlHtml, $widget, controlType = <span class="hljs-string">'widget_form'</span>, controlContainer, controlConstructor,
				parsedWidgetId = parseWidgetId( widgetId ),
				widgetNumber = parsedWidgetId.number,
				widgetIdBase = parsedWidgetId.id_base,
				widget = api.Widgets.availableWidgets.findWhere( {<span class="hljs-attr">id_base</span>: widgetIdBase} ),
				settingId, isExistingWidget, widgetFormControl, sidebarWidgets, settingArgs, setting;

			<span class="hljs-keyword">if</span> ( ! widget ) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}

			<span class="hljs-keyword">if</span> ( widgetNumber &amp;&amp; ! widget.get( <span class="hljs-string">'is_multi'</span> ) ) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Set up new multi widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( widget.get( <span class="hljs-string">'is_multi'</span> ) &amp;&amp; ! widgetNumber ) {
				widget.set( <span class="hljs-string">'multi_number'</span>, widget.get( <span class="hljs-string">'multi_number'</span> ) + <span class="hljs-number">1</span> );
				widgetNumber = widget.get( <span class="hljs-string">'multi_number'</span> );
			}

			controlHtml = $.trim( $( <span class="hljs-string">'#widget-tpl-'</span> + widget.get( <span class="hljs-string">'id'</span> ) ).html() );
			<span class="hljs-keyword">if</span> ( widget.get( <span class="hljs-string">'is_multi'</span> ) ) {
				controlHtml = controlHtml.replace( <span class="hljs-regexp">/&lt;[^&lt;&gt;]+&gt;/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> m </span>) </span>{
					<span class="hljs-keyword">return</span> m.replace( <span class="hljs-regexp">/__i__|%i%/g</span>, widgetNumber );
				} );
			} <span class="hljs-keyword">else</span> {
				widget.set( <span class="hljs-string">'is_disabled'</span>, <span class="hljs-literal">true</span> ); <span class="hljs-comment">// Prevent single widget from being added again now</span>
			}

			$widget = $( controlHtml );

			controlContainer = $( <span class="hljs-string">'&lt;li/&gt;'</span> )
				.addClass( <span class="hljs-string">'customize-control'</span> )
				.addClass( <span class="hljs-string">'customize-control-'</span> + controlType )
				.append( $widget );</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Remove icon which is visible inside the panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			controlContainer.find( <span class="hljs-string">'&gt; .widget-icon'</span> ).remove();

			<span class="hljs-keyword">if</span> ( widget.get( <span class="hljs-string">'is_multi'</span> ) ) {
				controlContainer.find( <span class="hljs-string">'input[name="widget_number"]'</span> ).val( widgetNumber );
				controlContainer.find( <span class="hljs-string">'input[name="multi_number"]'</span> ).val( widgetNumber );
			}

			widgetId = controlContainer.find( <span class="hljs-string">'[name="widget-id"]'</span> ).val();

			controlContainer.hide(); <span class="hljs-comment">// to be slid-down below</span>

			settingId = <span class="hljs-string">'widget_'</span> + widget.get( <span class="hljs-string">'id_base'</span> );
			<span class="hljs-keyword">if</span> ( widget.get( <span class="hljs-string">'is_multi'</span> ) ) {
				settingId += <span class="hljs-string">'['</span> + widgetNumber + <span class="hljs-string">']'</span>;
			}
			controlContainer.attr( <span class="hljs-string">'id'</span>, <span class="hljs-string">'customize-control-'</span> + settingId.replace( <span class="hljs-regexp">/\]/g</span>, <span class="hljs-string">''</span> ).replace( <span class="hljs-regexp">/\[/g</span>, <span class="hljs-string">'-'</span> ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Only create setting if it doesn’t already exist (if we’re adding a pre-existing inactive widget)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			isExistingWidget = api.has( settingId );
			<span class="hljs-keyword">if</span> ( ! isExistingWidget ) {
				settingArgs = {
					<span class="hljs-attr">transport</span>: api.Widgets.data.selectiveRefreshableWidgets[ widget.get( <span class="hljs-string">'id_base'</span> ) ] ? <span class="hljs-string">'postMessage'</span> : <span class="hljs-string">'refresh'</span>,
					<span class="hljs-attr">previewer</span>: <span class="hljs-keyword">this</span>.setting.previewer
				};
				setting = api.create( settingId, settingId, <span class="hljs-string">''</span>, settingArgs );
				setting.set( {} ); <span class="hljs-comment">// mark dirty, changing from '' to {}</span>
			}

			controlConstructor = api.controlConstructor[controlType];
			widgetFormControl = <span class="hljs-keyword">new</span> controlConstructor( settingId, {
				<span class="hljs-attr">params</span>: {
					<span class="hljs-attr">settings</span>: {
						<span class="hljs-string">'default'</span>: settingId
					},
					<span class="hljs-attr">content</span>: controlContainer,
					<span class="hljs-attr">sidebar_id</span>: self.params.sidebar_id,
					<span class="hljs-attr">widget_id</span>: widgetId,
					<span class="hljs-attr">widget_id_base</span>: widget.get( <span class="hljs-string">'id_base'</span> ),
					<span class="hljs-attr">type</span>: controlType,
					<span class="hljs-attr">is_new</span>: ! isExistingWidget,
					<span class="hljs-attr">width</span>: widget.get( <span class="hljs-string">'width'</span> ),
					<span class="hljs-attr">height</span>: widget.get( <span class="hljs-string">'height'</span> ),
					<span class="hljs-attr">is_wide</span>: widget.get( <span class="hljs-string">'is_wide'</span> ),
					<span class="hljs-attr">active</span>: <span class="hljs-literal">true</span>
				},
				<span class="hljs-attr">previewer</span>: self.setting.previewer
			} );
			api.control.add( settingId, widgetFormControl );</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Make sure widget is removed from the other sidebars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			api.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> otherSetting </span>) </span>{
				<span class="hljs-keyword">if</span> ( otherSetting.id === self.setting.id ) {
					<span class="hljs-keyword">return</span>;
				}

				<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> !== otherSetting.id.indexOf( <span class="hljs-string">'sidebars_widgets['</span> ) ) {
					<span class="hljs-keyword">return</span>;
				}

				<span class="hljs-keyword">var</span> otherSidebarWidgets = otherSetting().slice(),
					i = _.indexOf( otherSidebarWidgets, widgetId );

				<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> !== i ) {
					otherSidebarWidgets.splice( i );
					otherSetting( otherSidebarWidgets );
				}
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Add widget to this sidebar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			sidebarWidgets = <span class="hljs-keyword">this</span>.setting().slice();
			<span class="hljs-keyword">if</span> ( <span class="hljs-number">-1</span> === _.indexOf( sidebarWidgets, widgetId ) ) {
				sidebarWidgets.push( widgetId );
				<span class="hljs-keyword">this</span>.setting( sidebarWidgets );
			}

			controlContainer.slideDown( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">if</span> ( isExistingWidget ) {
					widgetFormControl.updateWidget( {
						<span class="hljs-attr">instance</span>: widgetFormControl.setting()
					} );
				}
			} );

			<span class="hljs-keyword">return</span> widgetFormControl;
		}
	} );</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>Register models for custom panel, section, and control types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	$.extend( api.panelConstructor, {
		<span class="hljs-attr">widgets</span>: api.Widgets.WidgetsPanel
	});
	$.extend( api.sectionConstructor, {
		<span class="hljs-attr">sidebar</span>: api.Widgets.SidebarSection
	});
	$.extend( api.controlConstructor, {
		<span class="hljs-attr">widget_form</span>: api.Widgets.WidgetControl,
		<span class="hljs-attr">sidebar_widgets</span>: api.Widgets.SidebarControl
	});

	<span class="hljs-comment">/**
	 * Init Customizer for widgets.
	 */</span>
	api.bind( <span class="hljs-string">'ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Set up the widgets panel</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		api.Widgets.availableWidgetsPanel = <span class="hljs-keyword">new</span> api.Widgets.AvailableWidgetsPanelView({
			<span class="hljs-attr">collection</span>: api.Widgets.availableWidgets
		});</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>Highlight widget control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		api.previewer.bind( <span class="hljs-string">'highlight-widget-control'</span>, api.Widgets.highlightWidgetFormControl );</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Open and focus widget control</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		api.previewer.bind( <span class="hljs-string">'focus-widget-control'</span>, api.Widgets.focusWidgetFormControl );
	} );

	<span class="hljs-comment">/**
	 * Highlight a widget control.
	 *
	 * @param {string} widgetId
	 */</span>
	api.Widgets.highlightWidgetFormControl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> control = api.Widgets.getWidgetFormControlForWidget( widgetId );

		<span class="hljs-keyword">if</span> ( control ) {
			control.highlightSectionAndControl();
		}
	},

	<span class="hljs-comment">/**
	 * Focus a widget control.
	 *
	 * @param {string} widgetId
	 */</span>
	api.Widgets.focusWidgetFormControl = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> control = api.Widgets.getWidgetFormControlForWidget( widgetId );

		<span class="hljs-keyword">if</span> ( control ) {
			control.focus();
		}
	},

	<span class="hljs-comment">/**
	 * Given a widget control, find the sidebar widgets control that contains it.
	 * @param {string} widgetId
	 * @return {object|null}
	 */</span>
	api.Widgets.getSidebarWidgetControlContainingWidget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> foundControl = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>@todo this can use widgetIdToSettingId(), then pass into wp.customize.control( x ).getSidebarWidgetsControl()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		api.control.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> control </span>) </span>{
			<span class="hljs-keyword">if</span> ( control.params.type === <span class="hljs-string">'sidebar_widgets'</span> &amp;&amp; <span class="hljs-number">-1</span> !== _.indexOf( control.setting(), widgetId ) ) {
				foundControl = control;
			}
		} );

		<span class="hljs-keyword">return</span> foundControl;
	};

	<span class="hljs-comment">/**
	 * Given a widget ID for a widget appearing in the preview, get the widget form control associated with it.
	 *
	 * @param {string} widgetId
	 * @return {object|null}
	 */</span>
	api.Widgets.getWidgetFormControlForWidget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> foundControl = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>@todo We can just use widgetIdToSettingId() here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		api.control.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> control </span>) </span>{
			<span class="hljs-keyword">if</span> ( control.params.type === <span class="hljs-string">'widget_form'</span> &amp;&amp; control.params.widget_id === widgetId ) {
				foundControl = control;
			}
		} );

		<span class="hljs-keyword">return</span> foundControl;
	};

	<span class="hljs-comment">/**
	 * Initialize Edit Menu button in Nav Menu widget.
	 */</span>
	$( <span class="hljs-built_in">document</span> ).on( <span class="hljs-string">'widget-added'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event, widgetContainer </span>) </span>{
		<span class="hljs-keyword">var</span> parsedWidgetId, widgetControl, navMenuSelect, editMenuButton;
		parsedWidgetId = parseWidgetId( widgetContainer.find( <span class="hljs-string">'&gt; .widget-inside &gt; .form &gt; .widget-id'</span> ).val() );
		<span class="hljs-keyword">if</span> ( <span class="hljs-string">'nav_menu'</span> !== parsedWidgetId.id_base ) {
			<span class="hljs-keyword">return</span>;
		}
		widgetControl = api.control( <span class="hljs-string">'widget_nav_menu['</span> + <span class="hljs-built_in">String</span>( parsedWidgetId.number ) + <span class="hljs-string">']'</span> );
		<span class="hljs-keyword">if</span> ( ! widgetControl ) {
			<span class="hljs-keyword">return</span>;
		}
		navMenuSelect = widgetContainer.find( <span class="hljs-string">'select[name*="nav_menu"]'</span> );
		editMenuButton = widgetContainer.find( <span class="hljs-string">'.edit-selected-nav-menu &gt; button'</span> );
		<span class="hljs-keyword">if</span> ( <span class="hljs-number">0</span> === navMenuSelect.length || <span class="hljs-number">0</span> === editMenuButton.length ) {
			<span class="hljs-keyword">return</span>;
		}
		navMenuSelect.on( <span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">if</span> ( api.section.has( <span class="hljs-string">'nav_menu['</span> + navMenuSelect.val() + <span class="hljs-string">']'</span> ) ) {
				editMenuButton.parent().show();
			} <span class="hljs-keyword">else</span> {
				editMenuButton.parent().hide();
			}
		});
		editMenuButton.on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> section = api.section( <span class="hljs-string">'nav_menu['</span> + navMenuSelect.val() + <span class="hljs-string">']'</span> );
			<span class="hljs-keyword">if</span> ( section ) {
				focusConstructWithBreadcrumb( section, widgetControl );
			}
		} );
	} );

	<span class="hljs-comment">/**
	 * Focus (expand) one construct and then focus on another construct after the first is collapsed.
	 *
	 * This overrides the back button to serve the purpose of breadcrumb navigation.
	 *
	 * @param {wp.customize.Section|wp.customize.Panel|wp.customize.Control} focusConstruct - The object to initially focus.
	 * @param {wp.customize.Section|wp.customize.Panel|wp.customize.Control} returnConstruct - The object to return focus.
	 */</span>
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">focusConstructWithBreadcrumb</span>(<span class="hljs-params"> focusConstruct, returnConstruct </span>) </span>{
		focusConstruct.focus();
		<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onceCollapsed</span>(<span class="hljs-params"> isExpanded </span>) </span>{
			<span class="hljs-keyword">if</span> ( ! isExpanded ) {
				focusConstruct.expanded.unbind( onceCollapsed );
				returnConstruct.focus();
			}
		}
		focusConstruct.expanded.bind( onceCollapsed );
	}

	<span class="hljs-comment">/**
	 * @param {String} widgetId
	 * @returns {Object}
	 */</span>
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseWidgetId</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> matches, parsed = {
			<span class="hljs-attr">number</span>: <span class="hljs-literal">null</span>,
			<span class="hljs-attr">id_base</span>: <span class="hljs-literal">null</span>
		};

		matches = widgetId.match( <span class="hljs-regexp">/^(.+)-(\d+)$/</span> );
		<span class="hljs-keyword">if</span> ( matches ) {
			parsed.id_base = matches[<span class="hljs-number">1</span>];
			parsed.number = <span class="hljs-built_in">parseInt</span>( matches[<span class="hljs-number">2</span>], <span class="hljs-number">10</span> );
		} <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>likely an old single widget</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			parsed.id_base = widgetId;
		}

		<span class="hljs-keyword">return</span> parsed;
	}

	<span class="hljs-comment">/**
	 * @param {String} widgetId
	 * @returns {String} settingId
	 */</span>
	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">widgetIdToSettingId</span>(<span class="hljs-params"> widgetId </span>) </span>{
		<span class="hljs-keyword">var</span> parsed = parseWidgetId( widgetId ), settingId;

		settingId = <span class="hljs-string">'widget_'</span> + parsed.id_base;
		<span class="hljs-keyword">if</span> ( parsed.number ) {
			settingId += <span class="hljs-string">'['</span> + parsed.number + <span class="hljs-string">']'</span>;
		}

		<span class="hljs-keyword">return</span> settingId;
	}

})( <span class="hljs-built_in">window</span>.wp, jQuery );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
