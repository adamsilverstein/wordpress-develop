<!DOCTYPE html>

<html>
<head>
  <title>jquery.imgareaselect.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="bookmarklet.html">
                  bookmarklet.js
                </a>
              
                
                <a class="source" href="bookmarklet.min.html">
                  bookmarklet.min.js
                </a>
              
                
                <a class="source" href="color-picker.html">
                  color-picker.js
                </a>
              
                
                <a class="source" href="comment.html">
                  comment.js
                </a>
              
                
                <a class="source" href="common.html">
                  common.js
                </a>
              
                
                <a class="source" href="custom-background.html">
                  custom-background.js
                </a>
              
                
                <a class="source" href="custom-header.html">
                  custom-header.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-nav-menus.html">
                  customize-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-widgets.html">
                  customize-widgets.js
                </a>
              
                
                <a class="source" href="dashboard.html">
                  dashboard.js
                </a>
              
                
                <a class="source" href="edit-comments.html">
                  edit-comments.js
                </a>
              
                
                <a class="source" href="editor-expand.html">
                  editor-expand.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="farbtastic.html">
                  farbtastic.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="image-edit.html">
                  image-edit.js
                </a>
              
                
                <a class="source" href="inline-edit-post.html">
                  inline-edit-post.js
                </a>
              
                
                <a class="source" href="inline-edit-tax.html">
                  inline-edit-tax.js
                </a>
              
                
                <a class="source" href="iris.min.html">
                  iris.min.js
                </a>
              
                
                <a class="source" href="language-chooser.html">
                  language-chooser.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="media-gallery.html">
                  media-gallery.js
                </a>
              
                
                <a class="source" href="media-upload.html">
                  media-upload.js
                </a>
              
                
                <a class="source" href="media.html">
                  media.js
                </a>
              
                
                <a class="source" href="nav-menu.html">
                  nav-menu.js
                </a>
              
                
                <a class="source" href="password-strength-meter.html">
                  password-strength-meter.js
                </a>
              
                
                <a class="source" href="plugin-install.html">
                  plugin-install.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="postbox.html">
                  postbox.js
                </a>
              
                
                <a class="source" href="press-this.html">
                  press-this.js
                </a>
              
                
                <a class="source" href="revisions.html">
                  revisions.js
                </a>
              
                
                <a class="source" href="set-post-thumbnail.html">
                  set-post-thumbnail.js
                </a>
              
                
                <a class="source" href="svg-painter.html">
                  svg-painter.js
                </a>
              
                
                <a class="source" href="tags-box.html">
                  tags-box.js
                </a>
              
                
                <a class="source" href="tags-suggest.html">
                  tags-suggest.js
                </a>
              
                
                <a class="source" href="tags.html">
                  tags.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="updates.html">
                  updates.js
                </a>
              
                
                <a class="source" href="user-profile.html">
                  user-profile.js
                </a>
              
                
                <a class="source" href="user-suggest.html">
                  user-suggest.js
                </a>
              
                
                <a class="source" href="widgets.html">
                  widgets.js
                </a>
              
                
                <a class="source" href="media-audio-widget.html">
                  media-audio-widget.js
                </a>
              
                
                <a class="source" href="media-image-widget.html">
                  media-image-widget.js
                </a>
              
                
                <a class="source" href="media-video-widget.html">
                  media-video-widget.js
                </a>
              
                
                <a class="source" href="media-widgets.html">
                  media-widgets.js
                </a>
              
                
                <a class="source" href="text-widgets.html">
                  text-widgets.js
                </a>
              
                
                <a class="source" href="word-count.html">
                  word-count.js
                </a>
              
                
                <a class="source" href="wp-fullscreen-stub.html">
                  wp-fullscreen-stub.js
                </a>
              
                
                <a class="source" href="xfn.html">
                  xfn.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="theme-options.html">
                  theme-options.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="showcase.html">
                  showcase.js
                </a>
              
                
                <a class="source" href="color-scheme-control.html">
                  color-scheme-control.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="customizer.html">
                  customizer.js
                </a>
              
                
                <a class="source" href="featured-content-admin.html">
                  featured-content-admin.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="jquery.scrollTo.html">
                  jquery.scrollTo.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="admin-bar.html">
                  admin-bar.js
                </a>
              
                
                <a class="source" href="autosave.html">
                  autosave.js
                </a>
              
                
                <a class="source" href="backbone.html">
                  backbone.js
                </a>
              
                
                <a class="source" href="backbone.min.html">
                  backbone.min.js
                </a>
              
                
                <a class="source" href="colorpicker.html">
                  colorpicker.js
                </a>
              
                
                <a class="source" href="comment-reply.html">
                  comment-reply.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-base.html">
                  customize-base.js
                </a>
              
                
                <a class="source" href="customize-loader.html">
                  customize-loader.js
                </a>
              
                
                <a class="source" href="customize-models.html">
                  customize-models.js
                </a>
              
                
                <a class="source" href="customize-preview-nav-menus.html">
                  customize-preview-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-preview-widgets.html">
                  customize-preview-widgets.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="customize-selective-refresh.html">
                  customize-selective-refresh.js
                </a>
              
                
                <a class="source" href="customize-views.html">
                  customize-views.js
                </a>
              
                
                <a class="source" href="heartbeat.html">
                  heartbeat.js
                </a>
              
                
                <a class="source" href="hoverIntent.html">
                  hoverIntent.js
                </a>
              
                
                <a class="source" href="imagesloaded.min.html">
                  imagesloaded.min.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.html">
                  jquery.imgareaselect.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.min.html">
                  jquery.imgareaselect.min.js
                </a>
              
                
                <a class="source" href="jquery.Jcrop.min.html">
                  jquery.Jcrop.min.js
                </a>
              
                
                <a class="source" href="jquery-migrate.html">
                  jquery-migrate.js
                </a>
              
                
                <a class="source" href="jquery-migrate.min.html">
                  jquery-migrate.min.js
                </a>
              
                
                <a class="source" href="jquery.color.min.html">
                  jquery.color.min.js
                </a>
              
                
                <a class="source" href="jquery.form.html">
                  jquery.form.js
                </a>
              
                
                <a class="source" href="jquery.form.min.html">
                  jquery.form.min.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.html">
                  jquery.hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.min.html">
                  jquery.hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.html">
                  jquery.js
                </a>
              
                
                <a class="source" href="jquery.masonry.html">
                  jquery.masonry.js
                </a>
              
                
                <a class="source" href="jquery.masonry.min.html">
                  jquery.masonry.min.js
                </a>
              
                
                <a class="source" href="jquery.query.html">
                  jquery.query.js
                </a>
              
                
                <a class="source" href="jquery.schedule.html">
                  jquery.schedule.js
                </a>
              
                
                <a class="source" href="jquery.serialize-object.html">
                  jquery.serialize-object.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.html">
                  jquery.table-hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.min.html">
                  jquery.table-hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.html">
                  jquery.ui.touch-punch.js
                </a>
              
                
                <a class="source" href="suggest.html">
                  suggest.js
                </a>
              
                
                <a class="source" href="suggest.min.html">
                  suggest.min.js
                </a>
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="autocomplete.html">
                  autocomplete.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="datepicker.html">
                  datepicker.js
                </a>
              
                
                <a class="source" href="dialog.html">
                  dialog.js
                </a>
              
                
                <a class="source" href="draggable.html">
                  draggable.js
                </a>
              
                
                <a class="source" href="droppable.html">
                  droppable.js
                </a>
              
                
                <a class="source" href="effect-blind.html">
                  effect-blind.js
                </a>
              
                
                <a class="source" href="effect-bounce.html">
                  effect-bounce.js
                </a>
              
                
                <a class="source" href="effect-clip.html">
                  effect-clip.js
                </a>
              
                
                <a class="source" href="effect-drop.html">
                  effect-drop.js
                </a>
              
                
                <a class="source" href="effect-explode.html">
                  effect-explode.js
                </a>
              
                
                <a class="source" href="effect-fade.html">
                  effect-fade.js
                </a>
              
                
                <a class="source" href="effect-fold.html">
                  effect-fold.js
                </a>
              
                
                <a class="source" href="effect-highlight.html">
                  effect-highlight.js
                </a>
              
                
                <a class="source" href="effect-puff.html">
                  effect-puff.js
                </a>
              
                
                <a class="source" href="effect-pulsate.html">
                  effect-pulsate.js
                </a>
              
                
                <a class="source" href="effect-scale.html">
                  effect-scale.js
                </a>
              
                
                <a class="source" href="effect-shake.html">
                  effect-shake.js
                </a>
              
                
                <a class="source" href="effect-size.html">
                  effect-size.js
                </a>
              
                
                <a class="source" href="effect-slide.html">
                  effect-slide.js
                </a>
              
                
                <a class="source" href="effect-transfer.html">
                  effect-transfer.js
                </a>
              
                
                <a class="source" href="effect.html">
                  effect.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="position.html">
                  position.js
                </a>
              
                
                <a class="source" href="progressbar.html">
                  progressbar.js
                </a>
              
                
                <a class="source" href="resizable.html">
                  resizable.js
                </a>
              
                
                <a class="source" href="selectable.html">
                  selectable.js
                </a>
              
                
                <a class="source" href="selectmenu.html">
                  selectmenu.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="sortable.html">
                  sortable.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="widget.html">
                  widget.js
                </a>
              
                
                <a class="source" href="json2.html">
                  json2.js
                </a>
              
                
                <a class="source" href="masonry.min.html">
                  masonry.min.js
                </a>
              
                
                <a class="source" href="mce-view.html">
                  mce-view.js
                </a>
              
                
                <a class="source" href="media-audiovideo.html">
                  media-audiovideo.js
                </a>
              
                
                <a class="source" href="media-editor.html">
                  media-editor.js
                </a>
              
                
                <a class="source" href="media-grid.html">
                  media-grid.js
                </a>
              
                
                <a class="source" href="media-models.html">
                  media-models.js
                </a>
              
                
                <a class="source" href="media-views.html">
                  media-views.js
                </a>
              
                
                <a class="source" href="audiovideo.manifest.html">
                  audiovideo.manifest.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="collection-add.html">
                  collection-add.js
                </a>
              
                
                <a class="source" href="collection-edit.html">
                  collection-edit.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-image-cropper.html">
                  customize-image-cropper.js
                </a>
              
                
                <a class="source" href="edit-attachment-metadata.html">
                  edit-attachment-metadata.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="featured-image.html">
                  featured-image.js
                </a>
              
                
                <a class="source" href="gallery-add.html">
                  gallery-add.js
                </a>
              
                
                <a class="source" href="gallery-edit.html">
                  gallery-edit.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="media-library.html">
                  media-library.js
                </a>
              
                
                <a class="source" href="region.html">
                  region.js
                </a>
              
                
                <a class="source" href="replace-image.html">
                  replace-image.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="state-machine.html">
                  state-machine.js
                </a>
              
                
                <a class="source" href="state.html">
                  state.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="grid.manifest.html">
                  grid.manifest.js
                </a>
              
                
                <a class="source" href="models.manifest.html">
                  models.manifest.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="post-image.html">
                  post-image.js
                </a>
              
                
                <a class="source" href="post-media.html">
                  post-media.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="selection-sync.html">
                  selection-sync.js
                </a>
              
                
                <a class="source" href="views.manifest.html">
                  views.manifest.js
                </a>
              
                
                <a class="source" href="attachment-compat.html">
                  attachment-compat.js
                </a>
              
                
                <a class="source" href="attachment-filters.html">
                  attachment-filters.js
                </a>
              
                
                <a class="source" href="all.html">
                  all.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="uploaded.html">
                  uploaded.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="details-two-column.html">
                  details-two-column.js
                </a>
              
                
                <a class="source" href="details.html">
                  details.js
                </a>
              
                
                <a class="source" href="edit-library.html">
                  edit-library.js
                </a>
              
                
                <a class="source" href="edit-selection.html">
                  edit-selection.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="browser.html">
                  browser.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="button-group.html">
                  button-group.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="delete-selected-permanently.html">
                  delete-selected-permanently.js
                </a>
              
                
                <a class="source" href="delete-selected.html">
                  delete-selected.js
                </a>
              
                
                <a class="source" href="select-mode-toggle.html">
                  select-mode-toggle.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="edit-image-details.html">
                  edit-image-details.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="image.html">
                  image.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="url.html">
                  url.js
                </a>
              
                
                <a class="source" href="focus-manager.html">
                  focus-manager.js
                </a>
              
                
                <a class="source" href="frame.html">
                  frame.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="edit-attachments.html">
                  edit-attachments.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="iframe.html">
                  iframe.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="label.html">
                  label.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="media-frame.html">
                  media-frame.js
                </a>
              
                
                <a class="source" href="menu-item.html">
                  menu-item.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="priority-list.html">
                  priority-list.js
                </a>
              
                
                <a class="source" href="router-item.html">
                  router-item.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="attachment-display.html">
                  attachment-display.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="playlist.html">
                  playlist.js
                </a>
              
                
                <a class="source" href="sidebar.html">
                  sidebar.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="site-icon-preview.html">
                  site-icon-preview.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="toolbar.html">
                  toolbar.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="inline.html">
                  inline.js
                </a>
              
                
                <a class="source" href="status-error.html">
                  status-error.js
                </a>
              
                
                <a class="source" href="status.html">
                  status.js
                </a>
              
                
                <a class="source" href="window.html">
                  window.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="view.html">
                  view.js
                </a>
              
                
                <a class="source" href="froogaloop.min.html">
                  froogaloop.min.js
                </a>
              
                
                <a class="source" href="mediaelement-and-player.min.html">
                  mediaelement-and-player.min.js
                </a>
              
                
                <a class="source" href="wp-mediaelement.html">
                  wp-mediaelement.js
                </a>
              
                
                <a class="source" href="wp-playlist.html">
                  wp-playlist.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="plupload.full.min.html">
                  plupload.full.min.js
                </a>
              
                
                <a class="source" href="wp-plupload.html">
                  wp-plupload.js
                </a>
              
                
                <a class="source" href="quicktags.html">
                  quicktags.js
                </a>
              
                
                <a class="source" href="shortcode.html">
                  shortcode.js
                </a>
              
                
                <a class="source" href="swfobject.html">
                  swfobject.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="handlers.min.html">
                  handlers.min.js
                </a>
              
                
                <a class="source" href="swfupload.cookies.html">
                  swfupload.cookies.js
                </a>
              
                
                <a class="source" href="swfupload.queue.html">
                  swfupload.queue.js
                </a>
              
                
                <a class="source" href="swfupload.speed.html">
                  swfupload.speed.js
                </a>
              
                
                <a class="source" href="swfupload.swfobject.html">
                  swfupload.swfobject.js
                </a>
              
                
                <a class="source" href="swfupload.html">
                  swfupload.js
                </a>
              
                
                <a class="source" href="thickbox.html">
                  thickbox.js
                </a>
              
                
                <a class="source" href="wp-langs-en.html">
                  wp-langs-en.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="tiny_mce_popup.html">
                  tiny_mce_popup.js
                </a>
              
                
                <a class="source" href="tinymce.html">
                  tinymce.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="editable_selects.html">
                  editable_selects.js
                </a>
              
                
                <a class="source" href="form_utils.html">
                  form_utils.js
                </a>
              
                
                <a class="source" href="mctabs.html">
                  mctabs.js
                </a>
              
                
                <a class="source" href="validate.html">
                  validate.js
                </a>
              
                
                <a class="source" href="tw-sack.html">
                  tw-sack.js
                </a>
              
                
                <a class="source" href="twemoji.html">
                  twemoji.js
                </a>
              
                
                <a class="source" href="underscore.html">
                  underscore.js
                </a>
              
                
                <a class="source" href="underscore.min.html">
                  underscore.min.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="wp-a11y.html">
                  wp-a11y.js
                </a>
              
                
                <a class="source" href="wp-ajax-response.html">
                  wp-ajax-response.js
                </a>
              
                
                <a class="source" href="wp-api.html">
                  wp-api.js
                </a>
              
                
                <a class="source" href="wp-auth-check.html">
                  wp-auth-check.js
                </a>
              
                
                <a class="source" href="wp-backbone.html">
                  wp-backbone.js
                </a>
              
                
                <a class="source" href="wp-custom-header.html">
                  wp-custom-header.js
                </a>
              
                
                <a class="source" href="wp-embed-template.html">
                  wp-embed-template.js
                </a>
              
                
                <a class="source" href="wp-embed.html">
                  wp-embed.js
                </a>
              
                
                <a class="source" href="wp-emoji-loader.html">
                  wp-emoji-loader.js
                </a>
              
                
                <a class="source" href="wp-emoji.html">
                  wp-emoji.js
                </a>
              
                
                <a class="source" href="wp-list-revisions.html">
                  wp-list-revisions.js
                </a>
              
                
                <a class="source" href="wp-lists.html">
                  wp-lists.js
                </a>
              
                
                <a class="source" href="wp-pointer.html">
                  wp-pointer.js
                </a>
              
                
                <a class="source" href="wp-util.html">
                  wp-util.js
                </a>
              
                
                <a class="source" href="wpdialog.html">
                  wpdialog.js
                </a>
              
                
                <a class="source" href="wplink.html">
                  wplink.js
                </a>
              
                
                <a class="source" href="zxcvbn-async.html">
                  zxcvbn-async.js
                </a>
              
                
                <a class="source" href="zxcvbn.min.html">
                  zxcvbn.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>jquery.imgareaselect.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*
 * imgAreaSelect jQuery plugin
 * version 0.9.10-monkey
 *
 * Copyright (c) 2008-2013 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/imgareaselect/
 *
 */</span>

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$</span>) </span>{

<span class="hljs-comment">/*
 * Math functions will be used extensively, so it's convenient to make a few
 * shortcuts
 */</span>
<span class="hljs-keyword">var</span> abs = <span class="hljs-built_in">Math</span>.abs,
    max = <span class="hljs-built_in">Math</span>.max,
    min = <span class="hljs-built_in">Math</span>.min,
    round = <span class="hljs-built_in">Math</span>.round;

<span class="hljs-comment">/**
 * Create a new HTML div element
 *
 * @return A jQuery object representing the new element
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">div</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> $(<span class="hljs-string">'&lt;div/&gt;'</span>);
}

<span class="hljs-comment">/**
 * imgAreaSelect initialization
 *
 * @param img
 *            A HTML image element to attach the plugin to
 * @param options
 *            An options object
 */</span>
$.imgAreaSelect = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">img, options</span>) </span>{
    <span class="hljs-keyword">var</span>
        <span class="hljs-comment">/* jQuery object representing the image */</span>
        $img = $(img),

        <span class="hljs-comment">/* Has the image finished loading? */</span>
        imgLoaded,

        <span class="hljs-comment">/* Plugin elements */</span>

        <span class="hljs-comment">/* Container box */</span>
        $box = div(),
        <span class="hljs-comment">/* Selection area */</span>
        $area = div(),
        <span class="hljs-comment">/* Border (four divs) */</span>
        $border = div().add(div()).add(div()).add(div()),
        <span class="hljs-comment">/* Outer area (four divs) */</span>
        $outer = div().add(div()).add(div()).add(div()),
        <span class="hljs-comment">/* Handles (empty by default, initialized in setOptions()) */</span>
        $handles = $([]),

        <span class="hljs-comment">/*
         * Additional element to work around a cursor problem in Opera
         * (explained later)
         */</span>
        $areaOpera,

        <span class="hljs-comment">/* Image position (relative to viewport) */</span>
        left, top,

        <span class="hljs-comment">/* Image offset (as returned by .offset()) */</span>
        imgOfs = { <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> },

        <span class="hljs-comment">/* Image dimensions (as returned by .width() and .height()) */</span>
        imgWidth, imgHeight,

        <span class="hljs-comment">/*
         * jQuery object representing the parent element that the plugin
         * elements are appended to
         */</span>
        $parent,

        <span class="hljs-comment">/* Parent element offset (as returned by .offset()) */</span>
        parOfs = { <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> },

        <span class="hljs-comment">/* Base z-index for plugin elements */</span>
        zIndex = <span class="hljs-number">0</span>,

        <span class="hljs-comment">/* Plugin elements position */</span>
        position = <span class="hljs-string">'absolute'</span>,

        <span class="hljs-comment">/* X/Y coordinates of the starting point for move/resize operations */</span>
        startX, startY,

        <span class="hljs-comment">/* Horizontal and vertical scaling factors */</span>
        scaleX, scaleY,

        <span class="hljs-comment">/* Current resize mode ("nw", "se", etc.) */</span>
        resize,

        <span class="hljs-comment">/* Selection area constraints */</span>
        minWidth, minHeight, maxWidth, maxHeight,

        <span class="hljs-comment">/* Aspect ratio to maintain (floating point number) */</span>
        aspectRatio,

        <span class="hljs-comment">/* Are the plugin elements currently displayed? */</span>
        shown,

        <span class="hljs-comment">/* Current selection (relative to parent element) */</span>
        x1, y1, x2, y2,

        <span class="hljs-comment">/* Current selection (relative to scaled image) */</span>
        selection = { <span class="hljs-attr">x1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y1</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">x2</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y2</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">0</span> },

        <span class="hljs-comment">/* Document element */</span>
        docElem = <span class="hljs-built_in">document</span>.documentElement,

        <span class="hljs-comment">/* User agent */</span>
        ua = navigator.userAgent,

        <span class="hljs-comment">/* Various helper variables used throughout the code */</span>
        $p, d, i, o, w, h, adjusted;

    <span class="hljs-comment">/*
     * Translate selection coordinates (relative to scaled image) to viewport
     * coordinates (relative to parent element)
     */</span>

    <span class="hljs-comment">/**
     * Translate selection X to viewport X
     *
     * @param x
     *            Selection X
     * @return Viewport X
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewX</span>(<span class="hljs-params">x</span>) </span>{
        <span class="hljs-keyword">return</span> x + imgOfs.left - parOfs.left;
    }

    <span class="hljs-comment">/**
     * Translate selection Y to viewport Y
     *
     * @param y
     *            Selection Y
     * @return Viewport Y
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">viewY</span>(<span class="hljs-params">y</span>) </span>{
        <span class="hljs-keyword">return</span> y + imgOfs.top - parOfs.top;
    }

    <span class="hljs-comment">/*
     * Translate viewport coordinates to selection coordinates
     */</span>

    <span class="hljs-comment">/**
     * Translate viewport X to selection X
     *
     * @param x
     *            Viewport X
     * @return Selection X
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selX</span>(<span class="hljs-params">x</span>) </span>{
        <span class="hljs-keyword">return</span> x - imgOfs.left + parOfs.left;
    }

    <span class="hljs-comment">/**
     * Translate viewport Y to selection Y
     *
     * @param y
     *            Viewport Y
     * @return Selection Y
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selY</span>(<span class="hljs-params">y</span>) </span>{
        <span class="hljs-keyword">return</span> y - imgOfs.top + parOfs.top;
    }

    <span class="hljs-comment">/*
     * Translate event coordinates (relative to document) to viewport
     * coordinates
     */</span>

    <span class="hljs-comment">/**
     * Get event X and translate it to viewport X
     *
     * @param event
     *            The event object
     * @return Viewport X
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evX</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">return</span> max(event.pageX || <span class="hljs-number">0</span>, touchCoords(event).x) - parOfs.left;
    }

    <span class="hljs-comment">/**
     * Get event Y and translate it to viewport Y
     *
     * @param event
     *            The event object
     * @return Viewport Y
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">evY</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">return</span> max(event.pageY || <span class="hljs-number">0</span>, touchCoords(event).y) - parOfs.top;
    }

    <span class="hljs-comment">/**
     * Get X and Y coordinates of a touch event
     *
     * @param event
     *            The event object
     * @return Coordinates object
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">touchCoords</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">var</span> oev = event.originalEvent || {};

        <span class="hljs-keyword">if</span> (oev.touches &amp;&amp; oev.touches.length)
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: oev.touches[<span class="hljs-number">0</span>].pageX, <span class="hljs-attr">y</span>: oev.touches[<span class="hljs-number">0</span>].pageY };
        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };
    }

    <span class="hljs-comment">/**
     * Get the current selection
     *
     * @param noScale
     *            If set to &lt;code&gt;true&lt;/code&gt;, scaling is not applied to the
     *            returned selection
     * @return Selection object
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSelection</span>(<span class="hljs-params">noScale</span>) </span>{
        <span class="hljs-keyword">var</span> sx = noScale || scaleX, sy = noScale || scaleY;

        <span class="hljs-keyword">return</span> { <span class="hljs-attr">x1</span>: round(selection.x1 * sx),
            <span class="hljs-attr">y1</span>: round(selection.y1 * sy),
            <span class="hljs-attr">x2</span>: round(selection.x2 * sx),
            <span class="hljs-attr">y2</span>: round(selection.y2 * sy),
            <span class="hljs-attr">width</span>: round(selection.x2 * sx) - round(selection.x1 * sx),
            <span class="hljs-attr">height</span>: round(selection.y2 * sy) - round(selection.y1 * sy) };
    }

    <span class="hljs-comment">/**
     * Set the current selection
     *
     * @param x1
     *            X coordinate of the upper left corner of the selection area
     * @param y1
     *            Y coordinate of the upper left corner of the selection area
     * @param x2
     *            X coordinate of the lower right corner of the selection area
     * @param y2
     *            Y coordinate of the lower right corner of the selection area
     * @param noScale
     *            If set to &lt;code&gt;true&lt;/code&gt;, scaling is not applied to the
     *            new selection
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setSelection</span>(<span class="hljs-params">x1, y1, x2, y2, noScale</span>) </span>{
        <span class="hljs-keyword">var</span> sx = noScale || scaleX, sy = noScale || scaleY;

        selection = {
            <span class="hljs-attr">x1</span>: round(x1 / sx || <span class="hljs-number">0</span>),
            <span class="hljs-attr">y1</span>: round(y1 / sy || <span class="hljs-number">0</span>),
            <span class="hljs-attr">x2</span>: round(x2 / sx || <span class="hljs-number">0</span>),
            <span class="hljs-attr">y2</span>: round(y2 / sy || <span class="hljs-number">0</span>)
        };

        selection.width = selection.x2 - selection.x1;
        selection.height = selection.y2 - selection.y1;
    }

    <span class="hljs-comment">/**
     * Recalculate image and parent offsets
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">adjust</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">/*
         * Do not adjust if image has not yet loaded or if width is not a
         * positive number. The latter might happen when imgAreaSelect is put
         * on a parent element which is then hidden.
         */</span>
        <span class="hljs-keyword">if</span> (!imgLoaded || !$img.width())
            <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">/*
         * Get image offset. The .offset() method returns float values, so they
         * need to be rounded.
         */</span>
        imgOfs = { <span class="hljs-attr">left</span>: round($img.offset().left), <span class="hljs-attr">top</span>: round($img.offset().top) };

        <span class="hljs-comment">/* Get image dimensions */</span>
        imgWidth = $img.innerWidth();
        imgHeight = $img.innerHeight();

        imgOfs.top += ($img.outerHeight() - imgHeight) &gt;&gt; <span class="hljs-number">1</span>;
        imgOfs.left += ($img.outerWidth() - imgWidth) &gt;&gt; <span class="hljs-number">1</span>;

        <span class="hljs-comment">/* Set minimum and maximum selection area dimensions */</span>
        minWidth = round(options.minWidth / scaleX) || <span class="hljs-number">0</span>;
        minHeight = round(options.minHeight / scaleY) || <span class="hljs-number">0</span>;
        maxWidth = round(min(options.maxWidth / scaleX || <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">24</span>, imgWidth));
        maxHeight = round(min(options.maxHeight / scaleY || <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">24</span>, imgHeight));

        <span class="hljs-comment">/*
         * Workaround for jQuery 1.3.2 incorrect offset calculation, originally
         * observed in Safari 3. Firefox 2 is also affected.
         */</span>
        <span class="hljs-keyword">if</span> ($().jquery == <span class="hljs-string">'1.3.2'</span> &amp;&amp; position == <span class="hljs-string">'fixed'</span> &amp;&amp;
            !docElem[<span class="hljs-string">'getBoundingClientRect'</span>])
        {
            imgOfs.top += max(<span class="hljs-built_in">document</span>.body.scrollTop, docElem.scrollTop);
            imgOfs.left += max(<span class="hljs-built_in">document</span>.body.scrollLeft, docElem.scrollLeft);
        }

        <span class="hljs-comment">/* Determine parent element offset */</span>
        parOfs = <span class="hljs-regexp">/absolute|relative/</span>.test($parent.css(<span class="hljs-string">'position'</span>)) ?
            { <span class="hljs-attr">left</span>: round($parent.offset().left) - $parent.scrollLeft(),
                <span class="hljs-attr">top</span>: round($parent.offset().top) - $parent.scrollTop() } :
            position == <span class="hljs-string">'fixed'</span> ?
                { <span class="hljs-attr">left</span>: $(<span class="hljs-built_in">document</span>).scrollLeft(), <span class="hljs-attr">top</span>: $(<span class="hljs-built_in">document</span>).scrollTop() } :
                { <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> };

        left = viewX(<span class="hljs-number">0</span>);
        top = viewY(<span class="hljs-number">0</span>);

        <span class="hljs-comment">/*
         * Check if selection area is within image boundaries, adjust if
         * necessary
         */</span>
        <span class="hljs-keyword">if</span> (selection.x2 &gt; imgWidth || selection.y2 &gt; imgHeight)
            doResize();
    }

    <span class="hljs-comment">/**
     * Update plugin elements
     *
     * @param resetKeyPress
     *            If set to &lt;code&gt;false&lt;/code&gt;, this instance's keypress
     *            event handler is not activated
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span>(<span class="hljs-params">resetKeyPress</span>) </span>{
        <span class="hljs-comment">/* If plugin elements are hidden, do nothing */</span>
        <span class="hljs-keyword">if</span> (!shown) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">/*
         * Set the position and size of the container box and the selection area
         * inside it
         */</span>
        $box.css({ <span class="hljs-attr">left</span>: viewX(selection.x1), <span class="hljs-attr">top</span>: viewY(selection.y1) })
            .add($area).width(w = selection.width).height(h = selection.height);

        <span class="hljs-comment">/*
         * Reset the position of selection area, borders, and handles (IE6/IE7
         * position them incorrectly if we don't do this)
         */</span>
        $area.add($border).add($handles).css({ <span class="hljs-attr">left</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> });

        <span class="hljs-comment">/* Set border dimensions */</span>
        $border
            .width(max(w - $border.outerWidth() + $border.innerWidth(), <span class="hljs-number">0</span>))
            .height(max(h - $border.outerHeight() + $border.innerHeight(), <span class="hljs-number">0</span>));

        <span class="hljs-comment">/* Arrange the outer area elements */</span>
        $($outer[<span class="hljs-number">0</span>]).css({ <span class="hljs-attr">left</span>: left, <span class="hljs-attr">top</span>: top,
            <span class="hljs-attr">width</span>: selection.x1, <span class="hljs-attr">height</span>: imgHeight });
        $($outer[<span class="hljs-number">1</span>]).css({ <span class="hljs-attr">left</span>: left + selection.x1, <span class="hljs-attr">top</span>: top,
            <span class="hljs-attr">width</span>: w, <span class="hljs-attr">height</span>: selection.y1 });
        $($outer[<span class="hljs-number">2</span>]).css({ <span class="hljs-attr">left</span>: left + selection.x2, <span class="hljs-attr">top</span>: top,
            <span class="hljs-attr">width</span>: imgWidth - selection.x2, <span class="hljs-attr">height</span>: imgHeight });
        $($outer[<span class="hljs-number">3</span>]).css({ <span class="hljs-attr">left</span>: left + selection.x1, <span class="hljs-attr">top</span>: top + selection.y2,
            <span class="hljs-attr">width</span>: w, <span class="hljs-attr">height</span>: imgHeight - selection.y2 });

        w -= $handles.outerWidth();
        h -= $handles.outerHeight();

        <span class="hljs-comment">/* Arrange handles */</span>
        <span class="hljs-keyword">switch</span> ($handles.length) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">8</span>:
            $($handles[<span class="hljs-number">4</span>]).css({ <span class="hljs-attr">left</span>: w &gt;&gt; <span class="hljs-number">1</span> });
            $($handles[<span class="hljs-number">5</span>]).css({ <span class="hljs-attr">left</span>: w, <span class="hljs-attr">top</span>: h &gt;&gt; <span class="hljs-number">1</span> });
            $($handles[<span class="hljs-number">6</span>]).css({ <span class="hljs-attr">left</span>: w &gt;&gt; <span class="hljs-number">1</span>, <span class="hljs-attr">top</span>: h });
            $($handles[<span class="hljs-number">7</span>]).css({ <span class="hljs-attr">top</span>: h &gt;&gt; <span class="hljs-number">1</span> });
        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:
            $handles.slice(<span class="hljs-number">1</span>,<span class="hljs-number">3</span>).css({ <span class="hljs-attr">left</span>: w });
            $handles.slice(<span class="hljs-number">2</span>,<span class="hljs-number">4</span>).css({ <span class="hljs-attr">top</span>: h });
        }

        <span class="hljs-keyword">if</span> (resetKeyPress !== <span class="hljs-literal">false</span>) {
            <span class="hljs-comment">/*
             * Need to reset the document keypress event handler -- unbind the
             * current handler
             */</span>
            <span class="hljs-keyword">if</span> ($.imgAreaSelect.onKeyPress != docKeyPress)
                $(<span class="hljs-built_in">document</span>).unbind($.imgAreaSelect.keyPress,
                    $.imgAreaSelect.onKeyPress);

            <span class="hljs-keyword">if</span> (options.keys)
                <span class="hljs-comment">/*
                 * Set the document keypress event handler to this instance's
                 * docKeyPress() function
                 */</span>
                $(<span class="hljs-built_in">document</span>)[$.imgAreaSelect.keyPress](
                    $.imgAreaSelect.onKeyPress = docKeyPress);
        }

        <span class="hljs-comment">/*
         * Internet Explorer displays 1px-wide dashed borders incorrectly by
         * filling the spaces between dashes with white. Toggling the margin
         * property between 0 and "auto" fixes this in IE6 and IE7 (IE8 is still
         * broken). This workaround is not perfect, as it requires setTimeout()
         * and thus causes the border to flicker a bit, but I haven't found a
         * better solution.
         *
         * Note: This only happens with CSS borders, set with the borderWidth,
         * borderOpacity, borderColor1, and borderColor2 options (which are now
         * deprecated). Borders created with GIF background images are fine.
         */</span>
        <span class="hljs-keyword">if</span> (msie &amp;&amp; $border.outerWidth() - $border.innerWidth() == <span class="hljs-number">2</span>) {
            $border.css(<span class="hljs-string">'margin'</span>, <span class="hljs-number">0</span>);
            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ $border.css(<span class="hljs-string">'margin'</span>, <span class="hljs-string">'auto'</span>); }, <span class="hljs-number">0</span>);
        }
    }

    <span class="hljs-comment">/**
     * Do the complete update sequence: recalculate offsets, update the
     * elements, and set the correct values of x1, y1, x2, and y2.
     *
     * @param resetKeyPress
     *            If set to &lt;code&gt;false&lt;/code&gt;, this instance's keypress
     *            event handler is not activated
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doUpdate</span>(<span class="hljs-params">resetKeyPress</span>) </span>{
        adjust();
        update(resetKeyPress);
        x1 = viewX(selection.x1); y1 = viewY(selection.y1);
        x2 = viewX(selection.x2); y2 = viewY(selection.y2);
    }

    <span class="hljs-comment">/**
     * Hide or fade out an element (or multiple elements)
     *
     * @param $elem
     *            A jQuery object containing the element(s) to hide/fade out
     * @param fn
     *            Callback function to be called when fadeOut() completes
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hide</span>(<span class="hljs-params">$elem, fn</span>) </span>{
        options.fadeSpeed ? $elem.fadeOut(options.fadeSpeed, fn) : $elem.hide();
    }

    <span class="hljs-comment">/**
     * Selection area mousemove event handler
     *
     * @param event
     *            The event object
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">areaMouseMove</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">var</span> x = selX(evX(event)) - selection.x1,
            y = selY(evY(event)) - selection.y1;

        <span class="hljs-keyword">if</span> (!adjusted) {
            adjust();
            adjusted = <span class="hljs-literal">true</span>;

            $box.one(<span class="hljs-string">'mouseout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ adjusted = <span class="hljs-literal">false</span>; });
        }

        <span class="hljs-comment">/* Clear the resize mode */</span>
        resize = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">if</span> (options.resizable) {
            <span class="hljs-comment">/*
             * Check if the mouse pointer is over the resize margin area and set
             * the resize mode accordingly
             */</span>
            <span class="hljs-keyword">if</span> (y &lt;= options.resizeMargin)
                resize = <span class="hljs-string">'n'</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt;= selection.height - options.resizeMargin)
                resize = <span class="hljs-string">'s'</span>;
            <span class="hljs-keyword">if</span> (x &lt;= options.resizeMargin)
                resize += <span class="hljs-string">'w'</span>;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x &gt;= selection.width - options.resizeMargin)
                resize += <span class="hljs-string">'e'</span>;
        }

        $box.css(<span class="hljs-string">'cursor'</span>, resize ? resize + <span class="hljs-string">'-resize'</span> :
            options.movable ? <span class="hljs-string">'move'</span> : <span class="hljs-string">''</span>);
        <span class="hljs-keyword">if</span> ($areaOpera)
            $areaOpera.toggle();
    }

    <span class="hljs-comment">/**
     * Document mouseup event handler
     *
     * @param event
     *            The event object
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">docMouseUp</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-comment">/* Set back the default cursor */</span>
        $(<span class="hljs-string">'body'</span>).css(<span class="hljs-string">'cursor'</span>, <span class="hljs-string">''</span>);
        <span class="hljs-comment">/*
         * If autoHide is enabled, or if the selection has zero width/height,
         * hide the selection and the outer area
         */</span>
        <span class="hljs-keyword">if</span> (options.autoHide || selection.width * selection.height == <span class="hljs-number">0</span>)
            hide($box.add($outer), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ $(<span class="hljs-keyword">this</span>).hide(); });

        $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'mousemove touchmove'</span>, selectingMouseMove);
        $box.on(<span class="hljs-string">'mousemove touchmove'</span>, areaMouseMove);

        options.onSelectEnd(img, getSelection());
    }

    <span class="hljs-comment">/**
     * Selection area mousedown event handler
     *
     * @param event
     *            The event object
     * @return false
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">areaMouseDown</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">if</span> (event.type == <span class="hljs-string">'mousedown'</span> &amp;&amp; event.which != <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

    	<span class="hljs-comment">/*
    	 * With mobile browsers, there is no "moving the pointer over" action,
    	 * so we need to simulate one mousemove event happening prior to
    	 * mousedown/touchstart.
    	 */</span>
    	areaMouseMove(event);

        adjust();

        <span class="hljs-keyword">if</span> (resize) {
            <span class="hljs-comment">/* Resize mode is in effect */</span>
            $(<span class="hljs-string">'body'</span>).css(<span class="hljs-string">'cursor'</span>, resize + <span class="hljs-string">'-resize'</span>);

            x1 = viewX(selection[<span class="hljs-regexp">/w/</span>.test(resize) ? <span class="hljs-string">'x2'</span> : <span class="hljs-string">'x1'</span>]);
            y1 = viewY(selection[<span class="hljs-regexp">/n/</span>.test(resize) ? <span class="hljs-string">'y2'</span> : <span class="hljs-string">'y1'</span>]);

            $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'mousemove touchmove'</span>, selectingMouseMove)
                .one(<span class="hljs-string">'mouseup touchend'</span>, docMouseUp);
            $box.off(<span class="hljs-string">'mousemove touchmove'</span>, areaMouseMove);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options.movable) {
            startX = left + selection.x1 - evX(event);
            startY = top + selection.y1 - evY(event);

            $box.off(<span class="hljs-string">'mousemove touchmove'</span>, areaMouseMove);

            $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'mousemove touchmove'</span>, movingMouseMove)
                .one(<span class="hljs-string">'mouseup touchend'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    options.onSelectEnd(img, getSelection());

                    $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'mousemove touchmove'</span>, movingMouseMove);
                    $box.on(<span class="hljs-string">'mousemove touchmove'</span>, areaMouseMove);
                });
        }
        <span class="hljs-keyword">else</span>
            $img.mousedown(event);

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">/**
     * Adjust the x2/y2 coordinates to maintain aspect ratio (if defined)
     *
     * @param xFirst
     *            If set to &lt;code&gt;true&lt;/code&gt;, calculate x2 first. Otherwise,
     *            calculate y2 first.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fixAspectRatio</span>(<span class="hljs-params">xFirst</span>) </span>{
        <span class="hljs-keyword">if</span> (aspectRatio)
            <span class="hljs-keyword">if</span> (xFirst) {
                x2 = max(left, min(left + imgWidth,
                    x1 + abs(y2 - y1) * aspectRatio * (x2 &gt; x1 || <span class="hljs-number">-1</span>)));
                y2 = round(max(top, min(top + imgHeight,
                    y1 + abs(x2 - x1) / aspectRatio * (y2 &gt; y1 || <span class="hljs-number">-1</span>))));
                x2 = round(x2);
            }
            <span class="hljs-keyword">else</span> {
                y2 = max(top, min(top + imgHeight,
                    y1 + abs(x2 - x1) / aspectRatio * (y2 &gt; y1 || <span class="hljs-number">-1</span>)));
                x2 = round(max(left, min(left + imgWidth,
                    x1 + abs(y2 - y1) * aspectRatio * (x2 &gt; x1 || <span class="hljs-number">-1</span>))));
                y2 = round(y2);
            }
    }

    <span class="hljs-comment">/**
     * Resize the selection area respecting the minimum/maximum dimensions and
     * aspect ratio
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doResize</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">/*
         * Make sure the top left corner of the selection area stays within
         * image boundaries (it might not if the image source was dynamically
         * changed).
         */</span>
        x1 = min(x1, left + imgWidth);
        y1 = min(y1, top + imgHeight);

        <span class="hljs-keyword">if</span> (abs(x2 - x1) &lt; minWidth) {
            <span class="hljs-comment">/* Selection width is smaller than minWidth */</span>
            x2 = x1 - minWidth * (x2 &lt; x1 || <span class="hljs-number">-1</span>);

            <span class="hljs-keyword">if</span> (x2 &lt; left)
                x1 = left + minWidth;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x2 &gt; left + imgWidth)
                x1 = left + imgWidth - minWidth;
        }

        <span class="hljs-keyword">if</span> (abs(y2 - y1) &lt; minHeight) {
            <span class="hljs-comment">/* Selection height is smaller than minHeight */</span>
            y2 = y1 - minHeight * (y2 &lt; y1 || <span class="hljs-number">-1</span>);

            <span class="hljs-keyword">if</span> (y2 &lt; top)
                y1 = top + minHeight;
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y2 &gt; top + imgHeight)
                y1 = top + imgHeight - minHeight;
        }

        x2 = max(left, min(x2, left + imgWidth));
        y2 = max(top, min(y2, top + imgHeight));

        fixAspectRatio(abs(x2 - x1) &lt; abs(y2 - y1) * aspectRatio);

        <span class="hljs-keyword">if</span> (abs(x2 - x1) &gt; maxWidth) {
            <span class="hljs-comment">/* Selection width is greater than maxWidth */</span>
            x2 = x1 - maxWidth * (x2 &lt; x1 || <span class="hljs-number">-1</span>);
            fixAspectRatio();
        }

        <span class="hljs-keyword">if</span> (abs(y2 - y1) &gt; maxHeight) {
            <span class="hljs-comment">/* Selection height is greater than maxHeight */</span>
            y2 = y1 - maxHeight * (y2 &lt; y1 || <span class="hljs-number">-1</span>);
            fixAspectRatio(<span class="hljs-literal">true</span>);
        }

        selection = { <span class="hljs-attr">x1</span>: selX(min(x1, x2)), <span class="hljs-attr">x2</span>: selX(max(x1, x2)),
            <span class="hljs-attr">y1</span>: selY(min(y1, y2)), <span class="hljs-attr">y2</span>: selY(max(y1, y2)),
            <span class="hljs-attr">width</span>: abs(x2 - x1), <span class="hljs-attr">height</span>: abs(y2 - y1) };

        update();

        options.onSelectChange(img, getSelection());
    }

    <span class="hljs-comment">/**
     * Mousemove event handler triggered when the user is selecting an area
     *
     * @param event
     *            The event object
     * @return false
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">selectingMouseMove</span>(<span class="hljs-params">event</span>) </span>{
        x2 = <span class="hljs-regexp">/w|e|^$/</span>.test(resize) || aspectRatio ? evX(event) : viewX(selection.x2);
        y2 = <span class="hljs-regexp">/n|s|^$/</span>.test(resize) || aspectRatio ? evY(event) : viewY(selection.y2);

        doResize();

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">/**
     * Move the selection area
     *
     * @param newX1
     *            New viewport X1
     * @param newY1
     *            New viewport Y1
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doMove</span>(<span class="hljs-params">newX1, newY1</span>) </span>{
        x2 = (x1 = newX1) + selection.width;
        y2 = (y1 = newY1) + selection.height;

        $.extend(selection, { <span class="hljs-attr">x1</span>: selX(x1), <span class="hljs-attr">y1</span>: selY(y1), <span class="hljs-attr">x2</span>: selX(x2),
            <span class="hljs-attr">y2</span>: selY(y2) });

        update();

        options.onSelectChange(img, getSelection());
    }

    <span class="hljs-comment">/**
     * Mousemove event handler triggered when the selection area is being moved
     *
     * @param event
     *            The event object
     * @return false
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">movingMouseMove</span>(<span class="hljs-params">event</span>) </span>{
        x1 = max(left, min(startX + evX(event), left + imgWidth - selection.width));
        y1 = max(top, min(startY + evY(event), top + imgHeight - selection.height));

        doMove(x1, y1);

        event.preventDefault();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">/**
     * Start selection
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startSelection</span>(<span class="hljs-params"></span>) </span>{
        $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'mousemove touchmove'</span>, startSelection);
        adjust();

        x2 = x1;
        y2 = y1;
        doResize();

        resize = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">if</span> (!$outer.is(<span class="hljs-string">':visible'</span>))
            <span class="hljs-comment">/* Show the plugin elements */</span>
            $box.add($outer).hide().fadeIn(options.fadeSpeed||<span class="hljs-number">0</span>);

        shown = <span class="hljs-literal">true</span>;

        $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'mouseup touchend'</span>, cancelSelection)
            .on(<span class="hljs-string">'mousemove touchmove'</span>, selectingMouseMove)
            .one(<span class="hljs-string">'mouseup touchend'</span>, docMouseUp);
        $box.off(<span class="hljs-string">'mousemove touchmove'</span>, areaMouseMove);

        options.onSelectStart(img, getSelection());
    }

    <span class="hljs-comment">/**
     * Cancel selection
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancelSelection</span>(<span class="hljs-params"></span>) </span>{
        $(<span class="hljs-built_in">document</span>).off(<span class="hljs-string">'mousemove touchmove'</span>, startSelection)
            .off(<span class="hljs-string">'mouseup touchend'</span>, cancelSelection);
        hide($box.add($outer));

        setSelection(selX(x1), selY(y1), selX(x1), selY(y1));

        <span class="hljs-comment">/* If this is an API call, callback functions should not be triggered */</span>
        <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> $.imgAreaSelect)) {
            options.onSelectChange(img, getSelection());
            options.onSelectEnd(img, getSelection());
        }
    }

    <span class="hljs-comment">/**
     * Image mousedown event handler
     *
     * @param event
     *            The event object
     * @return false
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imgMouseDown</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-comment">/* Ignore the event if animation is in progress */</span>
        <span class="hljs-keyword">if</span> (event.which != <span class="hljs-number">1</span> || $outer.is(<span class="hljs-string">':animated'</span>)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        adjust();
        startX = x1 = evX(event);
        startY = y1 = evY(event);

        <span class="hljs-comment">/* Selection will start when the mouse is moved */</span>
        $(<span class="hljs-built_in">document</span>).on({ <span class="hljs-string">'mousemove touchmove'</span>: startSelection,
            <span class="hljs-string">'mouseup touchend'</span>: cancelSelection });

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">/**
     * Window resize event handler
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">windowResize</span>(<span class="hljs-params"></span>) </span>{
        doUpdate(<span class="hljs-literal">false</span>);
    }

    <span class="hljs-comment">/**
     * Image load event handler. This is the final part of the initialization
     * process.
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">imgLoad</span>(<span class="hljs-params"></span>) </span>{
        imgLoaded = <span class="hljs-literal">true</span>;

        <span class="hljs-comment">/* Set options */</span>
        setOptions(options = $.extend({
            <span class="hljs-attr">classPrefix</span>: <span class="hljs-string">'imgareaselect'</span>,
            <span class="hljs-attr">movable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">parent</span>: <span class="hljs-string">'body'</span>,
            <span class="hljs-attr">resizable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">resizeMargin</span>: <span class="hljs-number">10</span>,
            <span class="hljs-attr">onInit</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{},
            <span class="hljs-attr">onSelectStart</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{},
            <span class="hljs-attr">onSelectChange</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{},
            <span class="hljs-attr">onSelectEnd</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{}
        }, options));

        $box.add($outer).css({ <span class="hljs-attr">visibility</span>: <span class="hljs-string">''</span> });

        <span class="hljs-keyword">if</span> (options.show) {
            shown = <span class="hljs-literal">true</span>;
            adjust();
            update();
            $box.add($outer).hide().fadeIn(options.fadeSpeed||<span class="hljs-number">0</span>);
        }

        <span class="hljs-comment">/*
         * Call the onInit callback. The setTimeout() call is used to ensure
         * that the plugin has been fully initialized and the object instance is
         * available (so that it can be obtained in the callback).
         */</span>
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ options.onInit(img, getSelection()); }, <span class="hljs-number">0</span>);
    }

    <span class="hljs-comment">/**
     * Document keypress event handler
     *
     * @param event
     *            The event object
     * @return false
     */</span>
    <span class="hljs-keyword">var</span> docKeyPress = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">var</span> k = options.keys, d, t, key = event.keyCode;

        d = !<span class="hljs-built_in">isNaN</span>(k.alt) &amp;&amp; (event.altKey || event.originalEvent.altKey) ? k.alt :
            !<span class="hljs-built_in">isNaN</span>(k.ctrl) &amp;&amp; event.ctrlKey ? k.ctrl :
            !<span class="hljs-built_in">isNaN</span>(k.shift) &amp;&amp; event.shiftKey ? k.shift :
            !<span class="hljs-built_in">isNaN</span>(k.arrows) ? k.arrows : <span class="hljs-number">10</span>;

        <span class="hljs-keyword">if</span> (k.arrows == <span class="hljs-string">'resize'</span> || (k.shift == <span class="hljs-string">'resize'</span> &amp;&amp; event.shiftKey) ||
            (k.ctrl == <span class="hljs-string">'resize'</span> &amp;&amp; event.ctrlKey) ||
            (k.alt == <span class="hljs-string">'resize'</span> &amp;&amp; (event.altKey || event.originalEvent.altKey)))
        {
            <span class="hljs-comment">/* Resize selection */</span>

            <span class="hljs-keyword">switch</span> (key) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>:
                <span class="hljs-comment">/* Left */</span>
                d = -d;
            <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>:
                <span class="hljs-comment">/* Right */</span>
                t = max(x1, x2);
                x1 = min(x1, x2);
                x2 = max(t + d, x1);
                fixAspectRatio();
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>:
                <span class="hljs-comment">/* Up */</span>
                d = -d;
            <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>:
                <span class="hljs-comment">/* Down */</span>
                t = max(y1, y2);
                y1 = min(y1, y2);
                y2 = max(t + d, y1);
                fixAspectRatio(<span class="hljs-literal">true</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span>;
            }

            doResize();
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">/* Move selection */</span>

            x1 = min(x1, x2);
            y1 = min(y1, y2);

            <span class="hljs-keyword">switch</span> (key) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>:
                <span class="hljs-comment">/* Left */</span>
                doMove(max(x1 - d, left), y1);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>:
                <span class="hljs-comment">/* Up */</span>
                doMove(x1, max(y1 - d, top));
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>:
                <span class="hljs-comment">/* Right */</span>
                doMove(x1 + min(d, imgWidth - selX(x2)), y1);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>:
                <span class="hljs-comment">/* Down */</span>
                doMove(x1, y1 + min(d, imgHeight - selY(y2)));
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">return</span>;
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };

    <span class="hljs-comment">/**
     * Apply style options to plugin element (or multiple elements)
     *
     * @param $elem
     *            A jQuery object representing the element(s) to style
     * @param props
     *            An object that maps option names to corresponding CSS
     *            properties
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">styleOptions</span>(<span class="hljs-params">$elem, props</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> option <span class="hljs-keyword">in</span> props)
            <span class="hljs-keyword">if</span> (options[option] !== <span class="hljs-literal">undefined</span>)
                $elem.css(props[option], options[option]);
    }

    <span class="hljs-comment">/**
     * Set plugin options
     *
     * @param newOptions
     *            The new options object
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setOptions</span>(<span class="hljs-params">newOptions</span>) </span>{
        <span class="hljs-keyword">if</span> (newOptions.parent)
            ($parent = $(newOptions.parent)).append($box.add($outer));

        <span class="hljs-comment">/* Merge the new options with the existing ones */</span>
        $.extend(options, newOptions);

        adjust();

        <span class="hljs-keyword">if</span> (newOptions.handles != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">/* Recreate selection area handles */</span>
            $handles.remove();
            $handles = $([]);

            i = newOptions.handles ? newOptions.handles == <span class="hljs-string">'corners'</span> ? <span class="hljs-number">4</span> : <span class="hljs-number">8</span> : <span class="hljs-number">0</span>;

            <span class="hljs-keyword">while</span> (i--)
                $handles = $handles.add(div());

            <span class="hljs-comment">/* Add a class to handles and set the CSS properties */</span>
            $handles.addClass(options.classPrefix + <span class="hljs-string">'-handle'</span>).css({
                <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
                <span class="hljs-comment">/*
                 * The font-size property needs to be set to zero, otherwise
                 * Internet Explorer makes the handles too large
                 */</span>
                fontSize: <span class="hljs-number">0</span>,
                <span class="hljs-attr">zIndex</span>: zIndex + <span class="hljs-number">1</span> || <span class="hljs-number">1</span>
            });

            <span class="hljs-comment">/*
             * If handle width/height has not been set with CSS rules, set the
             * default 5px
             */</span>
            <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">parseInt</span>($handles.css(<span class="hljs-string">'width'</span>)) &gt;= <span class="hljs-number">0</span>)
                $handles.width(<span class="hljs-number">5</span>).height(<span class="hljs-number">5</span>);

            <span class="hljs-comment">/*
             * If the borderWidth option is in use, add a solid border to
             * handles
             */</span>
            <span class="hljs-keyword">if</span> (o = options.borderWidth)
                $handles.css({ <span class="hljs-attr">borderWidth</span>: o, <span class="hljs-attr">borderStyle</span>: <span class="hljs-string">'solid'</span> });

            <span class="hljs-comment">/* Apply other style options */</span>
            styleOptions($handles, { <span class="hljs-attr">borderColor1</span>: <span class="hljs-string">'border-color'</span>,
                <span class="hljs-attr">borderColor2</span>: <span class="hljs-string">'background-color'</span>,
                <span class="hljs-attr">borderOpacity</span>: <span class="hljs-string">'opacity'</span> });
        }

        <span class="hljs-comment">/* Calculate scale factors */</span>
        scaleX = options.imageWidth / imgWidth || <span class="hljs-number">1</span>;
        scaleY = options.imageHeight / imgHeight || <span class="hljs-number">1</span>;

        <span class="hljs-comment">/* Set selection */</span>
        <span class="hljs-keyword">if</span> (newOptions.x1 != <span class="hljs-literal">null</span>) {
            setSelection(newOptions.x1, newOptions.y1, newOptions.x2,
                newOptions.y2);
            newOptions.show = !newOptions.hide;
        }

        <span class="hljs-keyword">if</span> (newOptions.keys)
            <span class="hljs-comment">/* Enable keyboard support */</span>
            options.keys = $.extend({ <span class="hljs-attr">shift</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">ctrl</span>: <span class="hljs-string">'resize'</span> },
                newOptions.keys);

        <span class="hljs-comment">/* Add classes to plugin elements */</span>
        $outer.addClass(options.classPrefix + <span class="hljs-string">'-outer'</span>);
        $area.addClass(options.classPrefix + <span class="hljs-string">'-selection'</span>);
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i++ &lt; 4;)
            $($border[i-1]).addClass(options.classPrefix + '-border' + i);

        /* Apply style options */
        styleOptions($area, { selectionColor: 'background-color',
            selectionOpacity: 'opacity' });
        styleOptions($border, { borderOpacity: 'opacity',
            borderWidth: 'border-width' });
        styleOptions($outer, { outerColor: 'background-color',
            outerOpacity: 'opacity' });
        if (o = options.borderColor1)
            $($border[0]).css({ borderStyle: 'solid', borderColor: o });
        if (o = options.borderColor2)
            $($border[1]).css({ borderStyle: 'dashed', borderColor: o });

        /* Append all the selection area elements to the container box */
        $box.append($area.add($border).add($areaOpera)).append($handles);

        if (msie) {
            if (o = ($outer.css('filter')||'').match(/opacity=(\d+)/))
                $outer.css('opacity', o[1]/100);
            if (o = ($border.css('filter')||'').match(/opacity=(\d+)/))
                $border.css('opacity', o[1]/100);
        }

        if (newOptions.hide)
            hide($box.add($outer));
        else if (newOptions.show &amp;&amp; imgLoaded) {
            shown = true;
            $box.add($outer).fadeIn(options.fadeSpeed||0);
            doUpdate();
        }

        /* Calculate the aspect ratio factor */
        aspectRatio = (d = (options.aspectRatio || '').split(/:/))[0] / d[1];

        $img.add($outer).unbind('mousedown', imgMouseDown);

        if (options.disable || options.enable === false) {
            /* Disable the plugin */
            $box.off({ 'mousemove touchmove': areaMouseMove,
                'mousedown touchstart': areaMouseDown });
            $(window).off('resize', windowResize);
        }
        else {
            if (options.enable || options.disable === false) {
                /* Enable the plugin */
                if (options.resizable || options.movable)
                    $box.on({ 'mousemove touchmove': areaMouseMove,
                        'mousedown touchstart': areaMouseDown });

                $(window).resize(windowResize);
            }

            if (!options.persistent)
                $img.add($outer).on('mousedown touchstart', imgMouseDown);
        }

        options.enable = options.disable = undefined;
    }

    /**
     * Remove plugin completely
     */
    this.remove = function () {
        /*
         * Call setOptions with { disable: true } to unbind the event handlers
         */
        setOptions({ disable: true });
        $box.add($outer).remove();
    };

    /*
     * Public API
     */

    /**
     * Get current options
     *
     * @return An object containing the set of options currently in use
     */
    this.getOptions = function () { return options; };

    /**
     * Set plugin options
     *
     * @param newOptions
     *            The new options object
     */
    this.setOptions = setOptions;

    /**
     * Get the current selection
     *
     * @param noScale
     *            If set to &lt;code&gt;true&lt;/code&gt;, scaling is not applied to the
     *            returned selection
     * @return Selection object
     */
    this.getSelection = getSelection;

    /**
     * Set the current selection
     *
     * @param x1
     *            X coordinate of the upper left corner of the selection area
     * @param y1
     *            Y coordinate of the upper left corner of the selection area
     * @param x2
     *            X coordinate of the lower right corner of the selection area
     * @param y2
     *            Y coordinate of the lower right corner of the selection area
     * @param noScale
     *            If set to &lt;code&gt;true&lt;/code&gt;, scaling is not applied to the
     *            new selection
     */
    this.setSelection = setSelection;

    /**
     * Cancel selection
     */
    this.cancelSelection = cancelSelection;

    /**
     * Update plugin elements
     *
     * @param resetKeyPress
     *            If set to &lt;code&gt;false&lt;/code&gt;, this instance's keypress
     *            event handler is not activated
     */
    this.update = doUpdate;

    /* Do the dreaded browser detection */
    var msie = (/msie ([\w.]+)/i.exec(ua)||[])[1],
        opera = /opera/i.test(ua),
        safari = /webkit/i.test(ua) &amp;&amp; !/chrome/i.test(ua);

    /*
     * Traverse the image's parent elements (up to &lt;body&gt;) and find the
     * highest z-index
     */
    $p = $img;

    while ($p.length) {
        zIndex = max(zIndex,
            !isNaN($p.css('z-index')) ? $p.css('z-index') : zIndex);
        /* Also check if any of the ancestor elements has fixed position */
        if ($p.css('position') == 'fixed')
            position = 'fixed';

        $p = $p.parent(':not(body)');
    }

    /*
     * If z-index is given as an option, it overrides the one found by the
     * above loop
     */
    zIndex = options.zIndex || zIndex;

    if (msie)
        $img.attr('unselectable', 'on');

    /*
     * In MSIE and WebKit, we need to use the keydown event instead of keypress
     */
    $.imgAreaSelect.keyPress = msie || safari ? 'keydown' : 'keypress';

    /*
     * There is a bug affecting the CSS cursor property in Opera (observed in
     * versions up to 10.00) that prevents the cursor from being updated unless
     * the mouse leaves and enters the element again. To trigger the mouseover
     * event, we're adding an additional div to $box and we're going to toggle
     * it when mouse moves inside the selection area.
     */
    if (opera)
        $areaOpera = div().css({ width: '100%', height: '100%',
            position: 'absolute', zIndex: zIndex + 2 || 2 });

    /*
     * We initially set visibility to "hidden" as a workaround for a weird
     * behaviour observed in Google Chrome 1.0.154.53 (on Windows XP). Normally
     * we would just set display to "none", but, for some reason, if we do so
     * then Chrome refuses to later display the element with .show() or
     * .fadeIn().
     */
    $box.add($outer).css({ visibility: 'hidden', position: position,
        overflow: 'hidden', zIndex: zIndex || '0' });
    $box.css({ zIndex: zIndex + 2 || 2 });
    $area.add($border).css({ position: 'absolute', fontSize: 0 });

    /*
     * If the image has been fully loaded, or if it is not really an image (eg.
     * a div), call imgLoad() immediately; otherwise, bind it to be called once
     * on image load event.
     */
    img.complete || img.readyState == 'complete' || !$img.is('img') ?
        imgLoad() : $img.one('load', imgLoad);

    /*
     * MSIE 9.0 doesn't always fire the image load event -- resetting the src
     * attribute seems to trigger it. The check is for version 7 and above to
     * accommodate for MSIE 9 running in compatibility mode.
     */
    if (!imgLoaded &amp;&amp; msie &amp;&amp; msie &gt;= 7)
        img.src = img.src;
};

/**
 * Invoke imgAreaSelect on a jQuery object containing the image(s)
 *
 * @param options
 *            Options object
 * @return The jQuery object or a reference to imgAreaSelect instance (if the
 *         &lt;code&gt;instance&lt;/code&gt; option was specified)
 */
$.fn.imgAreaSelect = function (options) {
    options = options || {};

    this.each(function () {
        /* Is there already an imgAreaSelect instance bound to this element? */
        if ($(this).data('imgAreaSelect')) {
            /* Yes there is -- is it supposed to be removed? */
            if (options.remove) {
                /* Remove the plugin */
                $(this).data('imgAreaSelect').remove();
                $(this).removeData('imgAreaSelect');
            }
            else
                /* Reset options */
                $(this).data('imgAreaSelect').setOptions(options);
        }
        else if (!options.remove) {
            /* No exising instance -- create a new one */

            /*
             * If neither the "enable" nor the "disable" option is present, add
             * "enable" as the default
             */
            if (options.enable === undefined &amp;&amp; options.disable === undefined)
                options.enable = true;

            $(this).data('imgAreaSelect', new $.imgAreaSelect(this, options));
        }
    });

    if (options.instance)
        /*
         * Return the imgAreaSelect instance bound to the first element in the
         * set
         */
        return $(this).data('imgAreaSelect');

    return this;
};

})(jQuery);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
