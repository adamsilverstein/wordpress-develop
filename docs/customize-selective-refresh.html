<!DOCTYPE html>

<html>
<head>
  <title>customize-selective-refresh.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="bookmarklet.html">
                  bookmarklet.js
                </a>
              
                
                <a class="source" href="bookmarklet.min.html">
                  bookmarklet.min.js
                </a>
              
                
                <a class="source" href="color-picker.html">
                  color-picker.js
                </a>
              
                
                <a class="source" href="comment.html">
                  comment.js
                </a>
              
                
                <a class="source" href="common.html">
                  common.js
                </a>
              
                
                <a class="source" href="custom-background.html">
                  custom-background.js
                </a>
              
                
                <a class="source" href="custom-header.html">
                  custom-header.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-nav-menus.html">
                  customize-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-widgets.html">
                  customize-widgets.js
                </a>
              
                
                <a class="source" href="dashboard.html">
                  dashboard.js
                </a>
              
                
                <a class="source" href="edit-comments.html">
                  edit-comments.js
                </a>
              
                
                <a class="source" href="editor-expand.html">
                  editor-expand.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="farbtastic.html">
                  farbtastic.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="image-edit.html">
                  image-edit.js
                </a>
              
                
                <a class="source" href="inline-edit-post.html">
                  inline-edit-post.js
                </a>
              
                
                <a class="source" href="inline-edit-tax.html">
                  inline-edit-tax.js
                </a>
              
                
                <a class="source" href="iris.min.html">
                  iris.min.js
                </a>
              
                
                <a class="source" href="language-chooser.html">
                  language-chooser.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="media-gallery.html">
                  media-gallery.js
                </a>
              
                
                <a class="source" href="media-upload.html">
                  media-upload.js
                </a>
              
                
                <a class="source" href="media.html">
                  media.js
                </a>
              
                
                <a class="source" href="nav-menu.html">
                  nav-menu.js
                </a>
              
                
                <a class="source" href="password-strength-meter.html">
                  password-strength-meter.js
                </a>
              
                
                <a class="source" href="plugin-install.html">
                  plugin-install.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="postbox.html">
                  postbox.js
                </a>
              
                
                <a class="source" href="press-this.html">
                  press-this.js
                </a>
              
                
                <a class="source" href="revisions.html">
                  revisions.js
                </a>
              
                
                <a class="source" href="set-post-thumbnail.html">
                  set-post-thumbnail.js
                </a>
              
                
                <a class="source" href="svg-painter.html">
                  svg-painter.js
                </a>
              
                
                <a class="source" href="tags-box.html">
                  tags-box.js
                </a>
              
                
                <a class="source" href="tags-suggest.html">
                  tags-suggest.js
                </a>
              
                
                <a class="source" href="tags.html">
                  tags.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="updates.html">
                  updates.js
                </a>
              
                
                <a class="source" href="user-profile.html">
                  user-profile.js
                </a>
              
                
                <a class="source" href="user-suggest.html">
                  user-suggest.js
                </a>
              
                
                <a class="source" href="widgets.html">
                  widgets.js
                </a>
              
                
                <a class="source" href="media-audio-widget.html">
                  media-audio-widget.js
                </a>
              
                
                <a class="source" href="media-image-widget.html">
                  media-image-widget.js
                </a>
              
                
                <a class="source" href="media-video-widget.html">
                  media-video-widget.js
                </a>
              
                
                <a class="source" href="media-widgets.html">
                  media-widgets.js
                </a>
              
                
                <a class="source" href="text-widgets.html">
                  text-widgets.js
                </a>
              
                
                <a class="source" href="word-count.html">
                  word-count.js
                </a>
              
                
                <a class="source" href="wp-fullscreen-stub.html">
                  wp-fullscreen-stub.js
                </a>
              
                
                <a class="source" href="xfn.html">
                  xfn.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="theme-options.html">
                  theme-options.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="showcase.html">
                  showcase.js
                </a>
              
                
                <a class="source" href="color-scheme-control.html">
                  color-scheme-control.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="customizer.html">
                  customizer.js
                </a>
              
                
                <a class="source" href="featured-content-admin.html">
                  featured-content-admin.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="keyboard-image-navigation.html">
                  keyboard-image-navigation.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="customize-controls.html">
                  customize-controls.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="global.html">
                  global.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="jquery.scrollTo.html">
                  jquery.scrollTo.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="skip-link-focus-fix.html">
                  skip-link-focus-fix.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="html5.html">
                  html5.js
                </a>
              
                
                <a class="source" href="navigation.html">
                  navigation.js
                </a>
              
                
                <a class="source" href="theme-customizer.html">
                  theme-customizer.js
                </a>
              
                
                <a class="source" href="admin-bar.html">
                  admin-bar.js
                </a>
              
                
                <a class="source" href="autosave.html">
                  autosave.js
                </a>
              
                
                <a class="source" href="backbone.html">
                  backbone.js
                </a>
              
                
                <a class="source" href="backbone.min.html">
                  backbone.min.js
                </a>
              
                
                <a class="source" href="colorpicker.html">
                  colorpicker.js
                </a>
              
                
                <a class="source" href="comment-reply.html">
                  comment-reply.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-base.html">
                  customize-base.js
                </a>
              
                
                <a class="source" href="customize-loader.html">
                  customize-loader.js
                </a>
              
                
                <a class="source" href="customize-models.html">
                  customize-models.js
                </a>
              
                
                <a class="source" href="customize-preview-nav-menus.html">
                  customize-preview-nav-menus.js
                </a>
              
                
                <a class="source" href="customize-preview-widgets.html">
                  customize-preview-widgets.js
                </a>
              
                
                <a class="source" href="customize-preview.html">
                  customize-preview.js
                </a>
              
                
                <a class="source" href="customize-selective-refresh.html">
                  customize-selective-refresh.js
                </a>
              
                
                <a class="source" href="customize-views.html">
                  customize-views.js
                </a>
              
                
                <a class="source" href="heartbeat.html">
                  heartbeat.js
                </a>
              
                
                <a class="source" href="hoverIntent.html">
                  hoverIntent.js
                </a>
              
                
                <a class="source" href="imagesloaded.min.html">
                  imagesloaded.min.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.html">
                  jquery.imgareaselect.js
                </a>
              
                
                <a class="source" href="jquery.imgareaselect.min.html">
                  jquery.imgareaselect.min.js
                </a>
              
                
                <a class="source" href="jquery.Jcrop.min.html">
                  jquery.Jcrop.min.js
                </a>
              
                
                <a class="source" href="jquery-migrate.html">
                  jquery-migrate.js
                </a>
              
                
                <a class="source" href="jquery-migrate.min.html">
                  jquery-migrate.min.js
                </a>
              
                
                <a class="source" href="jquery.color.min.html">
                  jquery.color.min.js
                </a>
              
                
                <a class="source" href="jquery.form.html">
                  jquery.form.js
                </a>
              
                
                <a class="source" href="jquery.form.min.html">
                  jquery.form.min.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.html">
                  jquery.hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.hotkeys.min.html">
                  jquery.hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.html">
                  jquery.js
                </a>
              
                
                <a class="source" href="jquery.masonry.html">
                  jquery.masonry.js
                </a>
              
                
                <a class="source" href="jquery.masonry.min.html">
                  jquery.masonry.min.js
                </a>
              
                
                <a class="source" href="jquery.query.html">
                  jquery.query.js
                </a>
              
                
                <a class="source" href="jquery.schedule.html">
                  jquery.schedule.js
                </a>
              
                
                <a class="source" href="jquery.serialize-object.html">
                  jquery.serialize-object.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.html">
                  jquery.table-hotkeys.js
                </a>
              
                
                <a class="source" href="jquery.table-hotkeys.min.html">
                  jquery.table-hotkeys.min.js
                </a>
              
                
                <a class="source" href="jquery.ui.touch-punch.html">
                  jquery.ui.touch-punch.js
                </a>
              
                
                <a class="source" href="suggest.html">
                  suggest.js
                </a>
              
                
                <a class="source" href="suggest.min.html">
                  suggest.min.js
                </a>
              
                
                <a class="source" href="accordion.html">
                  accordion.js
                </a>
              
                
                <a class="source" href="autocomplete.html">
                  autocomplete.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="core.html">
                  core.js
                </a>
              
                
                <a class="source" href="datepicker.html">
                  datepicker.js
                </a>
              
                
                <a class="source" href="dialog.html">
                  dialog.js
                </a>
              
                
                <a class="source" href="draggable.html">
                  draggable.js
                </a>
              
                
                <a class="source" href="droppable.html">
                  droppable.js
                </a>
              
                
                <a class="source" href="effect-blind.html">
                  effect-blind.js
                </a>
              
                
                <a class="source" href="effect-bounce.html">
                  effect-bounce.js
                </a>
              
                
                <a class="source" href="effect-clip.html">
                  effect-clip.js
                </a>
              
                
                <a class="source" href="effect-drop.html">
                  effect-drop.js
                </a>
              
                
                <a class="source" href="effect-explode.html">
                  effect-explode.js
                </a>
              
                
                <a class="source" href="effect-fade.html">
                  effect-fade.js
                </a>
              
                
                <a class="source" href="effect-fold.html">
                  effect-fold.js
                </a>
              
                
                <a class="source" href="effect-highlight.html">
                  effect-highlight.js
                </a>
              
                
                <a class="source" href="effect-puff.html">
                  effect-puff.js
                </a>
              
                
                <a class="source" href="effect-pulsate.html">
                  effect-pulsate.js
                </a>
              
                
                <a class="source" href="effect-scale.html">
                  effect-scale.js
                </a>
              
                
                <a class="source" href="effect-shake.html">
                  effect-shake.js
                </a>
              
                
                <a class="source" href="effect-size.html">
                  effect-size.js
                </a>
              
                
                <a class="source" href="effect-slide.html">
                  effect-slide.js
                </a>
              
                
                <a class="source" href="effect-transfer.html">
                  effect-transfer.js
                </a>
              
                
                <a class="source" href="effect.html">
                  effect.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="mouse.html">
                  mouse.js
                </a>
              
                
                <a class="source" href="position.html">
                  position.js
                </a>
              
                
                <a class="source" href="progressbar.html">
                  progressbar.js
                </a>
              
                
                <a class="source" href="resizable.html">
                  resizable.js
                </a>
              
                
                <a class="source" href="selectable.html">
                  selectable.js
                </a>
              
                
                <a class="source" href="selectmenu.html">
                  selectmenu.js
                </a>
              
                
                <a class="source" href="slider.html">
                  slider.js
                </a>
              
                
                <a class="source" href="sortable.html">
                  sortable.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="tabs.html">
                  tabs.js
                </a>
              
                
                <a class="source" href="tooltip.html">
                  tooltip.js
                </a>
              
                
                <a class="source" href="widget.html">
                  widget.js
                </a>
              
                
                <a class="source" href="json2.html">
                  json2.js
                </a>
              
                
                <a class="source" href="masonry.min.html">
                  masonry.min.js
                </a>
              
                
                <a class="source" href="mce-view.html">
                  mce-view.js
                </a>
              
                
                <a class="source" href="media-audiovideo.html">
                  media-audiovideo.js
                </a>
              
                
                <a class="source" href="media-editor.html">
                  media-editor.js
                </a>
              
                
                <a class="source" href="media-grid.html">
                  media-grid.js
                </a>
              
                
                <a class="source" href="media-models.html">
                  media-models.js
                </a>
              
                
                <a class="source" href="media-views.html">
                  media-views.js
                </a>
              
                
                <a class="source" href="audiovideo.manifest.html">
                  audiovideo.manifest.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="collection-add.html">
                  collection-add.js
                </a>
              
                
                <a class="source" href="collection-edit.html">
                  collection-edit.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="customize-image-cropper.html">
                  customize-image-cropper.js
                </a>
              
                
                <a class="source" href="edit-attachment-metadata.html">
                  edit-attachment-metadata.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="featured-image.html">
                  featured-image.js
                </a>
              
                
                <a class="source" href="gallery-add.html">
                  gallery-add.js
                </a>
              
                
                <a class="source" href="gallery-edit.html">
                  gallery-edit.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="media-library.html">
                  media-library.js
                </a>
              
                
                <a class="source" href="region.html">
                  region.js
                </a>
              
                
                <a class="source" href="replace-image.html">
                  replace-image.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="state-machine.html">
                  state-machine.js
                </a>
              
                
                <a class="source" href="state.html">
                  state.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="grid.manifest.html">
                  grid.manifest.js
                </a>
              
                
                <a class="source" href="models.manifest.html">
                  models.manifest.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="post-image.html">
                  post-image.js
                </a>
              
                
                <a class="source" href="post-media.html">
                  post-media.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="selection-sync.html">
                  selection-sync.js
                </a>
              
                
                <a class="source" href="views.manifest.html">
                  views.manifest.js
                </a>
              
                
                <a class="source" href="attachment-compat.html">
                  attachment-compat.js
                </a>
              
                
                <a class="source" href="attachment-filters.html">
                  attachment-filters.js
                </a>
              
                
                <a class="source" href="all.html">
                  all.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="uploaded.html">
                  uploaded.js
                </a>
              
                
                <a class="source" href="attachment.html">
                  attachment.js
                </a>
              
                
                <a class="source" href="details-two-column.html">
                  details-two-column.js
                </a>
              
                
                <a class="source" href="details.html">
                  details.js
                </a>
              
                
                <a class="source" href="edit-library.html">
                  edit-library.js
                </a>
              
                
                <a class="source" href="edit-selection.html">
                  edit-selection.js
                </a>
              
                
                <a class="source" href="library.html">
                  library.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="attachments.html">
                  attachments.js
                </a>
              
                
                <a class="source" href="browser.html">
                  browser.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="button-group.html">
                  button-group.js
                </a>
              
                
                <a class="source" href="button.html">
                  button.js
                </a>
              
                
                <a class="source" href="delete-selected-permanently.html">
                  delete-selected-permanently.js
                </a>
              
                
                <a class="source" href="delete-selected.html">
                  delete-selected.js
                </a>
              
                
                <a class="source" href="select-mode-toggle.html">
                  select-mode-toggle.js
                </a>
              
                
                <a class="source" href="cropper.html">
                  cropper.js
                </a>
              
                
                <a class="source" href="edit-image-details.html">
                  edit-image-details.js
                </a>
              
                
                <a class="source" href="edit-image.html">
                  edit-image.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="image.html">
                  image.js
                </a>
              
                
                <a class="source" href="link.html">
                  link.js
                </a>
              
                
                <a class="source" href="url.html">
                  url.js
                </a>
              
                
                <a class="source" href="focus-manager.html">
                  focus-manager.js
                </a>
              
                
                <a class="source" href="frame.html">
                  frame.js
                </a>
              
                
                <a class="source" href="audio-details.html">
                  audio-details.js
                </a>
              
                
                <a class="source" href="edit-attachments.html">
                  edit-attachments.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="manage.html">
                  manage.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="post.html">
                  post.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="iframe.html">
                  iframe.js
                </a>
              
                
                <a class="source" href="image-details.html">
                  image-details.js
                </a>
              
                
                <a class="source" href="label.html">
                  label.js
                </a>
              
                
                <a class="source" href="media-details.html">
                  media-details.js
                </a>
              
                
                <a class="source" href="media-frame.html">
                  media-frame.js
                </a>
              
                
                <a class="source" href="menu-item.html">
                  menu-item.js
                </a>
              
                
                <a class="source" href="menu.html">
                  menu.js
                </a>
              
                
                <a class="source" href="modal.html">
                  modal.js
                </a>
              
                
                <a class="source" href="priority-list.html">
                  priority-list.js
                </a>
              
                
                <a class="source" href="router-item.html">
                  router-item.js
                </a>
              
                
                <a class="source" href="router.html">
                  router.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="selection.html">
                  selection.js
                </a>
              
                
                <a class="source" href="settings.html">
                  settings.js
                </a>
              
                
                <a class="source" href="attachment-display.html">
                  attachment-display.js
                </a>
              
                
                <a class="source" href="gallery.html">
                  gallery.js
                </a>
              
                
                <a class="source" href="playlist.html">
                  playlist.js
                </a>
              
                
                <a class="source" href="sidebar.html">
                  sidebar.js
                </a>
              
                
                <a class="source" href="site-icon-cropper.html">
                  site-icon-cropper.js
                </a>
              
                
                <a class="source" href="site-icon-preview.html">
                  site-icon-preview.js
                </a>
              
                
                <a class="source" href="spinner.html">
                  spinner.js
                </a>
              
                
                <a class="source" href="toolbar.html">
                  toolbar.js
                </a>
              
                
                <a class="source" href="embed.html">
                  embed.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="editor.html">
                  editor.js
                </a>
              
                
                <a class="source" href="inline.html">
                  inline.js
                </a>
              
                
                <a class="source" href="status-error.html">
                  status-error.js
                </a>
              
                
                <a class="source" href="status.html">
                  status.js
                </a>
              
                
                <a class="source" href="window.html">
                  window.js
                </a>
              
                
                <a class="source" href="video-details.html">
                  video-details.js
                </a>
              
                
                <a class="source" href="view.html">
                  view.js
                </a>
              
                
                <a class="source" href="froogaloop.min.html">
                  froogaloop.min.js
                </a>
              
                
                <a class="source" href="mediaelement-and-player.min.html">
                  mediaelement-and-player.min.js
                </a>
              
                
                <a class="source" href="wp-mediaelement.html">
                  wp-mediaelement.js
                </a>
              
                
                <a class="source" href="wp-playlist.html">
                  wp-playlist.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="plupload.full.min.html">
                  plupload.full.min.js
                </a>
              
                
                <a class="source" href="wp-plupload.html">
                  wp-plupload.js
                </a>
              
                
                <a class="source" href="quicktags.html">
                  quicktags.js
                </a>
              
                
                <a class="source" href="shortcode.html">
                  shortcode.js
                </a>
              
                
                <a class="source" href="swfobject.html">
                  swfobject.js
                </a>
              
                
                <a class="source" href="handlers.html">
                  handlers.js
                </a>
              
                
                <a class="source" href="handlers.min.html">
                  handlers.min.js
                </a>
              
                
                <a class="source" href="swfupload.cookies.html">
                  swfupload.cookies.js
                </a>
              
                
                <a class="source" href="swfupload.queue.html">
                  swfupload.queue.js
                </a>
              
                
                <a class="source" href="swfupload.speed.html">
                  swfupload.speed.js
                </a>
              
                
                <a class="source" href="swfupload.swfobject.html">
                  swfupload.swfobject.js
                </a>
              
                
                <a class="source" href="swfupload.html">
                  swfupload.js
                </a>
              
                
                <a class="source" href="thickbox.html">
                  thickbox.js
                </a>
              
                
                <a class="source" href="wp-langs-en.html">
                  wp-langs-en.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.min.html">
                  plugin.min.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="plugin.html">
                  plugin.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="theme.html">
                  theme.js
                </a>
              
                
                <a class="source" href="theme.min.html">
                  theme.min.js
                </a>
              
                
                <a class="source" href="tiny_mce_popup.html">
                  tiny_mce_popup.js
                </a>
              
                
                <a class="source" href="tinymce.html">
                  tinymce.js
                </a>
              
                
                <a class="source" href="tinymce.min.html">
                  tinymce.min.js
                </a>
              
                
                <a class="source" href="editable_selects.html">
                  editable_selects.js
                </a>
              
                
                <a class="source" href="form_utils.html">
                  form_utils.js
                </a>
              
                
                <a class="source" href="mctabs.html">
                  mctabs.js
                </a>
              
                
                <a class="source" href="validate.html">
                  validate.js
                </a>
              
                
                <a class="source" href="tw-sack.html">
                  tw-sack.js
                </a>
              
                
                <a class="source" href="twemoji.html">
                  twemoji.js
                </a>
              
                
                <a class="source" href="underscore.html">
                  underscore.js
                </a>
              
                
                <a class="source" href="underscore.min.html">
                  underscore.min.js
                </a>
              
                
                <a class="source" href="utils.html">
                  utils.js
                </a>
              
                
                <a class="source" href="wp-a11y.html">
                  wp-a11y.js
                </a>
              
                
                <a class="source" href="wp-ajax-response.html">
                  wp-ajax-response.js
                </a>
              
                
                <a class="source" href="wp-api.html">
                  wp-api.js
                </a>
              
                
                <a class="source" href="wp-auth-check.html">
                  wp-auth-check.js
                </a>
              
                
                <a class="source" href="wp-backbone.html">
                  wp-backbone.js
                </a>
              
                
                <a class="source" href="wp-custom-header.html">
                  wp-custom-header.js
                </a>
              
                
                <a class="source" href="wp-embed-template.html">
                  wp-embed-template.js
                </a>
              
                
                <a class="source" href="wp-embed.html">
                  wp-embed.js
                </a>
              
                
                <a class="source" href="wp-emoji-loader.html">
                  wp-emoji-loader.js
                </a>
              
                
                <a class="source" href="wp-emoji.html">
                  wp-emoji.js
                </a>
              
                
                <a class="source" href="wp-list-revisions.html">
                  wp-list-revisions.js
                </a>
              
                
                <a class="source" href="wp-lists.html">
                  wp-lists.js
                </a>
              
                
                <a class="source" href="wp-pointer.html">
                  wp-pointer.js
                </a>
              
                
                <a class="source" href="wp-util.html">
                  wp-util.js
                </a>
              
                
                <a class="source" href="wpdialog.html">
                  wpdialog.js
                </a>
              
                
                <a class="source" href="wplink.html">
                  wplink.js
                </a>
              
                
                <a class="source" href="zxcvbn-async.html">
                  zxcvbn-async.js
                </a>
              
                
                <a class="source" href="zxcvbn.min.html">
                  zxcvbn.min.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>customize-selective-refresh.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global jQuery, JSON, _customizePartialRefreshExports, console */</span>

wp.customize.selectiveRefresh = ( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> $, api </span>) </span>{
<span class="hljs-meta">	'use strict'</span>;
	<span class="hljs-keyword">var</span> self, Partial, Placement;

	self = {
		<span class="hljs-attr">ready</span>: $.Deferred(),
		<span class="hljs-attr">editShortcutVisibility</span>: <span class="hljs-keyword">new</span> api.Value(),
		<span class="hljs-attr">data</span>: {
			<span class="hljs-attr">partials</span>: {},
			<span class="hljs-attr">renderQueryVar</span>: <span class="hljs-string">''</span>,
			<span class="hljs-attr">l10n</span>: {
				<span class="hljs-attr">shiftClickToEdit</span>: <span class="hljs-string">''</span>
			}
		},
		<span class="hljs-attr">currentRequest</span>: <span class="hljs-literal">null</span>
	};

	_.extend( self, api.Events );

	<span class="hljs-comment">/**
	 * A Customizer Partial.
	 *
	 * A partial provides a rendering of one or more settings according to a template.
	 *
	 * @see PHP class WP_Customize_Partial.
	 *
	 * @class
	 * @augments wp.customize.Class
	 * @since 4.5.0
	 *
	 * @param {string} id                              Unique identifier for the control instance.
	 * @param {object} options                         Options hash for the control instance.
	 * @param {object} options.params
	 * @param {string} options.params.type             Type of partial (e.g. nav_menu, widget, etc)
	 * @param {string} options.params.selector         jQuery selector to find the container element in the page.
	 * @param {array}  options.params.settings         The IDs for the settings the partial relates to.
	 * @param {string} options.params.primarySetting   The ID for the primary setting the partial renders.
	 * @param {bool}   options.params.fallbackRefresh  Whether to refresh the entire preview in case of a partial refresh failure.
	 */</span>
	Partial = self.Partial = api.Class.extend({

		<span class="hljs-attr">id</span>: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * Constructor.
		 *
		 * @since 4.5.0
		 *
		 * @param {string} id - Partial ID.
		 * @param {Object} options
		 * @param {Object} options.params
		 */</span>
		initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> id, options </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			options = options || {};
			partial.id = id;

			partial.params = _.extend(
				{
					<span class="hljs-attr">selector</span>: <span class="hljs-literal">null</span>,
					<span class="hljs-attr">settings</span>: [],
					<span class="hljs-attr">primarySetting</span>: <span class="hljs-literal">null</span>,
					<span class="hljs-attr">containerInclusive</span>: <span class="hljs-literal">false</span>,
					<span class="hljs-attr">fallbackRefresh</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// Note this needs to be false in a front-end editing context.</span>
				},
				options.params || {}
			);

			partial.deferred = {};
			partial.deferred.ready = $.Deferred();

			partial.deferred.ready.done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				partial.ready();
			} );
		},

		<span class="hljs-comment">/**
		 * Set up the partial.
		 *
		 * @since 4.5.0
		 */</span>
		ready: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			_.each( partial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
				$( placement.container ).attr( <span class="hljs-string">'title'</span>, self.data.l10n.shiftClickToEdit );
				partial.createEditShortcutForPlacement( placement );
			} );
			$( <span class="hljs-built_in">document</span> ).on( <span class="hljs-string">'click'</span>, partial.params.selector, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> e </span>) </span>{
				<span class="hljs-keyword">if</span> ( ! e.shiftKey ) {
					<span class="hljs-keyword">return</span>;
				}
				e.preventDefault();
				_.each( partial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
					<span class="hljs-keyword">if</span> ( $( placement.container ).is( e.currentTarget ) ) {
						partial.showControl();
					}
				} );
			} );
		},

		<span class="hljs-comment">/**
		 * Create and show the edit shortcut for a given partial placement container.
		 *
		 * @since 4.7.0
		 * @access public
		 *
		 * @param {Placement} placement The placement container element.
		 * @returns {void}
		 */</span>
		createEditShortcutForPlacement: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, $shortcut, $placementContainer, illegalAncestorSelector, illegalContainerSelector;
			<span class="hljs-keyword">if</span> ( ! placement.container ) {
				<span class="hljs-keyword">return</span>;
			}
			$placementContainer = $( placement.container );
			illegalAncestorSelector = <span class="hljs-string">'head'</span>;
			illegalContainerSelector = <span class="hljs-string">'area, audio, base, bdi, bdo, br, button, canvas, col, colgroup, command, datalist, embed, head, hr, html, iframe, img, input, keygen, label, link, map, math, menu, meta, noscript, object, optgroup, option, param, progress, rp, rt, ruby, script, select, source, style, svg, table, tbody, textarea, tfoot, thead, title, tr, track, video, wbr'</span>;
			<span class="hljs-keyword">if</span> ( ! $placementContainer.length || $placementContainer.is( illegalContainerSelector ) || $placementContainer.closest( illegalAncestorSelector ).length ) {
				<span class="hljs-keyword">return</span>;
			}
			$shortcut = partial.createEditShortcut();
			$shortcut.on( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) </span>{
				event.preventDefault();
				event.stopPropagation();
				partial.showControl();
			} );
			partial.addEditShortcutToPlacement( placement, $shortcut );
		},

		<span class="hljs-comment">/**
		 * Add an edit shortcut to the placement container.
		 *
		 * @since 4.7.0
		 * @access public
		 *
		 * @param {Placement} placement The placement for the partial.
		 * @param {jQuery} $editShortcut The shortcut element as a jQuery object.
		 * @returns {void}
		 */</span>
		addEditShortcutToPlacement: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement, $editShortcut </span>) </span>{
			<span class="hljs-keyword">var</span> $placementContainer = $( placement.container );
			$placementContainer.prepend( $editShortcut );
			<span class="hljs-keyword">if</span> ( ! $placementContainer.is( <span class="hljs-string">':visible'</span> ) || <span class="hljs-string">'none'</span> === $placementContainer.css( <span class="hljs-string">'display'</span> ) ) {
				$editShortcut.addClass( <span class="hljs-string">'customize-partial-edit-shortcut-hidden'</span> );
			}
		},

		<span class="hljs-comment">/**
		 * Return the unique class name for the edit shortcut button for this partial.
		 *
		 * @since 4.7.0
		 * @access public
		 *
		 * @return {string} Partial ID converted into a class name for use in shortcut.
		 */</span>
		getEditShortcutClassName: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, cleanId;
			cleanId = partial.id.replace( <span class="hljs-regexp">/]/g</span>, <span class="hljs-string">''</span> ).replace( <span class="hljs-regexp">/\[/g</span>, <span class="hljs-string">'-'</span> );
			<span class="hljs-keyword">return</span> <span class="hljs-string">'customize-partial-edit-shortcut-'</span> + cleanId;
		},

		<span class="hljs-comment">/**
		 * Return the appropriate translated string for the edit shortcut button.
		 *
		 * @since 4.7.0
		 * @access public
		 *
		 * @return {string} Tooltip for edit shortcut.
		 */</span>
		getEditShortcutTitle: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, l10n = self.data.l10n;
			<span class="hljs-keyword">switch</span> ( partial.getType() ) {
				<span class="hljs-keyword">case</span> <span class="hljs-string">'widget'</span>:
					<span class="hljs-keyword">return</span> l10n.clickEditWidget;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'blogname'</span>:
					<span class="hljs-keyword">return</span> l10n.clickEditTitle;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'blogdescription'</span>:
					<span class="hljs-keyword">return</span> l10n.clickEditTitle;
				<span class="hljs-keyword">case</span> <span class="hljs-string">'nav_menu'</span>:
					<span class="hljs-keyword">return</span> l10n.clickEditMenu;
				<span class="hljs-keyword">default</span>:
					<span class="hljs-keyword">return</span> l10n.clickEditMisc;
			}
		},

		<span class="hljs-comment">/**
		 * Return the type of this partial
		 *
		 * Will use `params.type` if set, but otherwise will try to infer type from settingId.
		 *
		 * @since 4.7.0
		 * @access public
		 *
		 * @return {string} Type of partial derived from type param or the related setting ID.
		 */</span>
		getType: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, settingId;
			settingId = partial.params.primarySetting || _.first( partial.settings() ) || <span class="hljs-string">'unknown'</span>;
			<span class="hljs-keyword">if</span> ( partial.params.type ) {
				<span class="hljs-keyword">return</span> partial.params.type;
			}
			<span class="hljs-keyword">if</span> ( settingId.match( <span class="hljs-regexp">/^nav_menu_instance\[/</span> ) ) {
				<span class="hljs-keyword">return</span> <span class="hljs-string">'nav_menu'</span>;
			}
			<span class="hljs-keyword">if</span> ( settingId.match( <span class="hljs-regexp">/^widget_.+\[\d+]$/</span> ) ) {
				<span class="hljs-keyword">return</span> <span class="hljs-string">'widget'</span>;
			}
			<span class="hljs-keyword">return</span> settingId;
		},

		<span class="hljs-comment">/**
		 * Create an edit shortcut button for this partial.
		 *
		 * @since 4.7.0
		 * @access public
		 *
		 * @return {jQuery} The edit shortcut button element.
		 */</span>
		createEditShortcut: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, shortcutTitle, $buttonContainer, $button, $image;
			shortcutTitle = partial.getEditShortcutTitle();
			$buttonContainer = $( <span class="hljs-string">'&lt;span&gt;'</span>, {
				<span class="hljs-string">'class'</span>: <span class="hljs-string">'customize-partial-edit-shortcut '</span> + partial.getEditShortcutClassName()
			} );
			$button = $( <span class="hljs-string">'&lt;button&gt;'</span>, {
				<span class="hljs-string">'aria-label'</span>: shortcutTitle,
				<span class="hljs-string">'title'</span>: shortcutTitle,
				<span class="hljs-string">'class'</span>: <span class="hljs-string">'customize-partial-edit-shortcut-button'</span>
			} );
			$image = $( <span class="hljs-string">'&lt;svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"&gt;&lt;path d="M13.89 3.39l2.71 2.72c.46.46.42 1.24.03 1.64l-8.01 8.02-5.56 1.16 1.16-5.58s7.6-7.63 7.99-8.03c.39-.39 1.22-.39 1.68.07zm-2.73 2.79l-5.59 5.61 1.11 1.11 5.54-5.65zm-2.97 8.23l5.58-5.6-1.07-1.08-5.59 5.6z"/&gt;&lt;/svg&gt;'</span> );
			$button.append( $image );
			$buttonContainer.append( $button );
			<span class="hljs-keyword">return</span> $buttonContainer;
		},

		<span class="hljs-comment">/**
		 * Find all placements for this partial int he document.
		 *
		 * @since 4.5.0
		 *
		 * @return {Array.&lt;Placement&gt;}
		 */</span>
		placements: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, selector;

			selector = partial.params.selector || <span class="hljs-string">''</span>;
			<span class="hljs-keyword">if</span> ( selector ) {
				selector += <span class="hljs-string">', '</span>;
			}
			selector += <span class="hljs-string">'[data-customize-partial-id="'</span> + partial.id + <span class="hljs-string">'"]'</span>; <span class="hljs-comment">// @todo Consider injecting customize-partial-id-${id} classnames instead.</span>

			<span class="hljs-keyword">return</span> $( selector ).map( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> container = $( <span class="hljs-keyword">this</span> ), context;

				context = container.data( <span class="hljs-string">'customize-partial-placement-context'</span> );
				<span class="hljs-keyword">if</span> ( _.isString( context ) &amp;&amp; <span class="hljs-string">'{'</span> === context.substr( <span class="hljs-number">0</span>, <span class="hljs-number">1</span> ) ) {
					<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'context JSON parse error'</span> );
				}

				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Placement( {
					<span class="hljs-attr">partial</span>: partial,
					<span class="hljs-attr">container</span>: container,
					<span class="hljs-attr">context</span>: context
				} );
			} ).get();
		},

		<span class="hljs-comment">/**
		 * Get list of setting IDs related to this partial.
		 *
		 * @since 4.5.0
		 *
		 * @return {String[]}
		 */</span>
		settings: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">if</span> ( partial.params.settings &amp;&amp; <span class="hljs-number">0</span> !== partial.params.settings.length ) {
				<span class="hljs-keyword">return</span> partial.params.settings;
			} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( partial.params.primarySetting ) {
				<span class="hljs-keyword">return</span> [ partial.params.primarySetting ];
			} <span class="hljs-keyword">else</span> {
				<span class="hljs-keyword">return</span> [ partial.id ];
			}
		},

		<span class="hljs-comment">/**
		 * Return whether the setting is related to the partial.
		 *
		 * @since 4.5.0
		 *
		 * @param {wp.customize.Value|string} setting  ID or object for setting.
		 * @return {boolean} Whether the setting is related to the partial.
		 */</span>
		isRelatedSetting: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> setting <span class="hljs-regexp">/*... newValue, oldValue */</span> </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">if</span> ( _.isString( setting ) ) {
				setting = api( setting );
			}
			<span class="hljs-keyword">if</span> ( ! setting ) {
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
			<span class="hljs-keyword">return</span> <span class="hljs-number">-1</span> !== _.indexOf( partial.settings(), setting.id );
		},

		<span class="hljs-comment">/**
		 * Show the control to modify this partial's setting(s).
		 *
		 * This may be overridden for inline editing.
		 *
		 * @since 4.5.0
		 */</span>
		showControl: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, settingId = partial.params.primarySetting;
			<span class="hljs-keyword">if</span> ( ! settingId ) {
				settingId = _.first( partial.settings() );
			}
			<span class="hljs-keyword">if</span> ( partial.getType() === <span class="hljs-string">'nav_menu'</span> ) {
				<span class="hljs-keyword">if</span> ( partial.params.navMenuArgs.theme_location ) {
					settingId = <span class="hljs-string">'nav_menu_locations['</span> + partial.params.navMenuArgs.theme_location + <span class="hljs-string">']'</span>;
				} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( partial.params.navMenuArgs.menu )   {
					settingId = <span class="hljs-string">'nav_menu['</span> + <span class="hljs-built_in">String</span>( partial.params.navMenuArgs.menu ) + <span class="hljs-string">']'</span>;
				}
			}
			api.preview.send( <span class="hljs-string">'focus-control-for-setting'</span>, settingId );
		},

		<span class="hljs-comment">/**
		 * Prepare container for selective refresh.
		 *
		 * @since 4.5.0
		 *
		 * @param {Placement} placement
		 */</span>
		preparePlacement: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
			$( placement.container ).addClass( <span class="hljs-string">'customize-partial-refreshing'</span> );
		},

		<span class="hljs-comment">/**
		 * Reference to the pending promise returned from self.requestPartial().
		 *
		 * @since 4.5.0
		 * @private
		 */</span>
		_pendingRefreshPromise: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * Request the new partial and render it into the placements.
		 *
		 * @since 4.5.0
		 *
		 * @this {wp.customize.selectiveRefresh.Partial}
		 * @return {jQuery.Promise}
		 */</span>
		refresh: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, refreshPromise;

			refreshPromise = self.requestPartial( partial );

			<span class="hljs-keyword">if</span> ( ! partial._pendingRefreshPromise ) {
				_.each( partial.placements(), <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
					partial.preparePlacement( placement );
				} );

				refreshPromise.done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placements </span>) </span>{
					_.each( placements, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
						partial.renderContent( placement );
					} );
				} );

				refreshPromise.fail( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> data, placements </span>) </span>{
					partial.fallback( data, placements );
				} );</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Allow new request when this one finishes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				partial._pendingRefreshPromise = refreshPromise;
				refreshPromise.always( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
					partial._pendingRefreshPromise = <span class="hljs-literal">null</span>;
				} );
			}

			<span class="hljs-keyword">return</span> refreshPromise;
		},

		<span class="hljs-comment">/**
		 * Apply the addedContent in the placement to the document.
		 *
		 * Note the placement object will have its container and removedNodes
		 * properties updated.
		 *
		 * @since 4.5.0
		 *
		 * @param {Placement}             placement
		 * @param {Element|jQuery}        [placement.container]  - This param will be empty if there was no element matching the selector.
		 * @param {string|object|boolean} placement.addedContent - Rendered HTML content, a data object for JS templates to render, or false if no render.
		 * @param {object}                [placement.context]    - Optional context information about the container.
		 * @returns {boolean} Whether the rendering was successful and the fallback was not invoked.
		 */</span>
		renderContent: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>, content, newContainerElement;
			<span class="hljs-keyword">if</span> ( ! placement.container ) {
				partial.fallback( <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'no_container'</span> ), [ placement ] );
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}
			placement.container = $( placement.container );
			<span class="hljs-keyword">if</span> ( <span class="hljs-literal">false</span> === placement.addedContent ) {
				partial.fallback( <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'missing_render'</span> ), [ placement ] );
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Currently a subclass needs to override renderContent to handle partials returning data object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			<span class="hljs-keyword">if</span> ( ! _.isString( placement.addedContent ) ) {
				partial.fallback( <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'non_string_content'</span> ), [ placement ] );
				<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
			}

			<span class="hljs-comment">/* jshint ignore:start */</span>
			self.orginalDocumentWrite = <span class="hljs-built_in">document</span>.write;
			<span class="hljs-built_in">document</span>.write = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( self.data.l10n.badDocumentWrite );
			};
			<span class="hljs-comment">/* jshint ignore:end */</span>
			<span class="hljs-keyword">try</span> {
				content = placement.addedContent;
				<span class="hljs-keyword">if</span> ( wp.emoji &amp;&amp; wp.emoji.parse &amp;&amp; ! $.contains( <span class="hljs-built_in">document</span>.head, placement.container[<span class="hljs-number">0</span>] ) ) {
					content = wp.emoji.parse( content );
				}

				<span class="hljs-keyword">if</span> ( partial.params.containerInclusive ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Note that content may be an empty string, and in this case jQuery will just remove the oldContainer</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					newContainerElement = $( content );</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Merge the new context on top of the old context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					placement.context = _.extend(
						placement.context,
						newContainerElement.data( <span class="hljs-string">'customize-partial-placement-context'</span> ) || {}
					);
					newContainerElement.data( <span class="hljs-string">'customize-partial-placement-context'</span>, placement.context );

					placement.removedNodes = placement.container;
					placement.container = newContainerElement;
					placement.removedNodes.replaceWith( placement.container );
					placement.container.attr( <span class="hljs-string">'title'</span>, self.data.l10n.shiftClickToEdit );
				} <span class="hljs-keyword">else</span> {
					placement.removedNodes = <span class="hljs-built_in">document</span>.createDocumentFragment();
					<span class="hljs-keyword">while</span> ( placement.container[<span class="hljs-number">0</span>].firstChild ) {
						placement.removedNodes.appendChild( placement.container[<span class="hljs-number">0</span>].firstChild );
					}

					placement.container.html( content );
				}

				placement.container.removeClass( <span class="hljs-string">'customize-render-content-error'</span> );
			} <span class="hljs-keyword">catch</span> ( error ) {
				<span class="hljs-keyword">if</span> ( <span class="hljs-string">'undefined'</span> !== <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span> &amp;&amp; <span class="hljs-built_in">console</span>.error ) {
					<span class="hljs-built_in">console</span>.error( partial.id, error );
				}
				partial.fallback( error, [ placement ] );
			}
			<span class="hljs-comment">/* jshint ignore:start */</span>
			<span class="hljs-built_in">document</span>.write = self.orginalDocumentWrite;
			self.orginalDocumentWrite = <span class="hljs-literal">null</span>;
			<span class="hljs-comment">/* jshint ignore:end */</span>

			partial.createEditShortcutForPlacement( placement );
			placement.container.removeClass( <span class="hljs-string">'customize-partial-refreshing'</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Prevent placement container from being being re-triggered as being rendered among nested partials.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			placement.container.data( <span class="hljs-string">'customize-partial-content-rendered'</span>, <span class="hljs-literal">true</span> );

			<span class="hljs-comment">/*
			 * Note that the 'wp_audio_shortcode_library' and 'wp_video_shortcode_library' filters
			 * will determine whether or not wp.mediaelement is loaded and whether it will
			 * initialize audio and video respectively. See also https://core.trac.wordpress.org/ticket/40144
			 */</span>
			<span class="hljs-keyword">if</span> ( wp.mediaelement ) {
				wp.mediaelement.initialize();
			}

			<span class="hljs-comment">/**
			 * Announce when a partial's placement has been rendered so that dynamic elements can be re-built.
			 */</span>
			self.trigger( <span class="hljs-string">'partial-content-rendered'</span>, placement );
			<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
		},

		<span class="hljs-comment">/**
		 * Handle fail to render partial.
		 *
		 * The first argument is either the failing jqXHR or an Error object, and the second argument is the array of containers.
		 *
		 * @since 4.5.0
		 */</span>
		fallback: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> partial = <span class="hljs-keyword">this</span>;
			<span class="hljs-keyword">if</span> ( partial.params.fallbackRefresh ) {
				self.requestFullRefresh();
			}
		}
	} );

	<span class="hljs-comment">/**
	 * A Placement for a Partial.
	 *
	 * A partial placement is the actual physical representation of a partial for a given context.
	 * It also may have information in relation to how a placement may have just changed.
	 * The placement is conceptually similar to a DOM Range or MutationRecord.
	 *
	 * @class
	 * @augments wp.customize.Class
	 * @since 4.5.0
	 */</span>
	self.Placement = Placement = api.Class.extend({

		<span class="hljs-comment">/**
		 * The partial with which the container is associated.
		 *
		 * @param {wp.customize.selectiveRefresh.Partial}
		 */</span>
		partial: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * DOM element which contains the placement's contents.
		 *
		 * This will be null if the startNode and endNode do not point to the same
		 * DOM element, such as in the case of a sidebar partial.
		 * This container element itself will be replaced for partials that
		 * have containerInclusive param defined as true.
		 */</span>
		container: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * DOM node for the initial boundary of the placement.
		 *
		 * This will normally be the same as endNode since most placements appear as elements.
		 * This is primarily useful for widget sidebars which do not have intrinsic containers, but
		 * for which an HTML comment is output before to mark the starting position.
		 */</span>
		startNode: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * DOM node for the terminal boundary of the placement.
		 *
		 * This will normally be the same as startNode since most placements appear as elements.
		 * This is primarily useful for widget sidebars which do not have intrinsic containers, but
		 * for which an HTML comment is output before to mark the ending position.
		 */</span>
		endNode: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * Context data.
		 *
		 * This provides information about the placement which is included in the request
		 * in order to render the partial properly.
		 *
		 * @param {object}
		 */</span>
		context: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * The content for the partial when refreshed.
		 *
		 * @param {string}
		 */</span>
		addedContent: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * DOM node(s) removed when the partial is refreshed.
		 *
		 * If the partial is containerInclusive, then the removedNodes will be
		 * the single Element that was the partial's former placement. If the
		 * partial is not containerInclusive, then the removedNodes will be a
		 * documentFragment containing the nodes removed.
		 *
		 * @param {Element|DocumentFragment}
		 */</span>
		removedNodes: <span class="hljs-literal">null</span>,

		<span class="hljs-comment">/**
		 * Constructor.
		 *
		 * @since 4.5.0
		 *
		 * @param {object}                   args
		 * @param {Partial}                  args.partial
		 * @param {jQuery|Element}           [args.container]
		 * @param {Node}                     [args.startNode]
		 * @param {Node}                     [args.endNode]
		 * @param {object}                   [args.context]
		 * @param {string}                   [args.addedContent]
		 * @param {jQuery|DocumentFragment}  [args.removedNodes]
		 */</span>
		initialize: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> args </span>) </span>{
			<span class="hljs-keyword">var</span> placement = <span class="hljs-keyword">this</span>;

			args = _.extend( {}, args || {} );
			<span class="hljs-keyword">if</span> ( ! args.partial || ! args.partial.extended( Partial ) ) {
				<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'Missing partial'</span> );
			}
			args.context = args.context || {};
			<span class="hljs-keyword">if</span> ( args.container ) {
				args.container = $( args.container );
			}

			_.extend( placement, args );
		}

	});

	<span class="hljs-comment">/**
	 * Mapping of type names to Partial constructor subclasses.
	 *
	 * @since 4.5.0
	 *
	 * @type {Object.&lt;string, wp.customize.selectiveRefresh.Partial&gt;}
	 */</span>
	self.partialConstructor = {};

	self.partial = <span class="hljs-keyword">new</span> api.Values({ <span class="hljs-attr">defaultConstructor</span>: Partial });

	<span class="hljs-comment">/**
	 * Get the POST vars for a Customizer preview request.
	 *
	 * @since 4.5.0
	 * @see wp.customize.previewer.query()
	 *
	 * @return {object}
	 */</span>
	self.getCustomizeQuery = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> dirtyCustomized = {};
		api.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> value, key </span>) </span>{
			<span class="hljs-keyword">if</span> ( value._dirty ) {
				dirtyCustomized[ key ] = value();
			}
		} );

		<span class="hljs-keyword">return</span> {
			<span class="hljs-attr">wp_customize</span>: <span class="hljs-string">'on'</span>,
			<span class="hljs-attr">nonce</span>: api.settings.nonce.preview,
			<span class="hljs-attr">customize_theme</span>: api.settings.theme.stylesheet,
			<span class="hljs-attr">customized</span>: <span class="hljs-built_in">JSON</span>.stringify( dirtyCustomized ),
			<span class="hljs-attr">customize_changeset_uuid</span>: api.settings.changeset.uuid
		};
	};

	<span class="hljs-comment">/**
	 * Currently-requested partials and their associated deferreds.
	 *
	 * @since 4.5.0
	 * @type {Object&lt;string, { deferred: jQuery.Promise, partial: wp.customize.selectiveRefresh.Partial }&gt;}
	 */</span>
	self._pendingPartialRequests = {};

	<span class="hljs-comment">/**
	 * Timeout ID for the current requesr, or null if no request is current.
	 *
	 * @since 4.5.0
	 * @type {number|null}
	 * @private
	 */</span>
	self._debouncedTimeoutId = <span class="hljs-literal">null</span>;

	<span class="hljs-comment">/**
	 * Current jqXHR for the request to the partials.
	 *
	 * @since 4.5.0
	 * @type {jQuery.jqXHR|null}
	 * @private
	 */</span>
	self._currentRequest = <span class="hljs-literal">null</span>;

	<span class="hljs-comment">/**
	 * Request full page refresh.
	 *
	 * When selective refresh is embedded in the context of front-end editing, this request
	 * must fail or else changes will be lost, unless transactions are implemented.
	 *
	 * @since 4.5.0
	 */</span>
	self.requestFullRefresh = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		api.preview.send( <span class="hljs-string">'refresh'</span> );
	};

	<span class="hljs-comment">/**
	 * Request a re-rendering of a partial.
	 *
	 * @since 4.5.0
	 *
	 * @param {wp.customize.selectiveRefresh.Partial} partial
	 * @return {jQuery.Promise}
	 */</span>
	self.requestPartial = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> partial </span>) </span>{
		<span class="hljs-keyword">var</span> partialRequest;

		<span class="hljs-keyword">if</span> ( self._debouncedTimeoutId ) {
			clearTimeout( self._debouncedTimeoutId );
			self._debouncedTimeoutId = <span class="hljs-literal">null</span>;
		}
		<span class="hljs-keyword">if</span> ( self._currentRequest ) {
			self._currentRequest.abort();
			self._currentRequest = <span class="hljs-literal">null</span>;
		}

		partialRequest = self._pendingPartialRequests[ partial.id ];
		<span class="hljs-keyword">if</span> ( ! partialRequest || <span class="hljs-string">'pending'</span> !== partialRequest.deferred.state() ) {
			partialRequest = {
				<span class="hljs-attr">deferred</span>: $.Deferred(),
				<span class="hljs-attr">partial</span>: partial
			};
			self._pendingPartialRequests[ partial.id ] = partialRequest;
		}</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Prevent leaking partial into debounced timeout callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		partial = <span class="hljs-literal">null</span>;

		self._debouncedTimeoutId = setTimeout(
			<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
				<span class="hljs-keyword">var</span> data, partialPlacementContexts, partialsPlacements, request;

				self._debouncedTimeoutId = <span class="hljs-literal">null</span>;
				data = self.getCustomizeQuery();

				<span class="hljs-comment">/*
				 * It is key that the containers be fetched exactly at the point of the request being
				 * made, because the containers need to be mapped to responses by array indices.
				 */</span>
				partialsPlacements = {};

				partialPlacementContexts = {};

				_.each( self._pendingPartialRequests, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> pending, partialId </span>) </span>{
					partialsPlacements[ partialId ] = pending.partial.placements();
					<span class="hljs-keyword">if</span> ( ! self.partial.has( partialId ) ) {
						pending.deferred.rejectWith( pending.partial, [ <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'partial_removed'</span> ), partialsPlacements[ partialId ] ] );
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-comment">/*
						 * Note that this may in fact be an empty array. In that case, it is the responsibility
						 * of the Partial subclass instance to know where to inject the response, or else to
						 * just issue a refresh (default behavior). The data being returned with each container
						 * is the context information that may be needed to render certain partials, such as
						 * the contained sidebar for rendering widgets or what the nav menu args are for a menu.
						 */</span>
						partialPlacementContexts[ partialId ] = _.map( partialsPlacements[ partialId ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
							<span class="hljs-keyword">return</span> placement.context || {};
						} );
					}
				} );

				data.partials = <span class="hljs-built_in">JSON</span>.stringify( partialPlacementContexts );
				data[ self.data.renderQueryVar ] = <span class="hljs-string">'1'</span>;

				request = self._currentRequest = wp.ajax.send( <span class="hljs-literal">null</span>, {
					<span class="hljs-attr">data</span>: data,
					<span class="hljs-attr">url</span>: api.settings.url.self
				} );

				request.done( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> data </span>) </span>{

					<span class="hljs-comment">/**
					 * Announce the data returned from a request to render partials.
					 *
					 * The data is filtered on the server via customize_render_partials_response
					 * so plugins can inject data from the server to be utilized
					 * on the client via this event. Plugins may use this filter
					 * to communicate script and style dependencies that need to get
					 * injected into the page to support the rendered partials.
					 * This is similar to the 'saved' event.
					 */</span>
					self.trigger( <span class="hljs-string">'render-partials-response'</span>, data );</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Relay errors (warnings) captured during rendering and relay to console.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					<span class="hljs-keyword">if</span> ( data.errors &amp;&amp; <span class="hljs-string">'undefined'</span> !== <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span> &amp;&amp; <span class="hljs-built_in">console</span>.warn ) {
						_.each( data.errors, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> error </span>) </span>{
							<span class="hljs-built_in">console</span>.warn( error );
						} );
					}

					<span class="hljs-comment">/*
					 * Note that data is an array of items that correspond to the array of
					 * containers that were submitted in the request. So we zip up the
					 * array of containers with the array of contents for those containers,
					 * and send them into .
					 */</span>
					_.each( self._pendingPartialRequests, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> pending, partialId </span>) </span>{
						<span class="hljs-keyword">var</span> placementsContents;
						<span class="hljs-keyword">if</span> ( ! _.isArray( data.contents[ partialId ] ) ) {
							pending.deferred.rejectWith( pending.partial, [ <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>( <span class="hljs-string">'unrecognized_partial'</span> ), partialsPlacements[ partialId ] ] );
						} <span class="hljs-keyword">else</span> {
							placementsContents = _.map( data.contents[ partialId ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> content, i </span>) </span>{
								<span class="hljs-keyword">var</span> partialPlacement = partialsPlacements[ partialId ][ i ];
								<span class="hljs-keyword">if</span> ( partialPlacement ) {
									partialPlacement.addedContent = content;
								} <span class="hljs-keyword">else</span> {
									partialPlacement = <span class="hljs-keyword">new</span> Placement( {
										<span class="hljs-attr">partial</span>: pending.partial,
										<span class="hljs-attr">addedContent</span>: content
									} );
								}
								<span class="hljs-keyword">return</span> partialPlacement;
							} );
							pending.deferred.resolveWith( pending.partial, [ placementsContents ] );
						}
					} );
					self._pendingPartialRequests = {};
				} );

				request.fail( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> data, statusText </span>) </span>{

					<span class="hljs-comment">/*
					 * Ignore failures caused by partial.currentRequest.abort()
					 * The pending deferreds will remain in self._pendingPartialRequests
					 * for re-use with the next request.
					 */</span>
					<span class="hljs-keyword">if</span> ( <span class="hljs-string">'abort'</span> === statusText ) {
						<span class="hljs-keyword">return</span>;
					}

					_.each( self._pendingPartialRequests, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> pending, partialId </span>) </span>{
						pending.deferred.rejectWith( pending.partial, [ data, partialsPlacements[ partialId ] ] );
					} );
					self._pendingPartialRequests = {};
				} );
			},
			api.settings.timeouts.selectiveRefresh
		);

		<span class="hljs-keyword">return</span> partialRequest.deferred.promise();
	};

	<span class="hljs-comment">/**
	 * Add partials for any nav menu container elements in the document.
	 *
	 * This method may be called multiple times. Containers that already have been
	 * seen will be skipped.
	 *
	 * @since 4.5.0
	 *
	 * @param {jQuery|HTMLElement} [rootElement]
	 * @param {object}             [options]
	 * @param {boolean=true}       [options.triggerRendered]
	 */</span>
	self.addPartials = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> rootElement, options </span>) </span>{
		<span class="hljs-keyword">var</span> containerElements;
		<span class="hljs-keyword">if</span> ( ! rootElement ) {
			rootElement = <span class="hljs-built_in">document</span>.documentElement;
		}
		rootElement = $( rootElement );
		options = _.extend(
			{
				<span class="hljs-attr">triggerRendered</span>: <span class="hljs-literal">true</span>
			},
			options || {}
		);

		containerElements = rootElement.find( <span class="hljs-string">'[data-customize-partial-id]'</span> );
		<span class="hljs-keyword">if</span> ( rootElement.is( <span class="hljs-string">'[data-customize-partial-id]'</span> ) ) {
			containerElements = containerElements.add( rootElement );
		}
		containerElements.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
			<span class="hljs-keyword">var</span> containerElement = $( <span class="hljs-keyword">this</span> ), partial, placement, id, Constructor, partialOptions, containerContext;
			id = containerElement.data( <span class="hljs-string">'customize-partial-id'</span> );
			<span class="hljs-keyword">if</span> ( ! id ) {
				<span class="hljs-keyword">return</span>;
			}
			containerContext = containerElement.data( <span class="hljs-string">'customize-partial-placement-context'</span> ) || {};

			partial = self.partial( id );
			<span class="hljs-keyword">if</span> ( ! partial ) {
				partialOptions = containerElement.data( <span class="hljs-string">'customize-partial-options'</span> ) || {};
				partialOptions.constructingContainerContext = containerElement.data( <span class="hljs-string">'customize-partial-placement-context'</span> ) || {};
				Constructor = self.partialConstructor[ containerElement.data( <span class="hljs-string">'customize-partial-type'</span> ) ] || self.Partial;
				partial = <span class="hljs-keyword">new</span> Constructor( id, partialOptions );
				self.partial.add( partial.id, partial );
			}

			<span class="hljs-comment">/*
			 * Only trigger renders on (nested) partials that have been not been
			 * handled yet. An example where this would apply is a nav menu
			 * embedded inside of a custom menu widget. When the widget's title
			 * is updated, the entire widget will re-render and then the event
			 * will be triggered for the nested nav menu to do any initialization.
			 */</span>
			<span class="hljs-keyword">if</span> ( options.triggerRendered &amp;&amp; ! containerElement.data( <span class="hljs-string">'customize-partial-content-rendered'</span> ) ) {

				placement = <span class="hljs-keyword">new</span> Placement( {
					<span class="hljs-attr">partial</span>: partial,
					<span class="hljs-attr">context</span>: containerContext,
					<span class="hljs-attr">container</span>: containerElement
				} );

				$( placement.container ).attr( <span class="hljs-string">'title'</span>, self.data.l10n.shiftClickToEdit );
				partial.createEditShortcutForPlacement( placement );

				<span class="hljs-comment">/**
				 * Announce when a partial's nested placement has been re-rendered.
				 */</span>
				self.trigger( <span class="hljs-string">'partial-content-rendered'</span>, placement );
			}
			containerElement.data( <span class="hljs-string">'customize-partial-content-rendered'</span>, <span class="hljs-literal">true</span> );
		} );
	};

	api.bind( <span class="hljs-string">'preview-ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
		<span class="hljs-keyword">var</span> handleSettingChange, watchSettingChange, unwatchSettingChange;

		_.extend( self.data, _customizePartialRefreshExports );</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Create the partial JS models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		_.each( self.data.partials, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> data, id </span>) </span>{
			<span class="hljs-keyword">var</span> Constructor, partial = self.partial( id );
			<span class="hljs-keyword">if</span> ( ! partial ) {
				Constructor = self.partialConstructor[ data.type ] || self.Partial;
				partial = <span class="hljs-keyword">new</span> Constructor( id, { <span class="hljs-attr">params</span>: data } );
				self.partial.add( id, partial );
			} <span class="hljs-keyword">else</span> {
				_.extend( partial.params, data );
			}
		} );

		<span class="hljs-comment">/**
		 * Handle change to a setting.
		 *
		 * Note this is largely needed because adding a 'change' event handler to wp.customize
		 * will only include the changed setting object as an argument, not including the
		 * new value or the old value.
		 *
		 * @since 4.5.0
		 * @this {wp.customize.Setting}
		 *
		 * @param {*|null} newValue New value, or null if the setting was just removed.
		 * @param {*|null} oldValue Old value, or null if the setting was just added.
		 */</span>
		handleSettingChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> newValue, oldValue </span>) </span>{
			<span class="hljs-keyword">var</span> setting = <span class="hljs-keyword">this</span>;
			self.partial.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> partial </span>) </span>{
				<span class="hljs-keyword">if</span> ( partial.isRelatedSetting( setting, newValue, oldValue ) ) {
					partial.refresh();
				}
			} );
		};

		<span class="hljs-comment">/**
		 * Trigger the initial change for the added setting, and watch for changes.
		 *
		 * @since 4.5.0
		 * @this {wp.customize.Values}
		 *
		 * @param {wp.customize.Setting} setting
		 */</span>
		watchSettingChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> setting </span>) </span>{
			handleSettingChange.call( setting, setting(), <span class="hljs-literal">null</span> );
			setting.bind( handleSettingChange );
		};

		<span class="hljs-comment">/**
		 * Trigger the final change for the removed setting, and unwatch for changes.
		 *
		 * @since 4.5.0
		 * @this {wp.customize.Values}
		 *
		 * @param {wp.customize.Setting} setting
		 */</span>
		unwatchSettingChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> setting </span>) </span>{
			handleSettingChange.call( setting, <span class="hljs-literal">null</span>, setting() );
			setting.unbind( handleSettingChange );
		};

		api.bind( <span class="hljs-string">'add'</span>, watchSettingChange );
		api.bind( <span class="hljs-string">'remove'</span>, unwatchSettingChange );
		api.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> setting </span>) </span>{
			setting.bind( handleSettingChange );
		} );</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Add (dynamic) initial partials that are declared via data-* attributes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		self.addPartials( <span class="hljs-built_in">document</span>.documentElement, {
			<span class="hljs-attr">triggerRendered</span>: <span class="hljs-literal">false</span>
		} );</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Add new dynamic partials when the document changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">if</span> ( <span class="hljs-string">'undefined'</span> !== <span class="hljs-keyword">typeof</span> MutationObserver ) {
			self.mutationObserver = <span class="hljs-keyword">new</span> MutationObserver( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> mutations </span>) </span>{
				_.each( mutations, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> mutation </span>) </span>{
					self.addPartials( $( mutation.target ) );
				} );
			} );
			self.mutationObserver.observe( <span class="hljs-built_in">document</span>.documentElement, {
				<span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>,
				<span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span>
			} );
		}

		<span class="hljs-comment">/**
		 * Handle rendering of partials.
		 *
		 * @param {api.selectiveRefresh.Placement} placement
		 */</span>
		api.selectiveRefresh.bind( <span class="hljs-string">'partial-content-rendered'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> placement </span>) </span>{
			<span class="hljs-keyword">if</span> ( placement.container ) {
				self.addPartials( placement.container );
			}
		} );

		<span class="hljs-comment">/**
		 * Handle setting validities in partial refresh response.
		 *
		 * @param {object} data Response data.
		 * @param {object} data.setting_validities Setting validities.
		 */</span>
		api.selectiveRefresh.bind( <span class="hljs-string">'render-partials-response'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleSettingValiditiesResponse</span>(<span class="hljs-params"> data </span>) </span>{
			<span class="hljs-keyword">if</span> ( data.setting_validities ) {
				api.preview.send( <span class="hljs-string">'selective-refresh-setting-validities'</span>, data.setting_validities );
			}
		} );

		api.preview.bind( <span class="hljs-string">'edit-shortcut-visibility'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> visibility </span>) </span>{
			api.selectiveRefresh.editShortcutVisibility.set( visibility );
		} );
		api.selectiveRefresh.editShortcutVisibility.bind( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> visibility </span>) </span>{
			<span class="hljs-keyword">var</span> body = $( <span class="hljs-built_in">document</span>.body ), shouldAnimateHide;

			shouldAnimateHide = ( <span class="hljs-string">'hidden'</span> === visibility &amp;&amp; body.hasClass( <span class="hljs-string">'customize-partial-edit-shortcuts-shown'</span> ) &amp;&amp; ! body.hasClass( <span class="hljs-string">'customize-partial-edit-shortcuts-hidden'</span> ) );
			body.toggleClass( <span class="hljs-string">'customize-partial-edit-shortcuts-hidden'</span>, shouldAnimateHide );
			body.toggleClass( <span class="hljs-string">'customize-partial-edit-shortcuts-shown'</span>, <span class="hljs-string">'visible'</span> === visibility );
		} );

		api.preview.bind( <span class="hljs-string">'active'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Make all partials ready.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			self.partial.each( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> partial </span>) </span>{
				partial.deferred.ready.resolve();
			} );</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Make all partials added henceforth as ready upon add.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			self.partial.bind( <span class="hljs-string">'add'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"> partial </span>) </span>{
				partial.deferred.ready.resolve();
			} );
		} );

	} );

	<span class="hljs-keyword">return</span> self;
}( jQuery, wp.customize ) );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
